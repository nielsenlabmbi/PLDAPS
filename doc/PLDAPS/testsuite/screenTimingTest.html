<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of screenTimingTest</title>
  <meta name="keywords" content="screenTimingTest">
  <meta name="description" content="screenTimingTest    screenTimingTest is a pldaps stimulus to test the physical delay of the onset of a stimulus on the screen to">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">PLDAPS</a> &gt; <a href="index.html">testsuite</a> &gt; screenTimingTest.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for PLDAPS/testsuite&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>screenTimingTest
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>screenTimingTest    screenTimingTest is a pldaps stimulus to test the physical delay of the onset of a stimulus on the screen to</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function p=screenTimingTest(p,state) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="description">screenTimingTest    screenTimingTest is a pldaps stimulus to test the physical delay of the onset of a stimulus on the screen to 
                    to the time the vsync occured.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../PLDAPS/SupportFunctions/pdsDefaultTrialStructure.html" class="code" title="function p = pdsDefaultTrialStructure(p, stimulusname)">pdsDefaultTrialStructure</a>	p = pdsDefaultTrialStructure(p)</li><li><a href="../../PLDAPS/SupportFunctions/pldapsDefaultTrialFunction.html" class="code" title="function pldapsDefaultTrialFunction(p,state)">pldapsDefaultTrialFunction</a>	</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<!-- parameterreference -->
<h2><a name="_cross"></a>PARAMETER USAGE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function uses these parameters:
<ul >
<li><a href="../../Parameters/datapixx/adc/data.html" class="param" title="">.datapixx.adc.data:</a>	
        <a href="#_line0174" class="code"}">174 </a></li><li><a href="../../Parameters/datapixx/adc/dataSampleTimes.html" class="param" title="">.datapixx.adc.dataSampleTimes:</a>	
        <a href="#_line0175" class="code"}">175 </a></li><li><a href="../../Parameters/display/frate.html" class="param" title="">.display.frate:</a>	
        <a href="#_line0095" class="code"}">95 </a>    <a href="#_line0165" class="code"}">165 </a></li><li><a href="../../Parameters/display/ppd.html" class="param" title="">.display.ppd:</a>	
        <a href="#_line0087" class="code"}">87 </a></li><li><a href="../../Parameters/display/ptr.html" class="param" title="">.display.ptr:</a>	
        <a href="#_line0248" class="code"}">248 </a></li><li><a href="../../Parameters/display/winRect.html" class="param" title="">.display.winRect:</a>	
        <a href="#_line0099" class="code"}">99 </a>    <a href="#_line0099" class="code"}">99 </a>    <a href="#_line0101" class="code"}">101 </a>    <a href="#_line0101" class="code"}">101 </a>    <a href="#_line0102" class="code"}">102 </a>    <a href="#_line0102" class="code"}">102 </a>    <a href="#_line0104" class="code"}">104 </a>    <a href="#_line0104" class="code"}">104 </a>    <a href="#_line0105" class="code"}">105 </a>    <a href="#_line0105" class="code"}">105 </a>    <a href="#_line0107" class="code"}">107 </a>    <a href="#_line0107" class="code"}">107 </a>    <a href="#_line0109" class="code"}">109 </a>    <a href="#_line0109" class="code"}">109 </a>    <a href="#_line0112" class="code"}">112 </a>    <a href="#_line0112" class="code"}">112 </a>    <a href="#_line0113" class="code"}">113 </a>    <a href="#_line0113" class="code"}">113 </a></li><li><a href="../../Parameters/iFrame.html" class="param" title="">.iFrame:</a>	
        <a href="#_line0168" class="code"}">168 </a>    <a href="#_line0246" class="code"}">246 </a>    <a href="#_line0258" class="code"}">258 </a></li><li><a href="../../Parameters/pldaps/maxFrames.html" class="param" title="">.pldaps.maxFrames:</a>	
        <a href="#_line0165" class="code"}">165 </a>    <a href="#_line0258" class="code"}">258 </a></li><li><a href="../../Parameters/pldaps/trialFunction.html" class="param" title="">.pldaps.trialFunction:</a>	
        <a href="#_line0092" class="code"}">92 </a></li><li><a href="../../Parameters/pldaps/trialLength.html" class="param" title="">.pldaps.trialLength:</a>	
        <a href="#_line0095" class="code"}">95 </a></li><li><a href="../../Parameters/pldaps/trialStates/frameDraw.html" class="param" title="called every frame for drawing command.">.pldaps.trialStates.frameDraw:</a>	
        <a href="#_line0233" class="code"}">233 </a>    <a href="#_line0244" class="code"}">244 </a>called every frame for drawing command.</li><li><a href="../../Parameters/pldaps/trialStates/frameDrawingFinished.html" class="param" title="called every frame after drawing.">.pldaps.trialStates.frameDrawingFinished:</a>	
        <a href="#_line0234" class="code"}">234 </a>called every frame after drawing.</li><li><a href="../../Parameters/pldaps/trialStates/frameFlip.html" class="param" title="called every frame to flip the buffers.">.pldaps.trialStates.frameFlip:</a>	
        <a href="#_line0235" class="code"}">235 </a>    <a href="#_line0257" class="code"}">257 </a>called every frame to flip the buffers.</li><li><a href="../../Parameters/pldaps/trialStates/framePrepareDrawing.html" class="param" title="called every frame to prepare drawing.">.pldaps.trialStates.framePrepareDrawing:</a>	
        <a href="#_line0232" class="code"}">232 </a>called every frame to prepare drawing.</li><li><a href="../../Parameters/pldaps/trialStates/frameUpdate.html" class="param" title="called every frame to update input.">.pldaps.trialStates.frameUpdate:</a>	
        <a href="#_line0231" class="code"}">231 </a>called every frame to update input.</li><li><a href="../../Parameters/pldaps/trialStates/trialCleanUpandSave.html" class="param" title="called at the end of the trial.">.pldaps.trialStates.trialCleanUpandSave:</a>	
        <a href="#_line0167" class="code"}">167 </a>called at the end of the trial.</li><li><a href="../../Parameters/pldaps/trialStates/trialSetup.html" class="param" title="called before each trial for data allocation.">.pldaps.trialStates.trialSetup:</a>	
        <a href="#_line0164" class="code"}">164 </a>called before each trial for data allocation.</li><li><a href="../../Parameters/stimulus/location.html" class="param" title="">.stimulus.location:</a>	
        <a href="#_line0097" class="code"}">97 </a></li><li><a href="../../Parameters/stimulus/nTrials.html" class="param" title="">.stimulus.nTrials:</a>	
        <a href="#_line0119" class="code"}">119 </a></li><li><a href="../../Parameters/stimulus/onDatapixxTime.html" class="param" title="">.stimulus.onDatapixxTime:</a>	
        <a href="#_line0194" class="code"}">194 </a>    <a href="#_line0196" class="code"}">196 </a>    <a href="#_line0208" class="code"}">208 </a>    <a href="#_line0211" class="code"}">211 </a></li><li><a href="../../Parameters/stimulus/onFrame.html" class="param" title="">.stimulus.onFrame:</a>	
        <a href="#_line0168" class="code"}">168 </a>    <a href="#_line0246" class="code"}">246 </a></li><li><a href="../../Parameters/stimulus/online/analysis.html" class="param" title="">.stimulus.online.analysis:</a>	
        <a href="#_line0126" class="code"}">126 </a>    <a href="#_line0191" class="code"}">191 </a></li><li><a href="../../Parameters/stimulus/online/figureAx1.html" class="param" title="">.stimulus.online.figureAx1:</a>	
        <a href="#_line0200" class="code"}">200 </a></li><li><a href="../../Parameters/stimulus/online/figureAx2.html" class="param" title="">.stimulus.online.figureAx2:</a>	
        <a href="#_line0207" class="code"}">207 </a></li><li><a href="../../Parameters/stimulus/online/figureAx3.html" class="param" title="">.stimulus.online.figureAx3:</a>	
        <a href="#_line0226" class="code"}">226 </a></li><li><a href="../../Parameters/stimulus/rect.html" class="param" title="">.stimulus.rect:</a>	
        <a href="#_line0248" class="code"}">248 </a></li><li><a href="../../Parameters/stimulus/size.html" class="param" title="">.stimulus.size:</a>	
        <a href="#_line0087" class="code"}">87 </a></li><li><a href="../../Parameters/timing/frameStateChangeTimes.html" class="param" title="">.timing.frameStateChangeTimes:</a>	
        <a href="#_line0227" class="code"}">227 </a>    <a href="#_line0228" class="code"}">228 </a>    <a href="#_line0229" class="code"}">229 </a></li></ul>
This function assigns these parameters:
<ul>
<li><a href="../../Parameters/flagNextTrial.html" class="param" title="">.flagNextTrial:</a>
        <a href="#_line0259" class="code"}">259 </a></li><li><a href="../../Parameters/pldaps/finish.html" class="param" title="Number of trials to run. can be changed dynamically">.pldaps.finish:</a>
        <a href="#_line0121" class="code"}">121 </a>Number of trials to run. can be changed dynamically</li><li><a href="../../Parameters/pldaps/maxFrames.html" class="param" title="">.pldaps.maxFrames:</a>
        <a href="#_line0095" class="code"}">95 </a></li><li><a href="../../Parameters/pldaps/trialLength.html" class="param" title="">.pldaps.trialLength:</a>
        <a href="#_line0082" class="code"}">82 </a></li><li><a href="../../Parameters/stimulus/location.html" class="param" title="">.stimulus.location:</a>
        <a href="#_line0075" class="code"}">75 </a></li><li><a href="../../Parameters/stimulus/nTrials.html" class="param" title="">.stimulus.nTrials:</a>
        <a href="#_line0072" class="code"}">72 </a></li><li><a href="../../Parameters/stimulus/onComputerTimeEstimate.html" class="param" title="">.stimulus.onComputerTimeEstimate:</a>
        <a href="#_line0169" class="code"}">169 </a>    <a href="#_line0172" class="code"}">172 </a></li><li><a href="../../Parameters/stimulus/onDatapixxTime.html" class="param" title="">.stimulus.onDatapixxTime:</a>
        <a href="#_line0169" class="code"}">169 </a>    <a href="#_line0171" class="code"}">171 </a></li><li><a href="../../Parameters/stimulus/onFrame.html" class="param" title="">.stimulus.onFrame:</a>
        <a href="#_line0165" class="code"}">165 </a></li><li><a href="../../Parameters/stimulus/online/analysis.html" class="param" title="">.stimulus.online.analysis:</a>
        <a href="#_line0079" class="code"}">79 </a></li><li><a href="../../Parameters/stimulus/online/figureAx1.html" class="param" title="">.stimulus.online.figureAx1:</a>
        <a href="#_line0129" class="code"}">129 </a></li><li><a href="../../Parameters/stimulus/online/figureAx2.html" class="param" title="">.stimulus.online.figureAx2:</a>
        <a href="#_line0132" class="code"}">132 </a></li><li><a href="../../Parameters/stimulus/online/figureAx3.html" class="param" title="">.stimulus.online.figureAx3:</a>
        <a href="#_line0135" class="code"}">135 </a></li><li><a href="../../Parameters/stimulus/photoDiodeDatapixxTime.html" class="param" title="">.stimulus.photoDiodeDatapixxTime:</a>
        <a href="#_line0189" class="code"}">189 </a></li><li><a href="../../Parameters/stimulus/rect.html" class="param" title="">.stimulus.rect:</a>
        <a href="#_line0116" class="code"}">116 </a></li><li><a href="../../Parameters/stimulus/size.html" class="param" title="">.stimulus.size:</a>
        <a href="#_line0085" class="code"}">85 </a></li></ul>
<!-- parameterreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre><div id="_line0001" class="line">0001 <a name="_sub0" href="#_subfunctions" class="code">function p=screenTimingTest(p,state)</a>
</div><div id="_line0002" class="line">0002 <span class="comment">%screenTimingTest    screenTimingTest is a pldaps stimulus to test the physical delay of the onset of a stimulus on the screen to</span>
</div><div id="_line0003" class="line">0003 <span class="comment">%                    to the time the vsync occured.</span>
</div><div id="_line0004" class="line">0004 
</div><div id="_line0005" class="line">0005 <span class="comment">% Before running this, you should have made basic sanity checks with</span>
</div><div id="_line0006" class="line">0006 <span class="comment">% VBLSyncTest(6000,[],[],[],[],[],[],2);</span>
</div><div id="_line0007" class="line">0007 <span class="comment">% and</span>
</div><div id="_line0008" class="line">0008 <span class="comment">% PerceptualVBLSyncTest</span>
</div><div id="_line0009" class="line">0009 <span class="comment">%</span>
</div><div id="_line0010" class="line">0010 <span class="comment">% how to use:</span>
</div><div id="_line0011" class="line">0011 <span class="comment">% 1. Connect Photodiode to Datapixx</span>
</div><div id="_line0012" class="line">0012 <span class="comment">% You need to connect a photodiode to one of the Datapixx analog inputs and</span>
</div><div id="_line0013" class="line">0013 <span class="comment">% configure pldaps to record that data, e.g.:</span>
</div><div id="_line0014" class="line">0014 <span class="comment">%</span>
</div><div id="_line0015" class="line">0015 <span class="comment">% settingsStruct.datapixx.adc.channels=0; % first channel</span>
</div><div id="_line0016" class="line">0016 <span class="comment">% settingsStruct.datapixx.adc.channelModes=2; %photodiode ground is</span>
</div><div id="_line0017" class="line">0017 <span class="comment">% connected to Ref 0 (0: ground, 1:differential to channelNr+1,</span>
</div><div id="_line0018" class="line">0018 <span class="comment">% 2:Differential to Ref0, 3:Differetial to Ref1)</span>
</div><div id="_line0019" class="line">0019 <span class="comment">% settingsStruct.datapixx.adc.srate=10000; % 10k, so get 0.1ms precision</span>
</div><div id="_line0020" class="line">0020 <span class="comment">%</span>
</div><div id="_line0021" class="line">0021 <span class="comment">% 2. Place Photodiode</span>
</div><div id="_line0022" class="line">0022 <span class="comment">% You must place the photodiode in one of 5 locations and set this in the</span>
</div><div id="_line0023" class="line">0023 <span class="comment">% settingsStruct accordingly:</span>
</div><div id="_line0024" class="line">0024 <span class="comment">%</span>
</div><div id="_line0025" class="line">0025 <span class="comment">% settingsStruct.stimulus.location = 1; %</span>
</div><div id="_line0026" class="line">0026 <span class="comment">%</span>
</div><div id="_line0027" class="line">0027 <span class="comment">% 1: Top left corner: This is the most important</span>
</div><div id="_line0028" class="line">0028 <span class="comment">% location as the frame updating should start here, i.e. it is the best</span>
</div><div id="_line0029" class="line">0029 <span class="comment">% estimate of the time of vertical trace reset that be compare it to</span>
</div><div id="_line0030" class="line">0030 <span class="comment">% 2: Bottom left corner: On a CRT this should be very close to one</span>
</div><div id="_line0031" class="line">0031 <span class="comment">% frame duration later than 1</span>
</div><div id="_line0032" class="line">0032 <span class="comment">% 3: Top right corner: Only slightly later than 1 (on CRT)</span>
</div><div id="_line0033" class="line">0033 <span class="comment">% 4: Bottom right corner: Position last updated on a CRT</span>
</div><div id="_line0034" class="line">0034 <span class="comment">% 5: center left: just one more position that is var from any glitches in</span>
</div><div id="_line0035" class="line">0035 <span class="comment">% vsync estimates.</span>
</div><div id="_line0036" class="line">0036 <span class="comment">%</span>
</div><div id="_line0037" class="line">0037 <span class="comment">% 3. Set Trial Parameters</span>
</div><div id="_line0038" class="line">0038 <span class="comment">% settingsStruct.pldaps.maxTrialLength = 3; %Each trial is 3 seconds long.</span>
</div><div id="_line0039" class="line">0039 <span class="comment">% The stimulus will only be shown up to 1 second before end of trial trial.</span>
</div><div id="_line0040" class="line">0040 <span class="comment">% If you do not set this, this will befault to whatever you have set in</span>
</div><div id="_line0041" class="line">0041 <span class="comment">% your rigprefs</span>
</div><div id="_line0042" class="line">0042 <span class="comment">% settingsStruct.stimulus.nTrials = 200; %how many measurements?</span>
</div><div id="_line0043" class="line">0043 <span class="comment">%</span>
</div><div id="_line0044" class="line">0044 <span class="comment">% 4. Analyze</span>
</div><div id="_line0045" class="line">0045 <span class="comment">% a simple analysis is included in this. Just call screenTimingTest(p),</span>
</div><div id="_line0046" class="line">0046 <span class="comment">% where p is your just recorded pldaps class.</span>
</div><div id="_line0047" class="line">0047 <span class="comment">% or turn on online analysis:</span>
</div><div id="_line0048" class="line">0048 <span class="comment">% settingsStruct.stimulus.online.analysis = true;</span>
</div><div id="_line0049" class="line">0049 <span class="comment">%</span>
</div><div id="_line0050" class="line">0050 <span class="comment">% putting it all together:</span>
</div><div id="_line0051" class="line">0051 <span class="comment">% settingsStruct.datapixx.adc.channels=0;</span>
</div><div id="_line0052" class="line">0052 <span class="comment">% settingsStruct.datapixx.adc.channelModes=2;</span>
</div><div id="_line0053" class="line">0053 <span class="comment">% settingsStruct.datapixx.adc.srate=10000;</span>
</div><div id="_line0054" class="line">0054 <span class="comment">% settingsStruct.stimulus.location = 2;</span>
</div><div id="_line0055" class="line">0055 <span class="comment">% settingsStruct.pldaps.trialLength = 1.5;</span>
</div><div id="_line0056" class="line">0056 <span class="comment">% settingsStruct.stimulus.nTrials = 20;</span>
</div><div id="_line0057" class="line">0057 <span class="comment">% settingsStruct.stimulus.online.analysis = true;</span>
</div><div id="_line0058" class="line">0058 <span class="comment">% settingsStruct.eyelink.use=false;</span>
</div><div id="_line0059" class="line">0059 <span class="comment">% settingsStruct.mouse.useAsEyepos=true;</span>
</div><div id="_line0060" class="line">0060 <span class="comment">% settingsStruct.mouse.use=true;</span>
</div><div id="_line0061" class="line">0061 <span class="comment">% settingsStruct.display.bgColor=[0 0 0];</span>
</div><div id="_line0062" class="line">0062 <span class="comment">% settingsStruct.pldaps.pause.preExperiment=false;</span>
</div><div id="_line0063" class="line">0063 <span class="comment">% name = 'RigAndScreenName';</span>
</div><div id="_line0064" class="line">0064 <span class="comment">% p=pldaps(@screenTimingTest, settingsStruct, name);</span>
</div><div id="_line0065" class="line">0065 <span class="comment">% p.run</span>
</div><div id="_line0066" class="line">0066 <span class="comment">% savefig(gcf,name)</span>
</div><div id="_line0067" class="line">0067 
</div><div id="_line0068" class="line">0068 
</div><div id="_line0069" class="line">0069     <span class="keyword">if</span> nargin==1 &amp;&amp; isempty(p.data) <span class="comment">%initial call to setup conditions</span>
</div><div id="_line0070" class="line">0070         
</div><div id="_line0071" class="line">0071         <span class="keyword">if</span> ~isField(p.trial,<span class="string">'stimulus.nTrials'</span>)
</div><div id="_line0072" class="line">0072             p.trial<a href="../../Parameters/stimulus/nTrials.html" class="param" title="">.stimulus.nTrials</a> = 200;
</div><div id="_line0073" class="line">0073         <span class="keyword">end</span>
</div><div id="_line0074" class="line">0074         <span class="keyword">if</span> ~isField(p.trial,<span class="string">'stimulus.location'</span>)
</div><div id="_line0075" class="line">0075             p.trial<a href="../../Parameters/stimulus/location.html" class="param" title="">.stimulus.location</a> = 1;
</div><div id="_line0076" class="line">0076         <span class="keyword">end</span>
</div><div id="_line0077" class="line">0077         
</div><div id="_line0078" class="line">0078         <span class="keyword">if</span> ~isField(p.trial,<span class="string">'stimulus.online.analysis'</span>)
</div><div id="_line0079" class="line">0079             p.trial<a href="../../Parameters/stimulus/online/analysis.html" class="param" title="">.stimulus.online.analysis</a> = false;
</div><div id="_line0080" class="line">0080         <span class="keyword">end</span>
</div><div id="_line0081" class="line">0081         <span class="keyword">if</span> ~isField(p.trial,<span class="string">'pldaps.trialLength'</span>)
</div><div id="_line0082" class="line">0082             p.trial<a href="../../Parameters/pldaps/trialLength.html" class="param" title="">.pldaps.trialLength</a> = 3;
</div><div id="_line0083" class="line">0083         <span class="keyword">end</span>
</div><div id="_line0084" class="line">0084         
</div><div id="_line0085" class="line">0085         p.trial<a href="../../Parameters/stimulus/size.html" class="param" title="">.stimulus.size</a>=5;
</div><div id="_line0086" class="line">0086         
</div><div id="_line0087" class="line">0087         sz=p.trial<a href="../../Parameters/stimulus/size.html" class="param" title="">.stimulus.size</a>*p.trial<a href="../../Parameters/display/ppd.html" class="param" title="">.display.ppd</a>;
</div><div id="_line0088" class="line">0088         
</div><div id="_line0089" class="line">0089         p = <a href="../../PLDAPS/SupportFunctions/pdsDefaultTrialStructure.html" class="code" title="function p = pdsDefaultTrialStructure(p, stimulusname)">pdsDefaultTrialStructure</a>(p); 
</div><div id="_line0090" class="line">0090 
</div><div id="_line0091" class="line">0091 <span class="comment">%         p.trial.pldaps.trialMasterFunction='runTrial';</span>
</div><div id="_line0092" class="line">0092         p.defaultParameters<a href="../../Parameters/pldaps/trialFunction.html" class="param" title="">.pldaps.trialFunction</a>=<span class="string">'screenTimingTest'</span>;
</div><div id="_line0093" class="line">0093         <span class="comment">%five seconds per trial.</span>
</div><div id="_line0094" class="line">0094         
</div><div id="_line0095" class="line">0095         p.trial<a href="../../Parameters/pldaps/maxFrames.html" class="param" title="">.pldaps.maxFrames</a> = p.trial<a href="../../Parameters/pldaps/trialLength.html" class="param" title="">.pldaps.trialLength</a>*p.trial<a href="../../Parameters/display/frate.html" class="param" title="">.display.frate</a>;
</div><div id="_line0096" class="line">0096         
</div><div id="_line0097" class="line">0097         <span class="keyword">switch</span> p.trial<a href="../../Parameters/stimulus/location.html" class="param" title="">.stimulus.location</a>
</div><div id="_line0098" class="line">0098             <span class="keyword">case</span> 1
</div><div id="_line0099" class="line">0099                 rect = [p.trial<a href="../../Parameters/display/winRect.html" class="param" title="">.display.winRect</a>(1:2) p.trial<a href="../../Parameters/display/winRect.html" class="param" title="">.display.winRect</a>(1:2)+sz];
</div><div id="_line0100" class="line">0100             <span class="keyword">case</span> 2
</div><div id="_line0101" class="line">0101                 rect = [p.trial<a href="../../Parameters/display/winRect.html" class="param" title="">.display.winRect</a>(1) p.trial<a href="../../Parameters/display/winRect.html" class="param" title="">.display.winRect</a>(4)-sz <span class="keyword">...</span>
</div><div id="_line0102" class="line">0102                     p.trial<a href="../../Parameters/display/winRect.html" class="param" title="">.display.winRect</a>(1)+sz p.trial<a href="../../Parameters/display/winRect.html" class="param" title="">.display.winRect</a>(4)];
</div><div id="_line0103" class="line">0103             <span class="keyword">case</span> 3
</div><div id="_line0104" class="line">0104                 rect = [p.trial<a href="../../Parameters/display/winRect.html" class="param" title="">.display.winRect</a>(3)-sz p.trial<a href="../../Parameters/display/winRect.html" class="param" title="">.display.winRect</a>(2)<span class="keyword">...</span>
</div><div id="_line0105" class="line">0105                     p.trial<a href="../../Parameters/display/winRect.html" class="param" title="">.display.winRect</a>(3) p.trial<a href="../../Parameters/display/winRect.html" class="param" title="">.display.winRect</a>(2)+sz];
</div><div id="_line0106" class="line">0106             <span class="keyword">case</span> 4
</div><div id="_line0107" class="line">0107                 rect = [p.trial<a href="../../Parameters/display/winRect.html" class="param" title="">.display.winRect</a>(3:4)-sz p.trial<a href="../../Parameters/display/winRect.html" class="param" title="">.display.winRect</a>(3:4)];
</div><div id="_line0108" class="line">0108             <span class="keyword">case</span> 5
</div><div id="_line0109" class="line">0109                 rect = [p.trial<a href="../../Parameters/display/winRect.html" class="param" title="">.display.winRect</a>(1) mean(p.trial<a href="../../Parameters/display/winRect.html" class="param" title="">.display.winRect</a>([2 4]))];
</div><div id="_line0110" class="line">0110                 rect = [rect rect+sz];
</div><div id="_line0111" class="line">0111             <span class="keyword">otherwise</span>
</div><div id="_line0112" class="line">0112                 rect = [p.trial<a href="../../Parameters/display/winRect.html" class="param" title="">.display.winRect</a>(1) p.trial<a href="../../Parameters/display/winRect.html" class="param" title="">.display.winRect</a>(4)-sz <span class="keyword">...</span>
</div><div id="_line0113" class="line">0113                     p.trial<a href="../../Parameters/display/winRect.html" class="param" title="">.display.winRect</a>(1)+sz p.trial<a href="../../Parameters/display/winRect.html" class="param" title="">.display.winRect</a>(4)];
</div><div id="_line0114" class="line">0114         <span class="keyword">end</span>
</div><div id="_line0115" class="line">0115     
</div><div id="_line0116" class="line">0116         p.trial<a href="../../Parameters/stimulus/rect.html" class="param" title="">.stimulus.rect</a>=rect;        
</div><div id="_line0117" class="line">0117         
</div><div id="_line0118" class="line">0118         c.Nr=1; <span class="comment">%one condition;</span>
</div><div id="_line0119" class="line">0119         p.conditions=repmat({c},1,p.trial<a href="../../Parameters/stimulus/nTrials.html" class="param" title="">.stimulus.nTrials</a>);
</div><div id="_line0120" class="line">0120 
</div><div id="_line0121" class="line">0121         p.defaultParameters<a href="../../Parameters/pldaps/finish.html" class="param" title="Number of trials to run. can be changed dynamically">.pldaps.finish</a> = length(p.conditions); 
</div><div id="_line0122" class="line">0122 
</div><div id="_line0123" class="line">0123         defaultTrialVariables(p);
</div><div id="_line0124" class="line">0124         
</div><div id="_line0125" class="line">0125         <span class="comment">%online analysis</span>
</div><div id="_line0126" class="line">0126         <span class="keyword">if</span> p.trial<a href="../../Parameters/stimulus/online/analysis.html" class="param" title="">.stimulus.online.analysis</a>
</div><div id="_line0127" class="line">0127            figure;
</div><div id="_line0128" class="line">0128            p.functionHandles{end+1}=subplot(4,1,1);
</div><div id="_line0129" class="line">0129            p.trial<a href="../../Parameters/stimulus/online/figureAx1.html" class="param" title="">.stimulus.online.figureAx1</a> = length(p.functionHandles);
</div><div id="_line0130" class="line">0130            
</div><div id="_line0131" class="line">0131            p.functionHandles{end+1}=subplot(4,1,2);
</div><div id="_line0132" class="line">0132            p.trial<a href="../../Parameters/stimulus/online/figureAx2.html" class="param" title="">.stimulus.online.figureAx2</a> = length(p.functionHandles);
</div><div id="_line0133" class="line">0133            
</div><div id="_line0134" class="line">0134            p.functionHandles{end+1}=subplot(4,1,3);
</div><div id="_line0135" class="line">0135            p.trial<a href="../../Parameters/stimulus/online/figureAx3.html" class="param" title="">.stimulus.online.figureAx3</a> = length(p.functionHandles);
</div><div id="_line0136" class="line">0136            
</div><div id="_line0137" class="line">0137 <span class="comment">%            p.trial.stimulus.online.figureAx1 = subplot(3,1,1);</span>
</div><div id="_line0138" class="line">0138 <span class="comment">%            p.trial.stimulus.online.figureAx2 = subplot(3,1,2);</span>
</div><div id="_line0139" class="line">0139 <span class="comment">%            p.trial.stimulus.online.figureAx3 = subplot(3,1,3);</span>
</div><div id="_line0140" class="line">0140         <span class="keyword">end</span>
</div><div id="_line0141" class="line">0141         
</div><div id="_line0142" class="line">0142     <span class="keyword">elseif</span> nargin==1 <span class="comment">%analyse previously recorded data</span>
</div><div id="_line0143" class="line">0143 <span class="comment">%         for j=1:length(p.data)</span>
</div><div id="_line0144" class="line">0144 <span class="comment">%             d=p.data{j}.datapixx.adc.data;</span>
</div><div id="_line0145" class="line">0145 <span class="comment">%             md=median(d);</span>
</div><div id="_line0146" class="line">0146 <span class="comment">%             sd=std(d);</span>
</div><div id="_line0147" class="line">0147 <span class="comment">%             id=find(abs((d - md)/sd) &gt; 4,1,'first');</span>
</div><div id="_line0148" class="line">0148 <span class="comment">%             if ~isempty(id)</span>
</div><div id="_line0149" class="line">0149 <span class="comment">%                 pdt(j)=p.data{j}.datapixx.adc.dataSampleTimes(id);</span>
</div><div id="_line0150" class="line">0150 <span class="comment">%             else</span>
</div><div id="_line0151" class="line">0151 <span class="comment">%                 pdt(j)=NaN;</span>
</div><div id="_line0152" class="line">0152 <span class="comment">%             end</span>
</div><div id="_line0153" class="line">0153 <span class="comment">%</span>
</div><div id="_line0154" class="line">0154 <span class="comment">%             flipTime(j)=p.data{j}.stimulus.onDatapixxTime;</span>
</div><div id="_line0155" class="line">0155 <span class="comment">%         end</span>
</div><div id="_line0156" class="line">0156 <span class="comment">%</span>
</div><div id="_line0157" class="line">0157 <span class="comment">%         plot(1000*(pdt-flipTime))</span>
</div><div id="_line0158" class="line">0158     <span class="keyword">else</span>
</div><div id="_line0159" class="line">0159         <span class="comment">%if you don't want all the pldapsDefaultTrialFucntions states to be used,</span>
</div><div id="_line0160" class="line">0160         <span class="comment">%just call them in the states you want to use it.</span>
</div><div id="_line0161" class="line">0161         <span class="comment">%otherwise just leave it here</span>
</div><div id="_line0162" class="line">0162         <a href="../../PLDAPS/SupportFunctions/pldapsDefaultTrialFunction.html" class="code" title="function pldapsDefaultTrialFunction(p,state)">pldapsDefaultTrialFunction</a>(p,state);
</div><div id="_line0163" class="line">0163         <span class="keyword">switch</span> state
</div><div id="_line0164" class="line">0164             <span class="keyword">case</span> p.trial<a href="../../Parameters/pldaps/trialStates/trialSetup.html" class="param" title="called before each trial for data allocation.">.pldaps.trialStates.trialSetup</a>
</div><div id="_line0165" class="line">0165                 p.trial<a href="../../Parameters/stimulus/onFrame.html" class="param" title="">.stimulus.onFrame</a>=randi([1 ceil(p.trial<a href="../../Parameters/pldaps/maxFrames.html" class="param" title="">.pldaps.maxFrames</a>-p.trial<a href="../../Parameters/display/frate.html" class="param" title="">.display.frate</a>-0.25)]);
</div><div id="_line0166" class="line">0166 <span class="comment">%             case p.trial.pldaps.trialStates.trialPrepare</span>
</div><div id="_line0167" class="line">0167             <span class="keyword">case</span> p.trial<a href="../../Parameters/pldaps/trialStates/trialCleanUpandSave.html" class="param" title="called at the end of the trial.">.pldaps.trialStates.trialCleanUpandSave</a>
</div><div id="_line0168" class="line">0168                 <span class="keyword">if</span> p.trial<a href="../../Parameters/iFrame.html" class="param" title="">.iFrame</a> &gt; p.trial<a href="../../Parameters/stimulus/onFrame.html" class="param" title="">.stimulus.onFrame</a>
</div><div id="_line0169" class="line">0169                     [p.trial<a href="../../Parameters/stimulus/onDatapixxTime.html" class="param" title="">.stimulus.onDatapixxTime</a>, p.trial<a href="../../Parameters/stimulus/onComputerTimeEstimate.html" class="param" title="">.stimulus.onComputerTimeEstimate</a>] = PsychDataPixx(<span class="string">'GetLastOnsetTimestamp'</span>); 
</div><div id="_line0170" class="line">0170                 <span class="keyword">else</span>
</div><div id="_line0171" class="line">0171                     p.trial<a href="../../Parameters/stimulus/onDatapixxTime.html" class="param" title="">.stimulus.onDatapixxTime</a> = NaN;
</div><div id="_line0172" class="line">0172                     p.trial<a href="../../Parameters/stimulus/onComputerTimeEstimate.html" class="param" title="">.stimulus.onComputerTimeEstimate</a> = NaN;
</div><div id="_line0173" class="line">0173                 <span class="keyword">end</span>
</div><div id="_line0174" class="line">0174                 d=p.trial<a href="../../Parameters/datapixx/adc/data.html" class="param" title="">.datapixx.adc.data</a>;
</div><div id="_line0175" class="line">0175                 t=p.trial<a href="../../Parameters/datapixx/adc/dataSampleTimes.html" class="param" title="">.datapixx.adc.dataSampleTimes</a>;
</div><div id="_line0176" class="line">0176                 md=median(d);
</div><div id="_line0177" class="line">0177                 sd=std(d);
</div><div id="_line0178" class="line">0178                 id=find(abs((d - md)/sd) &gt; 8,1,<span class="string">'first'</span>);
</div><div id="_line0179" class="line">0179                 <span class="keyword">if</span> ~isempty(id)
</div><div id="_line0180" class="line">0180 <span class="comment">%                     sd2=std(d(1:id));</span>
</div><div id="_line0181" class="line">0181 <span class="comment">%                     id=find(abs((d - md)/sd2) &gt; 4,1,'first');</span>
</div><div id="_line0182" class="line">0182                     sd2=sd;
</div><div id="_line0183" class="line">0183                     pdt=t(id);
</div><div id="_line0184" class="line">0184                 <span class="keyword">else</span>
</div><div id="_line0185" class="line">0185                     sd2=sd;
</div><div id="_line0186" class="line">0186                     pdt=NaN;
</div><div id="_line0187" class="line">0187                 <span class="keyword">end</span>
</div><div id="_line0188" class="line">0188                 
</div><div id="_line0189" class="line">0189                 p.trial<a href="../../Parameters/stimulus/photoDiodeDatapixxTime.html" class="param" title="">.stimulus.photoDiodeDatapixxTime</a> = pdt;
</div><div id="_line0190" class="line">0190                 
</div><div id="_line0191" class="line">0191                 <span class="keyword">if</span> p.trial<a href="../../Parameters/stimulus/online/analysis.html" class="param" title="">.stimulus.online.analysis</a>
</div><div id="_line0192" class="line">0192                     <span class="keyword">if</span> ~isempty(p.data)
</div><div id="_line0193" class="line">0193                         x=cellfun(@(x) x.stimulus.photoDiodeDatapixxTime - x.stimulus.onDatapixxTime,p.data);
</div><div id="_line0194" class="line">0194                         x(end+1)=pdt-p.trial<a href="../../Parameters/stimulus/onDatapixxTime.html" class="param" title="">.stimulus.onDatapixxTime</a>;
</div><div id="_line0195" class="line">0195                     <span class="keyword">else</span>
</div><div id="_line0196" class="line">0196                         x=pdt-p.trial<a href="../../Parameters/stimulus/onDatapixxTime.html" class="param" title="">.stimulus.onDatapixxTime</a>;
</div><div id="_line0197" class="line">0197                     <span class="keyword">end</span>
</div><div id="_line0198" class="line">0198                     x=x*1000;
</div><div id="_line0199" class="line">0199 
</div><div id="_line0200" class="line">0200                     ax=p.functionHandles{p.trial<a href="../../Parameters/stimulus/online/figureAx1.html" class="param" title="">.stimulus.online.figureAx1</a>};
</div><div id="_line0201" class="line">0201                     plot(ax,x);
</div><div id="_line0202" class="line">0202                     hold(ax, <span class="string">'on'</span>);
</div><div id="_line0203" class="line">0203                     plot(ax,length(x),pdt,<span class="string">'Color'</span>, [0 0.8 0]);
</div><div id="_line0204" class="line">0204                     hold(ax, <span class="string">'off'</span>);
</div><div id="_line0205" class="line">0205                     ylim(ax,[max(min(x)*0.9,0.1)  max(max(x)*1.1,1) ]);
</div><div id="_line0206" class="line">0206 
</div><div id="_line0207" class="line">0207                     ax=p.functionHandles{p.trial<a href="../../Parameters/stimulus/online/figureAx2.html" class="param" title="">.stimulus.online.figureAx2</a>};
</div><div id="_line0208" class="line">0208                     <span class="keyword">if</span> isnan(p.trial<a href="../../Parameters/stimulus/onDatapixxTime.html" class="param" title="">.stimulus.onDatapixxTime</a>)
</div><div id="_line0209" class="line">0209                         t2=(t-t(1))*1000;
</div><div id="_line0210" class="line">0210                     <span class="keyword">else</span>
</div><div id="_line0211" class="line">0211                         t2=(t-p.trial<a href="../../Parameters/stimulus/onDatapixxTime.html" class="param" title="">.stimulus.onDatapixxTime</a>)*1000;
</div><div id="_line0212" class="line">0212                     <span class="keyword">end</span>
</div><div id="_line0213" class="line">0213                     plot(ax,t2,d);
</div><div id="_line0214" class="line">0214                     hold(ax, <span class="string">'on'</span>);
</div><div id="_line0215" class="line">0215                     plot(ax,[t2(1) t2(end)],[md md], <span class="string">'k'</span>);
</div><div id="_line0216" class="line">0216                     plot(ax,[t2(1) t2(end)],[md+sd2 md+sd2], <span class="string">'--k'</span>);
</div><div id="_line0217" class="line">0217                     plot(ax,[t2(1) t2(end)],[md+4*sd2 md+4*sd2], <span class="string">'-.k'</span>);
</div><div id="_line0218" class="line">0218                     plot(ax,[t2(1) t2(end)],[md-sd2 md-sd2], <span class="string">'--k'</span>);
</div><div id="_line0219" class="line">0219                     plot(ax,[t2(1) t2(end)],[md-4*sd2 md-4*sd2], <span class="string">'-.k'</span>);
</div><div id="_line0220" class="line">0220 
</div><div id="_line0221" class="line">0221                     <span class="keyword">if</span> ~isempty(id)
</div><div id="_line0222" class="line">0222                         plot(ax,[t2(id),t2(id)], [0 d(id)], <span class="string">'k'</span>)
</div><div id="_line0223" class="line">0223                     <span class="keyword">end</span>
</div><div id="_line0224" class="line">0224                     hold(ax, <span class="string">'off'</span>);
</div><div id="_line0225" class="line">0225                     
</div><div id="_line0226" class="line">0226                     ax=p.functionHandles{p.trial<a href="../../Parameters/stimulus/online/figureAx3.html" class="param" title="">.stimulus.online.figureAx3</a>};
</div><div id="_line0227" class="line">0227                     anyft=any(p.trial<a href="../../Parameters/timing/frameStateChangeTimes.html" class="param" title="">.timing.frameStateChangeTimes</a>,2);
</div><div id="_line0228" class="line">0228                     plot(ax,p.trial<a href="../../Parameters/timing/frameStateChangeTimes.html" class="param" title="">.timing.frameStateChangeTimes</a>(anyft,:)'*1000);
</div><div id="_line0229" class="line">0229                     l=cell(size(p.trial<a href="../../Parameters/timing/frameStateChangeTimes.html" class="param" title="">.timing.frameStateChangeTimes</a>,1));
</div><div id="_line0230" class="line">0230                     [l{:}]=deal(<span class="string">''</span>);
</div><div id="_line0231" class="line">0231                     l{p.trial<a href="../../Parameters/pldaps/trialStates/frameUpdate.html" class="param" title="called every frame to update input.">.pldaps.trialStates.frameUpdate</a>}=<span class="string">'Update'</span>;
</div><div id="_line0232" class="line">0232                     l{p.trial<a href="../../Parameters/pldaps/trialStates/framePrepareDrawing.html" class="param" title="called every frame to prepare drawing.">.pldaps.trialStates.framePrepareDrawing</a>}=<span class="string">'PrepareDrawing'</span>;
</div><div id="_line0233" class="line">0233                     l{p.trial<a href="../../Parameters/pldaps/trialStates/frameDraw.html" class="param" title="called every frame for drawing command.">.pldaps.trialStates.frameDraw</a>}=<span class="string">'Draw'</span>;
</div><div id="_line0234" class="line">0234                     l{p.trial<a href="../../Parameters/pldaps/trialStates/frameDrawingFinished.html" class="param" title="called every frame after drawing.">.pldaps.trialStates.frameDrawingFinished</a>}=<span class="string">'DrawingFinished'</span>;
</div><div id="_line0235" class="line">0235                     l{p.trial<a href="../../Parameters/pldaps/trialStates/frameFlip.html" class="param" title="called every frame to flip the buffers.">.pldaps.trialStates.frameFlip</a>}=<span class="string">'Flip'</span>;
</div><div id="_line0236" class="line">0236                     legend(ax,l(anyft));
</div><div id="_line0237" class="line">0237                    
</div><div id="_line0238" class="line">0238                     drawnow
</div><div id="_line0239" class="line">0239                     shg
</div><div id="_line0240" class="line">0240                 <span class="keyword">end</span>
</div><div id="_line0241" class="line">0241                 
</div><div id="_line0242" class="line">0242 <span class="comment">%             case p.trial.pldaps.trialStates.frameUpdate</span>
</div><div id="_line0243" class="line">0243 <span class="comment">%             case p.trial.pldaps.trialStates.framePrepareDrawing;</span>
</div><div id="_line0244" class="line">0244             <span class="keyword">case</span> p.trial<a href="../../Parameters/pldaps/trialStates/frameDraw.html" class="param" title="called every frame for drawing command.">.pldaps.trialStates.frameDraw</a>;
</div><div id="_line0245" class="line">0245 <span class="comment">%                 Screen('FillRect',  p.trial.display.ptr,[1 1 1],p.trial.stimulus.rect')</span>
</div><div id="_line0246" class="line">0246                 <span class="keyword">if</span> p.trial<a href="../../Parameters/iFrame.html" class="param" title="">.iFrame</a>==p.trial<a href="../../Parameters/stimulus/onFrame.html" class="param" title="">.stimulus.onFrame</a>
</div><div id="_line0247" class="line">0247                     PsychDataPixx(<span class="string">'LogOnsetTimestamps'</span>, 1);
</div><div id="_line0248" class="line">0248                     Screen(<span class="string">'FillRect'</span>,  p.trial<a href="../../Parameters/display/ptr.html" class="param" title="">.display.ptr</a>,[1 1 1]*1.,p.trial<a href="../../Parameters/stimulus/rect.html" class="param" title="">.stimulus.rect</a>')
</div><div id="_line0249" class="line">0249 <span class="comment">%                     Screen('FillRect',  p.trial.display.overlayptr,p.trial.display.clut.red,p.trial.stimulus.rect')</span>
</div><div id="_line0250" class="line">0250 <span class="comment">%                 elseif  p.trial.iFrame==p.trial.stimulus.onFrame+1</span>
</div><div id="_line0251" class="line">0251 <span class="comment">%</span>
</div><div id="_line0252" class="line">0252                 <span class="keyword">end</span>
</div><div id="_line0253" class="line">0253 <span class="comment">%             case p.trial.pldaps.trialStates.frameIdlePreLastDraw;</span>
</div><div id="_line0254" class="line">0254 <span class="comment">%             case p.trial.pldaps.trialStates.frameDrawTimecritical;</span>
</div><div id="_line0255" class="line">0255 <span class="comment">%             case p.trial.pldaps.trialStates.frameDrawingFinished;</span>
</div><div id="_line0256" class="line">0256 <span class="comment">%             case p.trial.pldaps.trialStates.frameIdlePostDraw;</span>
</div><div id="_line0257" class="line">0257             <span class="keyword">case</span> p.trial<a href="../../Parameters/pldaps/trialStates/frameFlip.html" class="param" title="called every frame to flip the buffers.">.pldaps.trialStates.frameFlip</a>;   
</div><div id="_line0258" class="line">0258                 <span class="keyword">if</span> p.trial<a href="../../Parameters/iFrame.html" class="param" title="">.iFrame</a> &gt;= p.trial<a href="../../Parameters/pldaps/maxFrames.html" class="param" title="">.pldaps.maxFrames</a>
</div><div id="_line0259" class="line">0259                     p.trial<a href="../../Parameters/flagNextTrial.html" class="param" title="">.flagNextTrial</a>=true;
</div><div id="_line0260" class="line">0260                 <span class="keyword">end</span>
</div><div id="_line0261" class="line">0261         <span class="keyword">end</span>
</div><div id="_line0262" class="line">0262     <span class="keyword">end</span>
</div></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005
<br>
check <strong><a href="../../index.html">here</a></strong> date of last update.
<br></address>
</body>
</html>