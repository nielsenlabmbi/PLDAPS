<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of setup</title>
  <meta name="keywords" content="setup">
  <meta name="description" content="pds.newEraSyringePump.getVolume   sets up connection to a New Era syringe pump">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">PLDAPS</a> &gt; <a href="../index.html">+pds</a> &gt; <a href="index.html">+newEraSyringePump</a> &gt; setup.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for PLDAPS/+pds/+newEraSyringePump&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>pds.newEraSyringePump.setup
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>pds.newEraSyringePump.getVolume   sets up connection to a New Era syringe pump</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function p = setup(p) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="description">pds.newEraSyringePump.getVolume   sets up connection to a New Era syringe pump

 p = pds.newEraSyringePump.setup(p)
 sets up the connection to a New Era syringe pump (syringepump.com) via
 USB. Currently only modes that run a by defined volume per reward are implemented

 jk wrote it 2015</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="getVolume.html" class="code" title="function [volumeGiven,volumeWithdrawn] = getVolume(p)">pds.newEraSyringePump.getVolume</a>	pds.newEraSyringePump.getVolume   retrieves the current volume dispensed by the pump</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../PLDAPS/+pds/+behavior/+reward/setup.html" class="code" title="function p = setup(p)">pds.behavior.reward.setup</a>	pds.behavior.reward.setup(p)    setup reward systems before the experiment</li></ul>
<!-- crossreference -->

<!-- parameterreference -->
<h2><a name="_cross"></a>PARAMETER USAGE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function uses these parameters:
<ul >
<li><a href="../../../Parameters/behavior/reward/defaultAmount.html" class="param" title="Default amount of reward.">.behavior.reward.defaultAmount:</a>	
        <a href="#_line0049" class="code"}">49 </a>Default amount of reward.</li><li><a href="../../../Parameters/newEraSyringePump/alarmMode.html" class="param" title="create an alarm when stalled">.newEraSyringePump.alarmMode:</a>	
        <a href="#_line0030" class="code"}">30 </a>create an alarm when stalled</li><li><a href="../../../Parameters/newEraSyringePump/allowNewDiameter.html" class="param" title="allow changing of the syringe diameter">.newEraSyringePump.allowNewDiameter:</a>	
        <a href="#_line0039" class="code"}">39 </a>allow changing of the syringe diameter</li><li><a href="../../../Parameters/newEraSyringePump/commandSeparator.html" class="param" title="">.newEraSyringePump.commandSeparator:</a>	
        <a href="#_line0023" class="code"}">23 </a>    <a href="#_line0024" class="code"}">24 </a>    <a href="#_line0026" class="code"}">26 </a>    <a href="#_line0028" class="code"}">28 </a>    <a href="#_line0030" class="code"}">30 </a>    <a href="#_line0032" class="code"}">32 </a>    <a href="#_line0040" class="code"}">40 </a>    <a href="#_line0046" class="code"}">46 </a>    <a href="#_line0049" class="code"}">49 </a></li><li><a href="../../../Parameters/newEraSyringePump/diameter.html" class="param" title="syringe diameter in mm">.newEraSyringePump.diameter:</a>	
        <a href="#_line0038" class="code"}">38 </a>    <a href="#_line0040" class="code"}">40 </a>syringe diameter in mm</li><li><a href="../../../Parameters/newEraSyringePump/lowNoiseMode.html" class="param" title="use low noise mode (never noticed a difference)">.newEraSyringePump.lowNoiseMode:</a>	
        <a href="#_line0028" class="code"}">28 </a>use low noise mode (never noticed a difference)</li><li><a href="../../../Parameters/newEraSyringePump/port.html" class="param" title="USB emulated serial port of the pump">.newEraSyringePump.port:</a>	
        <a href="#_line0014" class="code"}">14 </a>USB emulated serial port of the pump</li><li><a href="../../../Parameters/newEraSyringePump/rate.html" class="param" title="flow rate">.newEraSyringePump.rate:</a>	
        <a href="#_line0046" class="code"}">46 </a>flow rate</li><li><a href="../../../Parameters/newEraSyringePump/triggerMode.html" class="param" title="Trigger mode for manual triggers using the pumps TTL input.">.newEraSyringePump.triggerMode:</a>	
        <a href="#_line0032" class="code"}">32 </a>Trigger mode for manual triggers using the pumps TTL input.</li><li><a href="../../../Parameters/newEraSyringePump/use.html" class="param" title="toggle use of newEraSyringePump module">.newEraSyringePump.use:</a>	
        <a href="#_line0010" class="code"}">10 </a>toggle use of newEraSyringePump module</li><li><a href="../../../Parameters/newEraSyringePump/volumeUnits.html" class="param" title="units for dispensing. ML or UL">.newEraSyringePump.volumeUnits:</a>	
        <a href="#_line0049" class="code"}">49 </a>units for dispensing. ML or UL</li></ul>
This function assigns these parameters:
<ul>
<li><a href="../../../Parameters/newEraSyringePump/commandSeparator.html" class="param" title="">.newEraSyringePump.commandSeparator:</a>
        <a href="#_line0021" class="code"}">21 </a></li><li><a href="../../../Parameters/newEraSyringePump/h.html" class="param" title="">.newEraSyringePump.h:</a>
        <a href="#_line0019" class="code"}">19 </a></li><li><a href="../../../Parameters/newEraSyringePump/initialVolumeGiven.html" class="param" title="">.newEraSyringePump.initialVolumeGiven:</a>
        <a href="#_line0057" class="code"}">57 </a></li><li><a href="../../../Parameters/newEraSyringePump/initialVolumeWithdrawn.html" class="param" title="">.newEraSyringePump.initialVolumeWithdrawn:</a>
        <a href="#_line0058" class="code"}">58 </a></li></ul>
<!-- parameterreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre><div id="_line0001" class="line">0001 <a name="_sub0" href="#_subfunctions" class="code">function p = setup(p)</a>
</div><div id="_line0002" class="line">0002 <span class="comment">%pds.newEraSyringePump.getVolume   sets up connection to a New Era syringe pump</span>
</div><div id="_line0003" class="line">0003 <span class="comment">%</span>
</div><div id="_line0004" class="line">0004 <span class="comment">% p = pds.newEraSyringePump.setup(p)</span>
</div><div id="_line0005" class="line">0005 <span class="comment">% sets up the connection to a New Era syringe pump (syringepump.com) via</span>
</div><div id="_line0006" class="line">0006 <span class="comment">% USB. Currently only modes that run a by defined volume per reward are implemented</span>
</div><div id="_line0007" class="line">0007 <span class="comment">%</span>
</div><div id="_line0008" class="line">0008 <span class="comment">% jk wrote it 2015</span>
</div><div id="_line0009" class="line">0009 
</div><div id="_line0010" class="line">0010 <span class="keyword">if</span> p.trial<a href="../../../Parameters/newEraSyringePump/use.html" class="param" title="toggle use of newEraSyringePump module">.newEraSyringePump.use</a>
</div><div id="_line0011" class="line">0011     cs=<span class="string">'BaudRate=19200 DTR=1 RTS=1 ReceiveTimeout=1'</span>;
</div><div id="_line0012" class="line">0012     IOPort(<span class="string">'closeAll'</span>); <span class="comment">%risky. for now....</span>
</div><div id="_line0013" class="line">0013     WaitSecs(0.1);
</div><div id="_line0014" class="line">0014     [h,errmsg]=IOPort(<span class="string">'OpenSerialPort'</span>,p.trial<a href="../../../Parameters/newEraSyringePump/port.html" class="param" title="USB emulated serial port of the pump">.newEraSyringePump.port</a>,cs);<span class="comment">%'/dev/cu.usbserial'</span>
</div><div id="_line0015" class="line">0015     WaitSecs(0.1);
</div><div id="_line0016" class="line">0016     <span class="keyword">if</span> ~isempty(errmsg)
</div><div id="_line0017" class="line">0017         error(<span class="string">'pds:newEraSyringePump:setup'</span>,[<span class="string">'Failed to open serial Port with message '</span> char(10) errmsg]);
</div><div id="_line0018" class="line">0018     <span class="keyword">end</span>
</div><div id="_line0019" class="line">0019     p.trial<a href="../../../Parameters/newEraSyringePump/h.html" class="param" title="">.newEraSyringePump.h</a> = h;
</div><div id="_line0020" class="line">0020     
</div><div id="_line0021" class="line">0021     p.trial<a href="../../../Parameters/newEraSyringePump/commandSeparator.html" class="param" title="">.newEraSyringePump.commandSeparator</a> = [char(13) repmat(char(10),1,20)];
</div><div id="_line0022" class="line">0022 
</div><div id="_line0023" class="line">0023     IOPort(<span class="string">'Write'</span>, h, [p.trial<a href="../../../Parameters/newEraSyringePump/commandSeparator.html" class="param" title="">.newEraSyringePump.commandSeparator</a>],0);
</div><div id="_line0024" class="line">0024     IOPort(<span class="string">'Write'</span>, h, [<span class="string">'DIA'</span> p.trial<a href="../../../Parameters/newEraSyringePump/commandSeparator.html" class="param" title="">.newEraSyringePump.commandSeparator</a>],0);<span class="comment">%0.05</span>
</div><div id="_line0025" class="line">0025     
</div><div id="_line0026" class="line">0026     IOPort(<span class="string">'Write'</span>, h, [<span class="string">'DIR INF'</span>  p.trial<a href="../../../Parameters/newEraSyringePump/commandSeparator.html" class="param" title="">.newEraSyringePump.commandSeparator</a>],0);
</div><div id="_line0027" class="line">0027 
</div><div id="_line0028" class="line">0028     IOPort(<span class="string">'Write'</span>, h, [<span class="string">'LN '</span> num2str(p.trial<a href="../../../Parameters/newEraSyringePump/lowNoiseMode.html" class="param" title="use low noise mode (never noticed a difference)">.newEraSyringePump.lowNoiseMode</a>) p.trial<a href="../../../Parameters/newEraSyringePump/commandSeparator.html" class="param" title="">.newEraSyringePump.commandSeparator</a>],0); <span class="comment">%low noise mode, try</span>
</div><div id="_line0029" class="line">0029     
</div><div id="_line0030" class="line">0030     IOPort(<span class="string">'Write'</span>, h, [<span class="string">'AL '</span> num2str(p.trial<a href="../../../Parameters/newEraSyringePump/alarmMode.html" class="param" title="create an alarm when stalled">.newEraSyringePump.alarmMode</a>) p.trial<a href="../../../Parameters/newEraSyringePump/commandSeparator.html" class="param" title="">.newEraSyringePump.commandSeparator</a>],0); <span class="comment">%low noise mode, try</span>
</div><div id="_line0031" class="line">0031 
</div><div id="_line0032" class="line">0032     IOPort(<span class="string">'Write'</span>, h, [<span class="string">'TRG '</span> p.trial<a href="../../../Parameters/newEraSyringePump/triggerMode.html" class="param" title="Trigger mode for manual triggers using the pumps TTL input.">.newEraSyringePump.triggerMode</a>  p.trial<a href="../../../Parameters/newEraSyringePump/commandSeparator.html" class="param" title="">.newEraSyringePump.commandSeparator</a>],0);
</div><div id="_line0033" class="line">0033     
</div><div id="_line0034" class="line">0034     WaitSecs(0.1);
</div><div id="_line0035" class="line">0035     a=char(IOPort(<span class="string">'Read'</span>,h,1,14));
</div><div id="_line0036" class="line">0036     currentDiameter=str2double(a(10:end));
</div><div id="_line0037" class="line">0037     
</div><div id="_line0038" class="line">0038     <span class="keyword">if</span> currentDiameter~=p.trial<a href="../../../Parameters/newEraSyringePump/diameter.html" class="param" title="syringe diameter in mm">.newEraSyringePump.diameter</a>
</div><div id="_line0039" class="line">0039         <span class="keyword">if</span> p.trial<a href="../../../Parameters/newEraSyringePump/allowNewDiameter.html" class="param" title="allow changing of the syringe diameter">.newEraSyringePump.allowNewDiameter</a>
</div><div id="_line0040" class="line">0040             IOPort(<span class="string">'Write'</span>, h, [<span class="string">'DIA '</span> num2str(p.trial<a href="../../../Parameters/newEraSyringePump/diameter.html" class="param" title="syringe diameter in mm">.newEraSyringePump.diameter</a>) p.trial<a href="../../../Parameters/newEraSyringePump/commandSeparator.html" class="param" title="">.newEraSyringePump.commandSeparator</a>],0); 
</div><div id="_line0041" class="line">0041         <span class="keyword">else</span>
</div><div id="_line0042" class="line">0042             error(<span class="string">'pds:newEraSyringePump:setup'</span>,<span class="string">'Change in Diametersize requested. Please confirm that you want to do this, as it would zero the current volume settings'</span>)
</div><div id="_line0043" class="line">0043         <span class="keyword">end</span>
</div><div id="_line0044" class="line">0044     <span class="keyword">end</span>
</div><div id="_line0045" class="line">0045     
</div><div id="_line0046" class="line">0046     IOPort(<span class="string">'Write'</span>, h, [<span class="string">'RAT '</span> num2str(p.trial<a href="../../../Parameters/newEraSyringePump/rate.html" class="param" title="flow rate">.newEraSyringePump.rate</a>) <span class="string">' MH '</span> p.trial<a href="../../../Parameters/newEraSyringePump/commandSeparator.html" class="param" title="">.newEraSyringePump.commandSeparator</a>],0);<span class="comment">%2900</span>
</div><div id="_line0047" class="line">0047 
</div><div id="_line0048" class="line">0048      
</div><div id="_line0049" class="line">0049     IOPort(<span class="string">'Write'</span>, h, [<span class="string">'VOL '</span> num2str(p.trial<a href="../../../Parameters/behavior/reward/defaultAmount.html" class="param" title="Default amount of reward.">.behavior.reward.defaultAmount</a>) <span class="string">' '</span> p.trial<a href="../../../Parameters/newEraSyringePump/volumeUnits.html" class="param" title="units for dispensing. ML or UL">.newEraSyringePump.volumeUnits</a> p.trial<a href="../../../Parameters/newEraSyringePump/commandSeparator.html" class="param" title="">.newEraSyringePump.commandSeparator</a>],0);<span class="comment">%0.05</span>
</div><div id="_line0050" class="line">0050     
</div><div id="_line0051" class="line">0051     
</div><div id="_line0052" class="line">0052 <span class="comment">%     a=char(IOPort('Read',h)); %clear buffer</span>
</div><div id="_line0053" class="line">0053     <span class="comment">%now read and store the current Volumes at the beginning of the</span>
</div><div id="_line0054" class="line">0054     <span class="comment">%experiment. Don't reset to allow a volume that caputre the volume</span>
</div><div id="_line0055" class="line">0055     <span class="comment">%dispensed over a whole session</span>
</div><div id="_line0056" class="line">0056     [volumeGiven,volumeWithdrawn] = <a href="pds.newEraSyringePump.getVolume.html" class="code" title="function [volumeGiven,volumeWithdrawn] = getVolume(p)">pds.newEraSyringePump.getVolume</a>(p);
</div><div id="_line0057" class="line">0057     p.trial<a href="../../../Parameters/newEraSyringePump/initialVolumeGiven.html" class="param" title="">.newEraSyringePump.initialVolumeGiven</a> = volumeGiven;
</div><div id="_line0058" class="line">0058     p.trial<a href="../../../Parameters/newEraSyringePump/initialVolumeWithdrawn.html" class="param" title="">.newEraSyringePump.initialVolumeWithdrawn</a> = volumeWithdrawn;
</div><div id="_line0059" class="line">0059 <span class="keyword">end</span>
</div></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005
<br>
check <strong><a href="../../../index.html">here</a></strong> date of last update.
<br></address>
</body>
</html>