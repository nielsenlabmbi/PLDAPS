<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of setup</title>
  <meta name="keywords" content="setup">
  <meta name="description" content="pds.audio.setup(p)    loads audiofiles at the beginning of an experiment">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">PLDAPS</a> &gt; <a href="../index.html">+pds</a> &gt; <a href="index.html">+audio</a> &gt; setup.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for PLDAPS/+pds/+audio&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>pds.audio.setup
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>pds.audio.setup(p)    loads audiofiles at the beginning of an experiment</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function p = setup(p) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="description">pds.audio.setup(p)    loads audiofiles at the beginning of an experiment
 sets up the PsychAudio buffer and wavfile e.g. used to signal the start of
 a trial for the subject.

 (c) jly 2012
     jk  2015 changed to work with version 4.1 and changed to load all
              wavfiles in the wavfiles directory
     jly 2016 changed to handle audio slaves - deals with bug on linux</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../PLDAPS/@pldaps/replay.html" class="code" title="function p = replay(p,input)">@pldaps/replay</a>	replay    replay a previously recorded experiment on screen</li><li><a href="../../../PLDAPS/@pldaps/run.html" class="code" title="function p = run(p)">@pldaps/run</a>	run    run a new experiment for a previuously created pldaps class</li></ul>
<!-- crossreference -->

<!-- parameterreference -->
<h2><a name="_cross"></a>PARAMETER USAGE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function uses these parameters:
<ul >
<li><a href="../../../Parameters/pldaps/dirs/wavfiles.html" class="param" title="directory for sound files">.pldaps.dirs.wavfiles:</a>	
        <a href="#_line0014" class="code"}">14 </a>directory for sound files</li><li><a href="../../../Parameters/sound/index.html" class="param" title="contol sound playback">.sound:</a>	
        <a href="#_line0050" class="code"}">50 </a>contol sound playback</li><li><a href="../../../Parameters/sound/deviceid.html" class="param" title="PsychPortAudio deviceid, empty for default">.sound.deviceid:</a>	
        <a href="#_line0026" class="code"}">26 </a>    <a href="#_line0028" class="code"}">28 </a>    <a href="#_line0029" class="code"}">29 </a>    <a href="#_line0032" class="code"}">32 </a>PsychPortAudio deviceid, empty for default</li><li><a href="../../../Parameters/sound/master.html" class="param" title="">.sound.master:</a>	
        <a href="#_line0030" class="code"}">30 </a>    <a href="#_line0033" class="code"}">33 </a>    <a href="#_line0037" class="code"}">37 </a>    <a href="#_line0047" class="code"}">47 </a></li><li><a href="../../../Parameters/sound/use.html" class="param" title="toogle use of sound">.sound.use:</a>	
        <a href="#_line0010" class="code"}">10 </a>toogle use of sound</li><li><a href="../../../Parameters/sound/wavfiles.html" class="param" title="">.sound.wavfiles:</a>	
        <a href="#_line0044" class="code"}">44 </a></li></ul>
This function assigns these parameters:
<ul>
<li><a href="../../../Parameters/sound/index.html" class="param" title="contol sound playback">.sound:</a>
        <a href="#_line0047" class="code"}">47 </a>contol sound playback</li><li><a href="../../../Parameters/sound/master.html" class="param" title="">.sound.master:</a>
        <a href="#_line0029" class="code"}">29 </a>    <a href="#_line0032" class="code"}">32 </a></li><li><a href="../../../Parameters/sound/use.html" class="param" title="toogle use of sound">.sound.use:</a>
        <a href="#_line0053" class="code"}">53 </a>toogle use of sound</li><li><a href="../../../Parameters/sound/wavfiles.html" class="param" title="">.sound.wavfiles:</a>
        <a href="#_line0042" class="code"}">42 </a></li></ul>
<!-- parameterreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre><div id="_line0001" class="line">0001 <a name="_sub0" href="#_subfunctions" class="code">function p = setup(p)</a>
</div><div id="_line0002" class="line">0002 <span class="comment">%pds.audio.setup(p)    loads audiofiles at the beginning of an experiment</span>
</div><div id="_line0003" class="line">0003 <span class="comment">% sets up the PsychAudio buffer and wavfile e.g. used to signal the start of</span>
</div><div id="_line0004" class="line">0004 <span class="comment">% a trial for the subject.</span>
</div><div id="_line0005" class="line">0005 <span class="comment">%</span>
</div><div id="_line0006" class="line">0006 <span class="comment">% (c) jly 2012</span>
</div><div id="_line0007" class="line">0007 <span class="comment">%     jk  2015 changed to work with version 4.1 and changed to load all</span>
</div><div id="_line0008" class="line">0008 <span class="comment">%              wavfiles in the wavfiles directory</span>
</div><div id="_line0009" class="line">0009 <span class="comment">%     jly 2016 changed to handle audio slaves - deals with bug on linux</span>
</div><div id="_line0010" class="line">0010 <span class="keyword">if</span> p.trial<a href="../../../Parameters/sound/use.html" class="param" title="toogle use of sound">.sound.use</a> &amp;&amp; isField(p.trial, <span class="string">'pldaps.dirs.wavfiles'</span>)
</div><div id="_line0011" class="line">0011     <span class="comment">% initalize</span>
</div><div id="_line0012" class="line">0012     InitializePsychSound;
</div><div id="_line0013" class="line">0013     
</div><div id="_line0014" class="line">0014     soundsDir = p.trial<a href="../../../Parameters/pldaps/dirs/wavfiles.html" class="param" title="directory for sound files">.pldaps.dirs.wavfiles</a>;
</div><div id="_line0015" class="line">0015     
</div><div id="_line0016" class="line">0016     soundDirFiles=dir(soundsDir);
</div><div id="_line0017" class="line">0017     soundDirFiles={soundDirFiles.name};
</div><div id="_line0018" class="line">0018     soundFiles=find(~cellfun(@isempty,strfind(soundDirFiles,<span class="string">'.wav'</span>)));
</div><div id="_line0019" class="line">0019     
</div><div id="_line0020" class="line">0020     <span class="comment">% open a PsychPortAudio master device. Master devices themselves are</span>
</div><div id="_line0021" class="line">0021     <span class="comment">% not directly used to playback or capture sound. Instead one can</span>
</div><div id="_line0022" class="line">0022     <span class="comment">% create (multiple) slave devices that are attached to a master device.</span>
</div><div id="_line0023" class="line">0023     <span class="comment">% Each slave can be controlled independently to playback or record</span>
</div><div id="_line0024" class="line">0024     <span class="comment">% sound through a subset of the channels of the master device. This</span>
</div><div id="_line0025" class="line">0025     <span class="comment">% basically allows to virtualixe a soundcard.</span>
</div><div id="_line0026" class="line">0026     <span class="keyword">if</span> ~isempty(p.trial<a href="../../../Parameters/sound/deviceid.html" class="param" title="PsychPortAudio deviceid, empty for default">.sound.deviceid</a>)
</div><div id="_line0027" class="line">0027         devices=PsychPortAudio(<span class="string">'GetDevices'</span>);
</div><div id="_line0028" class="line">0028         deviceId=[devices.DeviceIndex]==p.trial<a href="../../../Parameters/sound/deviceid.html" class="param" title="PsychPortAudio deviceid, empty for default">.sound.deviceid</a>;
</div><div id="_line0029" class="line">0029         p.trial<a href="../../../Parameters/sound/master.html" class="param" title="">.sound.master</a>=PsychPortAudio(<span class="string">'Open'</span>, p.trial<a href="../../../Parameters/sound/deviceid.html" class="param" title="PsychPortAudio deviceid, empty for default">.sound.deviceid</a>, 1+8, 1, devices(deviceId).DefaultSampleRate, 2);
</div><div id="_line0030" class="line">0030         PsychPortAudio(<span class="string">'Start'</span>, p.trial<a href="../../../Parameters/sound/master.html" class="param" title="">.sound.master</a>, 0, 0, 1);
</div><div id="_line0031" class="line">0031     <span class="keyword">else</span> <span class="comment">% load with default settings</span>
</div><div id="_line0032" class="line">0032         p.trial<a href="../../../Parameters/sound/master.html" class="param" title="">.sound.master</a>=PsychPortAudio(<span class="string">'Open'</span>, p.trial<a href="../../../Parameters/sound/deviceid.html" class="param" title="PsychPortAudio deviceid, empty for default">.sound.deviceid</a>, 1+8, 1, [], []);
</div><div id="_line0033" class="line">0033         PsychPortAudio(<span class="string">'Start'</span>, p.trial<a href="../../../Parameters/sound/master.html" class="param" title="">.sound.master</a>, 0, 0, 1);
</div><div id="_line0034" class="line">0034     <span class="keyword">end</span>
</div><div id="_line0035" class="line">0035         
</div><div id="_line0036" class="line">0036     <span class="comment">% set the volume of the master to half the system volume</span>
</div><div id="_line0037" class="line">0037     PsychPortAudio(<span class="string">'Volume'</span>, p.trial<a href="../../../Parameters/sound/master.html" class="param" title="">.sound.master</a>, 0.5);
</div><div id="_line0038" class="line">0038     
</div><div id="_line0039" class="line">0039     <span class="comment">% open slave devices for eash audio file</span>
</div><div id="_line0040" class="line">0040     <span class="keyword">for</span> iFile=soundFiles
</div><div id="_line0041" class="line">0041         name= soundDirFiles{iFile};
</div><div id="_line0042" class="line">0042         p.trial<a href="../../../Parameters/sound/wavfiles.html" class="param" title="">.sound.wavfiles</a>.(name(1:end-4))=fullfile(soundsDir,name);
</div><div id="_line0043" class="line">0043         
</div><div id="_line0044" class="line">0044         [y, ~] = audioread(p.trial<a href="../../../Parameters/sound/wavfiles.html" class="param" title="">.sound.wavfiles</a>.(name(1:end-4)));
</div><div id="_line0045" class="line">0045         wav1 = y';
</div><div id="_line0046" class="line">0046         nChannels1 = size(wav1, 1);
</div><div id="_line0047" class="line">0047         p.trial<a href="../../../Parameters/sound/index.html" class="param" title="contol sound playback">.sound</a>.(name(1:end-4)) = PsychPortAudio(<span class="string">'OpenSlave'</span>, p.trial<a href="../../../Parameters/sound/master.html" class="param" title="">.sound.master</a>, 1, nChannels1);
</div><div id="_line0048" class="line">0048         
</div><div id="_line0049" class="line">0049         
</div><div id="_line0050" class="line">0050         PsychPortAudio(<span class="string">'FillBuffer'</span>,p.trial<a href="../../../Parameters/sound/index.html" class="param" title="contol sound playback">.sound</a>.(name(1:end-4)), wav1);
</div><div id="_line0051" class="line">0051     <span class="keyword">end</span>
</div><div id="_line0052" class="line">0052 <span class="keyword">else</span>
</div><div id="_line0053" class="line">0053     p.trial<a href="../../../Parameters/sound/use.html" class="param" title="toogle use of sound">.sound.use</a>=false;
</div><div id="_line0054" class="line">0054 <span class="keyword">end</span>
</div></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005
<br>
check <strong><a href="../../../index.html">here</a></strong> date of last update.
<br></address>
</body>
</html>