<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of getData</title>
  <meta name="keywords" content="getData">
  <meta name="description" content="pds.datapixx.adc.getData    getData from the Datapixx buffer">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="../../../index.html">PLDAPS</a> &gt; <a href="../../index.html">+pds</a> &gt; <a href="../index.html">+datapixx</a> &gt; <a href="index.html">+adc</a> &gt; getData.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for PLDAPS/+pds/+datapixx/+adc&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>pds.datapixx.adc.getData
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>pds.datapixx.adc.getData    getData from the Datapixx buffer</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function p = getData(p) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="description">pds.datapixx.adc.getData    getData from the Datapixx buffer

 p = pds.datapixx.adc.getData(p) 

 Retrieves new samples from the datapixx buffer during the trial
 (c) lnk 2012
     jly modified 2013
     jk  reqrote  2014 to use new parameter structure and add flexibilty
                       and proper tracking of sample times</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="stop.html" class="code" title="function p = stop(p)">pds.datapixx.adc.stop</a>	stops datapixx data aquisition</li><li><a href="../../../../PLDAPS/SupportFunctions/pldapsDefaultTrialFunction.html" class="code" title="function pldapsDefaultTrialFunction(p,state)">pldapsDefaultTrialFunction</a>	</li></ul>
<!-- crossreference -->

<!-- parameterreference -->
<h2><a name="_cross"></a>PARAMETER USAGE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function uses these parameters:
<ul >
<li><a href="../../../../Parameters/datapixx/adc/XEyeposChannel.html" class="param" title="if datapixx.useAsEyepos=true, use this channel set eyeX">.datapixx.adc.XEyeposChannel:</a>	
        <a href="#_line0047" class="code"}">47 </a>if datapixx.useAsEyepos=true, use this channel set eyeX</li><li><a href="../../../../Parameters/datapixx/adc/YEyeposChannel.html" class="param" title="if datapixx.useAsEyepos=true, use this channel set eyeY">.datapixx.adc.YEyeposChannel:</a>	
        <a href="#_line0048" class="code"}">48 </a>if datapixx.useAsEyepos=true, use this channel set eyeY</li><li><a href="../../../../Parameters/datapixx/adc/channelGains.html" class="param" title="Apply a gain to collected data.">.datapixx.adc.channelGains:</a>	
        <a href="#_line0029" class="code"}">29 </a>Apply a gain to collected data.</li><li><a href="../../../../Parameters/datapixx/adc/channelMappingChannelInds.html" class="param" title="">.datapixx.adc.channelMappingChannelInds:</a>	
        <a href="#_line0044" class="code"}">44 </a></li><li><a href="../../../../Parameters/datapixx/adc/channelMappingChannels.html" class="param" title="">.datapixx.adc.channelMappingChannels:</a>	
        <a href="#_line0038" class="code"}">38 </a>    <a href="#_line0047" class="code"}">47 </a>    <a href="#_line0048" class="code"}">48 </a></li><li><a href="../../../../Parameters/datapixx/adc/channelMappingSubs.html" class="param" title="">.datapixx.adc.channelMappingSubs:</a>	
        <a href="#_line0041" class="code"}">41 </a></li><li><a href="../../../../Parameters/datapixx/adc/channelOffsets.html" class="param" title="Apply an offset to collected data.">.datapixx.adc.channelOffsets:</a>	
        <a href="#_line0029" class="code"}">29 </a>Apply an offset to collected data.</li><li><a href="../../../../Parameters/datapixx/adc/channels.html" class="param" title="List of channels to collect data from.">.datapixx.adc.channels:</a>	
        <a href="#_line0012" class="code"}">12 </a>List of channels to collect data from.</li><li><a href="../../../../Parameters/datapixx/adc/dataSampleCount.html" class="param" title="">.datapixx.adc.dataSampleCount:</a>	
        <a href="#_line0031" class="code"}">31 </a>    <a href="#_line0032" class="code"}">32 </a>    <a href="#_line0052" class="code"}">52 </a>    <a href="#_line0052" class="code"}">52 </a>    <a href="#_line0056" class="code"}">56 </a>    <a href="#_line0065" class="code"}">65 </a>    <a href="#_line0065" class="code"}">65 </a>    <a href="#_line0069" class="code"}">69 </a></li><li><a href="../../../../Parameters/datapixx/use.html" class="param" title="enable control of VPixx devices">.datapixx.use:</a>	
        <a href="#_line0012" class="code"}">12 </a>enable control of VPixx devices</li><li><a href="../../../../Parameters/datapixx/useAsEyepos.html" class="param" title="use Datapixx adc inputs as eye position.">.datapixx.useAsEyepos:</a>	
        <a href="#_line0046" class="code"}">46 </a>use Datapixx adc inputs as eye position.</li><li><a href="../../../../Parameters/pldaps/eyeposMovAv.html" class="param" title="average the eyeposition (.eyeX and .eyeY) over this many samples.">.pldaps.eyeposMovAv:</a>	
        <a href="#_line0051" class="code"}">51 </a>    <a href="#_line0052" class="code"}">52 </a>    <a href="#_line0064" class="code"}">64 </a>    <a href="#_line0065" class="code"}">65 </a>average the eyeposition (.eyeX and .eyeY) over this many samples.</li></ul>
This function assigns these parameters:
<ul>
<li><a href="../../../../Parameters/datapixx/adc/dataSampleCount.html" class="param" title="">.datapixx.adc.dataSampleCount:</a>
        <a href="#_line0034" class="code"}">34 </a></li><li><a href="../../../../Parameters/datapixx/adc/dataSampleTimes.html" class="param" title="">.datapixx.adc.dataSampleTimes:</a>
        <a href="#_line0036" class="code"}">36 </a></li><li><a href="../../../../Parameters/datapixx/adc/status.html" class="param" title="">.datapixx.adc.status:</a>
        <a href="#_line0019" class="code"}">19 </a></li><li><a href="../../../../Parameters/eyeX.html" class="param" title="">.eyeX:</a>
        <a href="#_line0054" class="code"}">54 </a>    <a href="#_line0058" class="code"}">58 </a>    <a href="#_line0067" class="code"}">67 </a>    <a href="#_line0071" class="code"}">71 </a></li></ul>
<!-- parameterreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre><div id="_line0001" class="line">0001 <a name="_sub0" href="#_subfunctions" class="code">function p = getData(p)</a>
</div><div id="_line0002" class="line">0002 <span class="comment">%pds.datapixx.adc.getData    getData from the Datapixx buffer</span>
</div><div id="_line0003" class="line">0003 <span class="comment">%</span>
</div><div id="_line0004" class="line">0004 <span class="comment">% p = pds.datapixx.adc.getData(p)</span>
</div><div id="_line0005" class="line">0005 <span class="comment">%</span>
</div><div id="_line0006" class="line">0006 <span class="comment">% Retrieves new samples from the datapixx buffer during the trial</span>
</div><div id="_line0007" class="line">0007 <span class="comment">% (c) lnk 2012</span>
</div><div id="_line0008" class="line">0008 <span class="comment">%     jly modified 2013</span>
</div><div id="_line0009" class="line">0009 <span class="comment">%     jk  reqrote  2014 to use new parameter structure and add flexibilty</span>
</div><div id="_line0010" class="line">0010 <span class="comment">%                       and proper tracking of sample times</span>
</div><div id="_line0011" class="line">0011 
</div><div id="_line0012" class="line">0012 <span class="keyword">if</span> ~p.trial<a href="../../../../Parameters/datapixx/use.html" class="param" title="enable control of VPixx devices">.datapixx.use</a> || isempty(p.trial<a href="../../../../Parameters/datapixx/adc/channels.html" class="param" title="List of channels to collect data from.">.datapixx.adc.channels</a>)
</div><div id="_line0013" class="line">0013     <span class="keyword">return</span>;
</div><div id="_line0014" class="line">0014 <span class="keyword">end</span>
</div><div id="_line0015" class="line">0015 
</div><div id="_line0016" class="line">0016 <span class="comment">%consider having a preallocated bufferData and bufferTimeTags</span>
</div><div id="_line0017" class="line">0017 Datapixx(<span class="string">'RegWrRd'</span>);
</div><div id="_line0018" class="line">0018 adcStatus = Datapixx(<span class="string">'GetAdcStatus'</span>);
</div><div id="_line0019" class="line">0019 p.trial<a href="../../../../Parameters/datapixx/adc/status.html" class="param" title="">.datapixx.adc.status</a> = adcStatus;
</div><div id="_line0020" class="line">0020 [bufferData, bufferTimetags, underflow, overflow] = Datapixx(<span class="string">'ReadAdcBuffer'</span>, adcStatus.newBufferFrames,-1);
</div><div id="_line0021" class="line">0021 <span class="keyword">if</span> underflow
</div><div id="_line0022" class="line">0022     warning(<span class="string">'pds:datapixxadcgetData'</span>,<span class="string">'underflow: getData is called to often'</span>);
</div><div id="_line0023" class="line">0023 <span class="keyword">end</span>
</div><div id="_line0024" class="line">0024 <span class="keyword">if</span> overflow
</div><div id="_line0025" class="line">0025     warning(<span class="string">'pds:datapixxadcgetData'</span>,<span class="string">'overflow: getData was not called often enough. Some data is lost.'</span>);
</div><div id="_line0026" class="line">0026 <span class="keyword">end</span>
</div><div id="_line0027" class="line">0027 
</div><div id="_line0028" class="line">0028 <span class="comment">%transform data:</span>
</div><div id="_line0029" class="line">0029 bufferData=diag(p.trial<a href="../../../../Parameters/datapixx/adc/channelGains.html" class="param" title="Apply a gain to collected data.">.datapixx.adc.channelGains</a>)*(bufferData+diag(p.trial<a href="../../../../Parameters/datapixx/adc/channelOffsets.html" class="param" title="Apply an offset to collected data.">.datapixx.adc.channelOffsets</a>)*ones(size(bufferData)));
</div><div id="_line0030" class="line">0030 
</div><div id="_line0031" class="line">0031 starti=p.trial<a href="../../../../Parameters/datapixx/adc/dataSampleCount.html" class="param" title="">.datapixx.adc.dataSampleCount</a>+1;
</div><div id="_line0032" class="line">0032 endi=p.trial<a href="../../../../Parameters/datapixx/adc/dataSampleCount.html" class="param" title="">.datapixx.adc.dataSampleCount</a>+adcStatus.newBufferFrames;
</div><div id="_line0033" class="line">0033 inds=starti:endi;
</div><div id="_line0034" class="line">0034 p.trial<a href="../../../../Parameters/datapixx/adc/dataSampleCount.html" class="param" title="">.datapixx.adc.dataSampleCount</a>=endi;
</div><div id="_line0035" class="line">0035 
</div><div id="_line0036" class="line">0036 p.trial<a href="../../../../Parameters/datapixx/adc/dataSampleTimes.html" class="param" title="">.datapixx.adc.dataSampleTimes</a>(inds)=bufferTimetags;
</div><div id="_line0037" class="line">0037 
</div><div id="_line0038" class="line">0038 nMaps=length(p.trial<a href="../../../../Parameters/datapixx/adc/channelMappingChannels.html" class="param" title="">.datapixx.adc.channelMappingChannels</a>);
</div><div id="_line0039" class="line">0039 <span class="keyword">for</span> imap=1:nMaps
</div><div id="_line0040" class="line">0040 <span class="comment">%     iChannels=p.trial.datapixx.adc.channelMappingChannels{imap};</span>
</div><div id="_line0041" class="line">0041     iSub = p.trial<a href="../../../../Parameters/datapixx/adc/channelMappingSubs.html" class="param" title="">.datapixx.adc.channelMappingSubs</a>{imap};
</div><div id="_line0042" class="line">0042     iSub(end).subs{2}=inds;
</div><div id="_line0043" class="line">0043     
</div><div id="_line0044" class="line">0044     p=subsasgn(p,iSub,bufferData(p.trial<a href="../../../../Parameters/datapixx/adc/channelMappingChannelInds.html" class="param" title="">.datapixx.adc.channelMappingChannelInds</a>{imap},:));
</div><div id="_line0045" class="line">0045     
</div><div id="_line0046" class="line">0046     <span class="keyword">if</span> p.trial<a href="../../../../Parameters/datapixx/useAsEyepos.html" class="param" title="use Datapixx adc inputs as eye position.">.datapixx.useAsEyepos</a>
</div><div id="_line0047" class="line">0047         xChannel=p.trial<a href="../../../../Parameters/datapixx/adc/XEyeposChannel.html" class="param" title="if datapixx.useAsEyepos=true, use this channel set eyeX">.datapixx.adc.XEyeposChannel</a>==p.trial<a href="../../../../Parameters/datapixx/adc/channelMappingChannels.html" class="param" title="">.datapixx.adc.channelMappingChannels</a>;
</div><div id="_line0048" class="line">0048         yChannel=p.trial<a href="../../../../Parameters/datapixx/adc/YEyeposChannel.html" class="param" title="if datapixx.useAsEyepos=true, use this channel set eyeY">.datapixx.adc.YEyeposChannel</a>==p.trial<a href="../../../../Parameters/datapixx/adc/channelMappingChannels.html" class="param" title="">.datapixx.adc.channelMappingChannels</a>;
</div><div id="_line0049" class="line">0049         <span class="keyword">if</span> any(xChannel)
</div><div id="_line0050" class="line">0050             iSub(end).subs{1}=xChannel;
</div><div id="_line0051" class="line">0051             <span class="keyword">if</span> p.trial<a href="../../../../Parameters/pldaps/eyeposMovAv.html" class="param" title="average the eyeposition (.eyeX and .eyeY) over this many samples.">.pldaps.eyeposMovAv</a>&gt;1
</div><div id="_line0052" class="line">0052                 dInds=(p.trial<a href="../../../../Parameters/datapixx/adc/dataSampleCount.html" class="param" title="">.datapixx.adc.dataSampleCount</a>-p.trial<a href="../../../../Parameters/pldaps/eyeposMovAv.html" class="param" title="average the eyeposition (.eyeX and .eyeY) over this many samples.">.pldaps.eyeposMovAv</a>+1):p.trial<a href="../../../../Parameters/datapixx/adc/dataSampleCount.html" class="param" title="">.datapixx.adc.dataSampleCount</a>;
</div><div id="_line0053" class="line">0053                 iSub(end).subs{2}=dInds;
</div><div id="_line0054" class="line">0054                 p.trial<a href="../../../../Parameters/eyeX.html" class="param" title="">.eyeX</a> = mean(subsref(p,iSub));
</div><div id="_line0055" class="line">0055             <span class="keyword">else</span>
</div><div id="_line0056" class="line">0056                 dInds=p.trial<a href="../../../../Parameters/datapixx/adc/dataSampleCount.html" class="param" title="">.datapixx.adc.dataSampleCount</a>;
</div><div id="_line0057" class="line">0057                 iSub(end).subs{2}=dInds;
</div><div id="_line0058" class="line">0058                 p.trial<a href="../../../../Parameters/eyeX.html" class="param" title="">.eyeX</a> = subsref(p,iSub);
</div><div id="_line0059" class="line">0059             <span class="keyword">end</span>
</div><div id="_line0060" class="line">0060              
</div><div id="_line0061" class="line">0061         <span class="keyword">elseif</span> any(yChannel)
</div><div id="_line0062" class="line">0062             iSub(end).subs{1}=yChannel;
</div><div id="_line0063" class="line">0063             
</div><div id="_line0064" class="line">0064             <span class="keyword">if</span> p.trial<a href="../../../../Parameters/pldaps/eyeposMovAv.html" class="param" title="average the eyeposition (.eyeX and .eyeY) over this many samples.">.pldaps.eyeposMovAv</a>&gt;1
</div><div id="_line0065" class="line">0065                 dInds=(p.trial<a href="../../../../Parameters/datapixx/adc/dataSampleCount.html" class="param" title="">.datapixx.adc.dataSampleCount</a>-p.trial<a href="../../../../Parameters/pldaps/eyeposMovAv.html" class="param" title="average the eyeposition (.eyeX and .eyeY) over this many samples.">.pldaps.eyeposMovAv</a>+1):p.trial<a href="../../../../Parameters/datapixx/adc/dataSampleCount.html" class="param" title="">.datapixx.adc.dataSampleCount</a>;
</div><div id="_line0066" class="line">0066                 iSub(end).subs{2}=dInds;
</div><div id="_line0067" class="line">0067                 p.trial<a href="../../../../Parameters/eyeX.html" class="param" title="">.eyeX</a> = mean(subsref(p,iSub));
</div><div id="_line0068" class="line">0068             <span class="keyword">else</span>
</div><div id="_line0069" class="line">0069                 dInds=p.trial<a href="../../../../Parameters/datapixx/adc/dataSampleCount.html" class="param" title="">.datapixx.adc.dataSampleCount</a>;
</div><div id="_line0070" class="line">0070                 iSub(end).subs{2}=dInds;
</div><div id="_line0071" class="line">0071                 p.trial<a href="../../../../Parameters/eyeX.html" class="param" title="">.eyeX</a> = subsref(p,iSub);
</div><div id="_line0072" class="line">0072             <span class="keyword">end</span>
</div><div id="_line0073" class="line">0073         <span class="keyword">end</span>
</div><div id="_line0074" class="line">0074     <span class="keyword">end</span>  
</div><div id="_line0075" class="line">0075 <span class="keyword">end</span>
</div></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005
<br>
check <strong><a href="../../../../index.html">here</a></strong> date of last update.
<br></address>
</body>
</html>