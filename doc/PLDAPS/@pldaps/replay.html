<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of replay</title>
  <meta name="keywords" content="replay">
  <meta name="description" content="replay    replay a previously recorded experiment on screen">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">PLDAPS</a> &gt; <a href="index.html">@pldaps</a> &gt; replay.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for PLDAPS/@pldaps&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>@pldaps/replay
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>replay    replay a previously recorded experiment on screen</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function p = replay(p,input) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="description">replay    replay a previously recorded experiment on screen
 this is a modified version of pldaps.run
 p = replay(p, input)
 p is a pldaps class, with display settings defined as they should be for
       the new screen
 input is the filename of a recorded experiment</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../PLDAPS/+pds/+audio/setup.html" class="code" title="function p = setup(p)">pds.audio.setup</a>	pds.audio.setup(p)    loads audiofiles at the beginning of an experiment</li><li><a href="../../PLDAPS/+pds/+datapixx/+adc/stop.html" class="code" title="function p = stop(p)">pds.datapixx.adc.stop</a>	stops datapixx data aquisition</li><li><a href="../../PLDAPS/+pds/+datapixx/analogOut.html" class="code" title="function analogOut(open_time, chan, TTLamp)">pds.datapixx.analogOut</a>	datapixxanalogOut    Send a TTL pulse through the Analog Out</li><li><a href="../../PLDAPS/+pds/+datapixx/flipBit.html" class="code" title="function timings=flipBit(bit,trial)">pds.datapixx.flipBit</a>	pds.datapixx.flipBit    flip a bit on the digital out of the Datapixx</li><li><a href="../../PLDAPS/+pds/+datapixx/init.html" class="code" title="function p =  init(p)">pds.datapixx.init</a>	pds.datapixx.init    initialize Datapixx at the beginning of an experiment.</li><li><a href="../../PLDAPS/+pds/+eyelink/calibrate.html" class="code" title="function p=calibrate(p)">pds.eyelink.calibrate</a>	pds.eyelink.calibrate    start eyelink calibration routines</li><li><a href="../../PLDAPS/+pds/+eyelink/finish.html" class="code" title="function p = finish(p)">pds.eyelink.finish</a>	pds.eyelink.finish    stop recording on eyelink</li><li><a href="../../PLDAPS/+pds/+eyelink/setup.html" class="code" title="function p = setup(p)">pds.eyelink.setup</a>	pds.eyelink.setup    setup eyelink at the beginning of an experiment</li><li><a href="../../PLDAPS/+pds/+git/setup.html" class="code" title="function p = setup(p)">pds.git.setup</a>	pds.git.setup   retrieves and stores git info about relevant directories</li><li><a href="../../PLDAPS/+pds/+keyboard/setup.html" class="code" title="function p = setup(p,scan)">pds.keyboard.setup</a>	pds.git.setup   setup the keyboard queue</li><li><a href="../../PLDAPS/+pds/+plexon/+spikeserver/connect.html" class="code" title="function p = connect(p)">pds.plexon.spikeserver.connect</a>	pds.plexon.spikeserver.connect   connect to a remote plexon spikeserver</li><li><a href="../../PLDAPS/+pds/+plexon/+spikeserver/disconnect.html" class="code" title="function p = disconnect(p)">pds.plexon.spikeserver.disconnect</a>	pds.plexon.spikeserver.disconnect   disconnects the remote plexon spikeserver</li><li><a href="../../PLDAPS/@params/params.html" class="code" title="function p=params(s,sN,active)">@params/params</a>	PARAMS    A hierarchical parameter handling class</li><li><a href="beginExperiment.html" class="code" title="function p = beginExperiment(p)">@pldaps/beginExperiment</a>	beginExperiment    initialize an Exeriment</li><li><a href="openScreen.html" class="code" title="function p = openScreen(p)">@pldaps/openScreen</a>	openScreen    opens PsychImaging Window with preferences set for special</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="runModularTrial.html" class="code" title="function p = runModularTrial(p, replay)">@pldaps/runModularTrial</a>	runModularTrial    runs a single Trial by calling the functions defined in</li></ul>
<!-- crossreference -->

<!-- parameterreference -->
<h2><a name="_cross"></a>PARAMETER USAGE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function uses these parameters:
<ul >
<li><a href="../../Parameters/addLevels.html" class="param" title="">.addLevels:</a>	
        <a href="#_line0190" class="code"}">190 </a></li><li><a href="../../Parameters/datapixx/LogOnsetTimestampLevel.html" class="param" title="Get and Store a the time each frame arrived at the VPixx device.">.datapixx.LogOnsetTimestampLevel:</a>	
        <a href="#_line0118" class="code"}">118 </a>Get and Store a the time each frame arrived at the VPixx device.</li><li><a href="../../Parameters/datapixx/use.html" class="param" title="enable control of VPixx devices">.datapixx.use:</a>	
        <a href="#_line0047" class="code"}">47 </a>    <a href="#_line0228" class="code"}">228 </a>    <a href="#_line0288" class="code"}">288 </a>enable control of VPixx devices</li><li><a href="../../Parameters/display/index.html" class="param" title="specify options for the screen.">.display:</a>	
        <a href="#_line0039" class="code"}">39 </a>specify options for the screen.</li><li><a href="../../Parameters/display/clut/index.html" class="param" title="">.display.clut:</a>	
        <a href="#_line0048" class="code"}">48 </a>    <a href="#_line0050" class="code"}">50 </a></li><li><a href="../../Parameters/display/humanCLUT.html" class="param" title="">.display.humanCLUT:</a>	
        <a href="#_line0051" class="code"}">51 </a></li><li><a href="../../Parameters/display/movie/create.html" class="param" title="toggle movie creation">.display.movie.create:</a>	
        <a href="#_line0238" class="code"}">238 </a>toggle movie creation</li><li><a href="../../Parameters/display/movie/ptr.html" class="param" title="">.display.movie.ptr:</a>	
        <a href="#_line0239" class="code"}">239 </a></li><li><a href="../../Parameters/display/pHeight.html" class="param" title="">.display.pHeight:</a>	
        <a href="#_line0095" class="code"}">95 </a></li><li><a href="../../Parameters/display/pWidth.html" class="param" title="">.display.pWidth:</a>	
        <a href="#_line0094" class="code"}">94 </a></li><li><a href="../../Parameters/event/REWARD.html" class="param" title="">.event.REWARD:</a>	
        <a href="#_line0290" class="code"}">290 </a></li><li><a href="../../Parameters/eyelink/use.html" class="param" title="use the eyelink moduke">.eyelink.use:</a>	
        <a href="#_line0279" class="code"}">279 </a>use the eyelink moduke</li><li><a href="../../Parameters/getAllLevels.html" class="param" title="">.getAllLevels:</a>	
        <a href="#_line0191" class="code"}">191 </a></li><li><a href="../../Parameters/getAllStructs.html" class="param" title="">.getAllStructs:</a>	
        <a href="#_line0024" class="code"}">24 </a>    <a href="#_line0209" class="code"}">209 </a></li><li><a href="../../Parameters/iReward.html" class="param" title="">.iReward:</a>	
        <a href="#_line0294" class="code"}">294 </a></li><li><a href="../../Parameters/keyboard/codes/Lalt.html" class="param" title="">.keyboard.codes.Lalt:</a>	
        <a href="#_line0270" class="code"}">270 </a></li><li><a href="../../Parameters/keyboard/codes/Lctrl.html" class="param" title="">.keyboard.codes.Lctrl:</a>	
        <a href="#_line0270" class="code"}">270 </a></li><li><a href="../../Parameters/keyboard/codes/dKey.html" class="param" title="">.keyboard.codes.dKey:</a>	
        <a href="#_line0272" class="code"}">272 </a></li><li><a href="../../Parameters/keyboard/codes/eKey.html" class="param" title="">.keyboard.codes.eKey:</a>	
        <a href="#_line0277" class="code"}">277 </a></li><li><a href="../../Parameters/keyboard/codes/mKey.html" class="param" title="">.keyboard.codes.mKey:</a>	
        <a href="#_line0287" class="code"}">287 </a></li><li><a href="../../Parameters/keyboard/codes/pKey.html" class="param" title="">.keyboard.codes.pKey:</a>	
        <a href="#_line0298" class="code"}">298 </a></li><li><a href="../../Parameters/keyboard/codes/qKey.html" class="param" title="">.keyboard.codes.qKey:</a>	
        <a href="#_line0305" class="code"}">305 </a></li><li><a href="../../Parameters/keyboard/codes/xKey.html" class="param" title="">.keyboard.codes.xKey:</a>	
        <a href="#_line0310" class="code"}">310 </a></li><li><a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ:</a>	
        <a href="#_line0270" class="code"}">270 </a>    <a href="#_line0270" class="code"}">270 </a>    <a href="#_line0272" class="code"}">272 </a>    <a href="#_line0277" class="code"}">277 </a>    <a href="#_line0287" class="code"}">287 </a>    <a href="#_line0298" class="code"}">298 </a>    <a href="#_line0305" class="code"}">305 </a>    <a href="#_line0310" class="code"}">310 </a></li><li><a href="../../Parameters/mergeToSingleStruct.html" class="param" title="">.mergeToSingleStruct:</a>	
        <a href="#_line0161" class="code"}">161 </a></li><li><a href="../../Parameters/pldaps/finish.html" class="param" title="Number of trials to run. can be changed dynamically">.pldaps.finish:</a>	
        <a href="#_line0151" class="code"}">151 </a>Number of trials to run. can be changed dynamically</li><li><a href="../../Parameters/pldaps/iTrial.html" class="param" title="trial number. cannot be changed by the user">.pldaps.iTrial:</a>	
        <a href="#_line0151" class="code"}">151 </a>trial number. cannot be changed by the user</li><li><a href="../../Parameters/pldaps/pause/preExperiment.html" class="param" title="pause before experiment starts">.pldaps.pause.preExperiment:</a>	
        <a href="#_line0129" class="code"}">129 </a>pause before experiment starts</li><li><a href="../../Parameters/pldaps/pause/type.html" class="param" title="Only type 1 is currently tested.">.pldaps.pause.type:</a>	
        <a href="#_line0129" class="code"}">129 </a>    <a href="#_line0187" class="code"}">187 </a>Only type 1 is currently tested.</li><li><a href="../../Parameters/pldaps/quit.html" class="param" title="control expeiment during a trial.">.pldaps.quit:</a>	
        <a href="#_line0151" class="code"}">151 </a>    <a href="#_line0153" class="code"}">153 </a>control expeiment during a trial.</li><li><a href="../../Parameters/pldaps/trialFunction.html" class="param" title="">.pldaps.trialFunction:</a>	
        <a href="#_line0057" class="code"}">57 </a></li><li><a href="../../Parameters/pldaps/trialMasterFunction.html" class="param" title="function to be called to run a single Trial.">.pldaps.trialMasterFunction:</a>	
        <a href="#_line0166" class="code"}">166 </a>function to be called to run a single Trial.</li><li><a href="../../Parameters/replay/index.html" class="param" title="">.replay:</a>	
        <a href="#_line0172" class="code"}">172 </a></li><li><a href="../../Parameters/setLevels.html" class="param" title="">.setLevels:</a>	
        <a href="#_line0045" class="code"}">45 </a>    <a href="#_line0159" class="code"}">159 </a>    <a href="#_line0191" class="code"}">191 </a>    <a href="#_line0218" class="code"}">218 </a></li><li><a href="../../Parameters/setLock.html" class="param" title="">.setLock:</a>	
        <a href="#_line0163" class="code"}">163 </a>    <a href="#_line0169" class="code"}">169 </a></li><li><a href="../../Parameters/sound/reward.html" class="param" title="">.sound.reward:</a>	
        <a href="#_line0295" class="code"}">295 </a></li><li><a href="../../Parameters/stimulus/dots/XYd.html" class="param" title="">.stimulus.dots.XYd:</a>	
        <a href="#_line0175" class="code"}">175 </a></li><li><a href="../../Parameters/stimulus/rewardTime.html" class="param" title="">.stimulus.rewardTime:</a>	
        <a href="#_line0289" class="code"}">289 </a>    <a href="#_line0293" class="code"}">293 </a></li><li><a href="../../Parameters/trstart.html" class="param" title="">.trstart:</a>	
        <a href="#_line0292" class="code"}">292 </a></li><li><a href="../../Parameters/ttime.html" class="param" title="">.ttime:</a>	
        <a href="#_line0293" class="code"}">293 </a></li></ul>
This function assigns these parameters:
<ul>
<li><a href="../../Parameters/datapixx/timestamplog.html" class="param" title="">.datapixx.timestamplog:</a>
        <a href="#_line0234" class="code"}">234 </a></li><li><a href="../../Parameters/datapixx/use.html" class="param" title="enable control of VPixx devices">.datapixx.use:</a>
        <a href="#_line0059" class="code"}">59 </a>enable control of VPixx devices</li><li><a href="../../Parameters/display/bgColor.html" class="param" title="background color. Can be changed during trial">.display.bgColor:</a>
        <a href="#_line0082" class="code"}">82 </a>background color. Can be changed during trial</li><li><a href="../../Parameters/display/clut/index.html" class="param" title="">.display.clut:</a>
        <a href="#_line0051" class="code"}">51 </a></li><li><a href="../../Parameters/display/colorclamp.html" class="param" title="clampt colors to [0-1] range. Typically not necessary">.display.colorclamp:</a>
        <a href="#_line0076" class="code"}">76 </a>clampt colors to [0-1] range. Typically not necessary</li><li><a href="../../Parameters/display/forceLinearGamma.html" class="param" title="force a linear gamma table at the end of screen initiation.">.display.forceLinearGamma:</a>
        <a href="#_line0077" class="code"}">77 </a>force a linear gamma table at the end of screen initiation.</li><li><a href="../../Parameters/display/gamma/index.html" class="param" title="">.display.gamma:</a>
        <a href="#_line0080" class="code"}">80 </a></li><li><a href="../../Parameters/display/movie/index.html" class="param" title="optinal create of videos, typically used during replay">.display.movie:</a>
        <a href="#_line0078" class="code"}">78 </a>optinal create of videos, typically used during replay</li><li><a href="../../Parameters/display/screenSize.html" class="param" title="size of the window to create pixels in, leave empty for fullscreen">.display.screenSize:</a>
        <a href="#_line0073" class="code"}">73 </a>size of the window to create pixels in, leave empty for fullscreen</li><li><a href="../../Parameters/display/scrnNum.html" class="param" title="screen numer for fullscreen display">.display.scrnNum:</a>
        <a href="#_line0074" class="code"}">74 </a>screen numer for fullscreen display</li><li><a href="../../Parameters/display/useOverlay.html" class="param" title="create an overlay pointer.">.display.useOverlay:</a>
        <a href="#_line0075" class="code"}">75 </a>create an overlay pointer.</li><li><a href="../../Parameters/eyelink/use.html" class="param" title="use the eyelink moduke">.eyelink.use:</a>
        <a href="#_line0063" class="code"}">63 </a>use the eyelink moduke</li><li><a href="../../Parameters/iReward.html" class="param" title="">.iReward:</a>
        <a href="#_line0293" class="code"}">293 </a></li><li><a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ:</a>
        <a href="#_line0269" class="code"}">269 </a></li><li><a href="../../Parameters/keyboard/pressedQ.html" class="param" title="">.keyboard.pressedQ:</a>
        <a href="#_line0269" class="code"}">269 </a></li><li><a href="../../Parameters/pldaps/dirs/wavfiles.html" class="param" title="directory for sound files">.pldaps.dirs.wavfiles:</a>
        <a href="#_line0084" class="code"}">84 </a>directory for sound files</li><li><a href="../../Parameters/pldaps/finish.html" class="param" title="Number of trials to run. can be changed dynamically">.pldaps.finish:</a>
        <a href="#_line0148" class="code"}">148 </a>Number of trials to run. can be changed dynamically</li><li><a href="../../Parameters/pldaps/iTrial.html" class="param" title="trial number. cannot be changed by the user">.pldaps.iTrial:</a>
        <a href="#_line0145" class="code"}">145 </a>    <a href="#_line0160" class="code"}">160 </a>trial number. cannot be changed by the user</li><li><a href="../../Parameters/pldaps/pause/index.html" class="param" title="control pausing behavior of pldaps">.pldaps.pause:</a>
        <a href="#_line0066" class="code"}">66 </a>control pausing behavior of pldaps</li><li><a href="../../Parameters/pldaps/quit.html" class="param" title="control expeiment during a trial.">.pldaps.quit:</a>
        <a href="#_line0199" class="code"}">199 </a>    <a href="#_line0299" class="code"}">299 </a>    <a href="#_line0306" class="code"}">306 </a>control expeiment during a trial.</li><li><a href="../../Parameters/pldaps/trialMasterFunction.html" class="param" title="function to be called to run a single Trial.">.pldaps.trialMasterFunction:</a>
        <a href="#_line0058" class="code"}">58 </a>function to be called to run a single Trial.</li><li><a href="../../Parameters/plexon/spikeserver/use.html" class="param" title="toggle use of our plexon spikeserver">.plexon.spikeserver.use:</a>
        <a href="#_line0062" class="code"}">62 </a>toggle use of our plexon spikeserver</li><li><a href="../../Parameters/replay/xfactor.html" class="param" title="">.replay.xfactor:</a>
        <a href="#_line0094" class="code"}">94 </a></li><li><a href="../../Parameters/replay/yfactor.html" class="param" title="">.replay.yfactor:</a>
        <a href="#_line0095" class="code"}">95 </a></li><li><a href="../../Parameters/sound/flagBuzzer.html" class="param" title="">.sound.flagBuzzer:</a>
        <a href="#_line0060" class="code"}">60 </a></li><li><a href="../../Parameters/sound/use.html" class="param" title="toogle use of sound">.sound.use:</a>
        <a href="#_line0061" class="code"}">61 </a>toogle use of sound</li><li><a href="../../Parameters/stimulus/iReward.html" class="param" title="">.stimulus.iReward:</a>
        <a href="#_line0294" class="code"}">294 </a></li><li><a href="../../Parameters/stimulus/timeReward.html" class="param" title="">.stimulus.timeReward:</a>
        <a href="#_line0293" class="code"}">293 </a></li><li><a href="../../Parameters/ttime.html" class="param" title="">.ttime:</a>
        <a href="#_line0292" class="code"}">292 </a></li></ul>
<!-- parameterreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">pauseLoop</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre><div id="_line0001" class="line">0001 <a name="_sub0" href="#_subfunctions" class="code">function p = replay(p,input)</a>
</div><div id="_line0002" class="line">0002 <span class="comment">%replay    replay a previously recorded experiment on screen</span>
</div><div id="_line0003" class="line">0003 <span class="comment">% this is a modified version of pldaps.run</span>
</div><div id="_line0004" class="line">0004 <span class="comment">% p = replay(p, input)</span>
</div><div id="_line0005" class="line">0005 <span class="comment">% p is a pldaps class, with display settings defined as they should be for</span>
</div><div id="_line0006" class="line">0006 <span class="comment">%       the new screen</span>
</div><div id="_line0007" class="line">0007 <span class="comment">% input is the filename of a recorded experiment</span>
</div><div id="_line0008" class="line">0008 <span class="keyword">if</span> ischar(input)
</div><div id="_line0009" class="line">0009     load(input,<span class="string">'-mat'</span>);
</div><div id="_line0010" class="line">0010 <span class="keyword">else</span>
</div><div id="_line0011" class="line">0011     PDS=input;
</div><div id="_line0012" class="line">0012 <span class="keyword">end</span>
</div><div id="_line0013" class="line">0013 
</div><div id="_line0014" class="line">0014 <span class="comment">%get the trial Numbers form the condition Parameters</span>
</div><div id="_line0015" class="line">0015 conditionTrials=cellfun(@(x) textscan(x,<span class="string">'Trial%dParameters'</span>),PDS.conditionNames);
</div><div id="_line0016" class="line">0016 conditionTrials=[conditionTrials{:}];
</div><div id="_line0017" class="line">0017 
</div><div id="_line0018" class="line">0018 <span class="comment">%the initial Parameters have both all levels that are defined at the</span>
</div><div id="_line0019" class="line">0019 <span class="comment">%ebginning at the experiment, but also newer levels created when the</span>
</div><div id="_line0020" class="line">0020 <span class="comment">%experiment was paused to change parameters.</span>
</div><div id="_line0021" class="line">0021 <span class="comment">%The pre experiemnt parameters need to be added to each trial</span>
</div><div id="_line0022" class="line">0022 <span class="comment">%The pause parameters need to be added to all trials after the pause</span>
</div><div id="_line0023" class="line">0023 <span class="comment">%So here we test which parameters are pause parameters</span>
</div><div id="_line0024" class="line">0024 [a,b]=p.defaultParameters<a href="../../Parameters/getAllStructs.html" class="param" title="">.getAllStructs</a>();
</div><div id="_line0025" class="line">0025 initialParameterNames= [b(1:end) PDS.initialParameterNames];
</div><div id="_line0026" class="line">0026 initialParameters= [a(1:end) PDS.initialParameters];
</div><div id="_line0027" class="line">0027 
</div><div id="_line0028" class="line">0028 afterpauseparms=cellfun(@(x) textscan(x,<span class="string">'PauseAfterTrial%dParameters'</span>),initialParameterNames);
</div><div id="_line0029" class="line">0029 isafterpauseparm=~cellfun(@isempty,afterpauseparms);
</div><div id="_line0030" class="line">0030 <span class="comment">%and sepereate the pre experiment levels</span>
</div><div id="_line0031" class="line">0031 preLevels=find(~isafterpauseparm);
</div><div id="_line0032" class="line">0032 preOffset=length(initialParameterNames);
</div><div id="_line0033" class="line">0033 <span class="comment">%from the pause levels and get the trials after which they where defined</span>
</div><div id="_line0034" class="line">0034 afterPauseLevels=find(isafterpauseparm);
</div><div id="_line0035" class="line">0035 afterPauseTrials=[afterpauseparms{isafterpauseparm}];
</div><div id="_line0036" class="line">0036 
</div><div id="_line0037" class="line">0037 <span class="comment">%this will override all parameters before. probabbly not a good longterm</span>
</div><div id="_line0038" class="line">0038 <span class="comment">%idea.</span>
</div><div id="_line0039" class="line">0039 newDisplay=p.trial<a href="../../Parameters/display/index.html" class="param" title="specify options for the screen. ">.display</a>;
</div><div id="_line0040" class="line">0040 newparams=p.trial;
</div><div id="_line0041" class="line">0041 
</div><div id="_line0042" class="line">0042 p.defaultParameters=<a href="../../PLDAPS/@params/params.html" class="code" title="function p=params(s,sN,active)">params</a>([initialParameters PDS.conditions],[initialParameterNames PDS.conditionNames]);
</div><div id="_line0043" class="line">0043 p.trial=p.defaultParameters;
</div><div id="_line0044" class="line">0044 
</div><div id="_line0045" class="line">0045 p.defaultParameters<a href="../../Parameters/setLevels.html" class="param" title="">.setLevels</a>(preLevels);
</div><div id="_line0046" class="line">0046 <span class="comment">%convert luts</span>
</div><div id="_line0047" class="line">0047 <span class="keyword">if</span> p.defaultParameters<a href="../../Parameters/datapixx/use.html" class="param" title="enable control of VPixx devices">.datapixx.use</a>
</div><div id="_line0048" class="line">0048     clutNames=fieldnames(p.trial<a href="../../Parameters/display/clut/index.html" class="param" title="">.display.clut</a>);
</div><div id="_line0049" class="line">0049     <span class="keyword">for</span> c=1:length(clutNames)
</div><div id="_line0050" class="line">0050         cind=p.trial<a href="../../Parameters/display/clut/index.html" class="param" title="">.display.clut</a>.(clutNames{c})(1);
</div><div id="_line0051" class="line">0051         p.trial<a href="../../Parameters/display/clut/index.html" class="param" title="">.display.clut</a>.(clutNames{c})=p.defaultParameters<a href="../../Parameters/display/humanCLUT.html" class="param" title="">.display.humanCLUT</a>(cind+1,:)';
</div><div id="_line0052" class="line">0052     <span class="keyword">end</span>
</div><div id="_line0053" class="line">0053 <span class="keyword">end</span>
</div><div id="_line0054" class="line">0054 
</div><div id="_line0055" class="line">0055     <span class="comment">% I still need a good way to specify what changed paraneters to use for</span>
</div><div id="_line0056" class="line">0056     <span class="comment">% replay</span>
</div><div id="_line0057" class="line">0057     p.defaultParameters<a href="../../Parameters/pldaps/trialFunction.html" class="param" title="">.pldaps.trialFunction</a>=<span class="string">'opticflow.replay'</span>;
</div><div id="_line0058" class="line">0058     p.defaultParameters<a href="../../Parameters/pldaps/trialMasterFunction.html" class="param" title="function to be called to run a single Trial.">.pldaps.trialMasterFunction</a> = <span class="string">'runAnalysis'</span>;
</div><div id="_line0059" class="line">0059     p.defaultParameters<a href="../../Parameters/datapixx/use.html" class="param" title="enable control of VPixx devices">.datapixx.use</a>=false;
</div><div id="_line0060" class="line">0060     p.defaultParameters<a href="../../Parameters/sound/flagBuzzer.html" class="param" title="">.sound.flagBuzzer</a>=0;
</div><div id="_line0061" class="line">0061     p.defaultParameters<a href="../../Parameters/sound/use.html" class="param" title="toogle use of sound">.sound.use</a>=1;
</div><div id="_line0062" class="line">0062     p.defaultParameters<a href="../../Parameters/plexon/spikeserver/use.html" class="param" title="toggle use of our plexon spikeserver">.plexon.spikeserver.use</a> = 0;
</div><div id="_line0063" class="line">0063     p.defaultParameters<a href="../../Parameters/eyelink/use.html" class="param" title="use the eyelink moduke">.eyelink.use</a> = 0;
</div><div id="_line0064" class="line">0064 
</div><div id="_line0065" class="line">0065     
</div><div id="_line0066" class="line">0066 p.trial<a href="../../Parameters/pldaps/pause/index.html" class="param" title="control pausing behavior of pldaps">.pldaps.pause</a>=newparams.pldaps.pause;
</div><div id="_line0067" class="line">0067     
</div><div id="_line0068" class="line">0068 p.data=PDS.data;
</div><div id="_line0069" class="line">0069 <span class="comment">% p.functionHandles=PDS.functionHandles;</span>
</div><div id="_line0070" class="line">0070 <span class="comment">% p.trial.postanalysis=PDS.postanalysis;</span>
</div><div id="_line0071" class="line">0071 
</div><div id="_line0072" class="line">0072 <span class="comment">%%todo aspect ratio</span>
</div><div id="_line0073" class="line">0073 p.trial<a href="../../Parameters/display/screenSize.html" class="param" title="size of the window to create pixels in, leave empty for fullscreen">.display.screenSize</a>=newDisplay.screenSize;
</div><div id="_line0074" class="line">0074 p.trial<a href="../../Parameters/display/scrnNum.html" class="param" title="screen numer for fullscreen display">.display.scrnNum</a>=newDisplay.scrnNum;
</div><div id="_line0075" class="line">0075 p.trial<a href="../../Parameters/display/useOverlay.html" class="param" title="create an overlay pointer.">.display.useOverlay</a>=newDisplay.useOverlay;
</div><div id="_line0076" class="line">0076 p.trial<a href="../../Parameters/display/colorclamp.html" class="param" title="clampt colors to [0-1] range. Typically not necessary">.display.colorclamp</a>=newDisplay.colorclamp;
</div><div id="_line0077" class="line">0077 p.trial<a href="../../Parameters/display/forceLinearGamma.html" class="param" title="force a linear gamma table at the end of screen initiation.">.display.forceLinearGamma</a>=newDisplay.forceLinearGamma;
</div><div id="_line0078" class="line">0078 p.trial<a href="../../Parameters/display/movie/index.html" class="param" title="optinal create of videos, typically used during replay">.display.movie</a>=newDisplay.movie;
</div><div id="_line0079" class="line">0079 <span class="keyword">if</span> isfield(newDisplay,<span class="string">'gamma'</span>)
</div><div id="_line0080" class="line">0080     p.trial<a href="../../Parameters/display/gamma/index.html" class="param" title="">.display.gamma</a>=newDisplay.gamma;
</div><div id="_line0081" class="line">0081 <span class="keyword">end</span>
</div><div id="_line0082" class="line">0082 p.trial<a href="../../Parameters/display/bgColor.html" class="param" title="background color. Can be changed during trial">.display.bgColor</a>=newDisplay.bgColor;
</div><div id="_line0083" class="line">0083 
</div><div id="_line0084" class="line">0084 p.defaultParameters<a href="../../Parameters/pldaps/dirs/wavfiles.html" class="param" title="directory for sound files">.pldaps.dirs.wavfiles</a>=newparams.pldaps.dirs.wavfiles;
</div><div id="_line0085" class="line">0085 
</div><div id="_line0086" class="line">0086 KbQueueReserve(1, 2,[])
</div><div id="_line0087" class="line">0087 
</div><div id="_line0088" class="line">0088 <span class="keyword">try</span>     
</div><div id="_line0089" class="line">0089     <span class="comment">%% Open PLDAPS windows</span>
</div><div id="_line0090" class="line">0090     <span class="comment">% Open PsychToolbox Screen</span>
</div><div id="_line0091" class="line">0091     p = <a href="openScreen.html" class="code" title="function p = openScreen(p)">openScreen</a>(p);
</div><div id="_line0092" class="line">0092     
</div><div id="_line0093" class="line">0093     <span class="comment">%% rescale dot drawing</span>
</div><div id="_line0094" class="line">0094     p.trial<a href="../../Parameters/replay/xfactor.html" class="param" title="">.replay.xfactor</a>= p.trial<a href="../../Parameters/display/pWidth.html" class="param" title="">.display.pWidth</a>/PDS.initialParametersMerged.display.pWidth;
</div><div id="_line0095" class="line">0095     p.trial<a href="../../Parameters/replay/yfactor.html" class="param" title="">.replay.yfactor</a>= p.trial<a href="../../Parameters/display/pHeight.html" class="param" title="">.display.pHeight</a>/PDS.initialParametersMerged.display.pHeight;
</div><div id="_line0096" class="line">0096 
</div><div id="_line0097" class="line">0097             <span class="comment">%get and store changes of current code to the git repository</span>
</div><div id="_line0098" class="line">0098             p = <a href="../../PLDAPS/+pds/+git/pds.git.setup.html" class="code" title="function p = setup(p)">pds.git.setup</a>(p);
</div><div id="_line0099" class="line">0099             
</div><div id="_line0100" class="line">0100             <span class="comment">%things that were in the conditionFile</span>
</div><div id="_line0101" class="line">0101             p = <a href="../../PLDAPS/+pds/+eyelink/pds.eyelink.setup.html" class="code" title="function p = setup(p)">pds.eyelink.setup</a>(p);
</div><div id="_line0102" class="line">0102     
</div><div id="_line0103" class="line">0103             <span class="comment">%things that where in the default Trial Structure</span>
</div><div id="_line0104" class="line">0104             
</div><div id="_line0105" class="line">0105             <span class="comment">% Audio</span>
</div><div id="_line0106" class="line">0106             <span class="comment">%-------------------------------------------------------------------------%</span>
</div><div id="_line0107" class="line">0107             p = <a href="../../PLDAPS/+pds/+audio/pds.audio.setup.html" class="code" title="function p = setup(p)">pds.audio.setup</a>(p);
</div><div id="_line0108" class="line">0108             
</div><div id="_line0109" class="line">0109             <span class="comment">% Audio</span>
</div><div id="_line0110" class="line">0110             <span class="comment">%-------------------------------------------------------------------------%</span>
</div><div id="_line0111" class="line">0111             p = <a href="../../PLDAPS/+pds/+plexon/+spikeserver/pds.plexon.spikeserver.connect.html" class="code" title="function p = connect(p)">pds.plexon.spikeserver.connect</a>(p);
</div><div id="_line0112" class="line">0112             
</div><div id="_line0113" class="line">0113             <span class="comment">% From help PsychDataPixx:</span>
</div><div id="_line0114" class="line">0114             <span class="comment">% Timestamping is disabled by default (mode == 0), as it incurs a bit of</span>
</div><div id="_line0115" class="line">0115             <span class="comment">% computational overhead to acquire and log timestamps, typically up to 2-3</span>
</div><div id="_line0116" class="line">0116             <span class="comment">% msecs of extra time per 'Flip' command.</span>
</div><div id="_line0117" class="line">0117             <span class="comment">% Buffer is collected at the end of the expeiment!</span>
</div><div id="_line0118" class="line">0118             PsychDataPixx(<span class="string">'LogOnsetTimestamps'</span>,p.trial<a href="../../Parameters/datapixx/LogOnsetTimestampLevel.html" class="param" title="Get and Store a the time each frame arrived at the VPixx device.">.datapixx.LogOnsetTimestampLevel</a>);<span class="comment">%2</span>
</div><div id="_line0119" class="line">0119             PsychDataPixx(<span class="string">'ClearTimestampLog'</span>);
</div><div id="_line0120" class="line">0120             
</div><div id="_line0121" class="line">0121     
</div><div id="_line0122" class="line">0122             <span class="comment">% Initialize Datapixx for Dual CLUTS</span>
</div><div id="_line0123" class="line">0123             p = <a href="../../PLDAPS/+pds/+datapixx/pds.datapixx.init.html" class="code" title="function p =  init(p)">pds.datapixx.init</a>(p);
</div><div id="_line0124" class="line">0124             
</div><div id="_line0125" class="line">0125             <a href="../../PLDAPS/+pds/+keyboard/pds.keyboard.setup.html" class="code" title="function p = setup(p,scan)">pds.keyboard.setup</a>();
</div><div id="_line0126" class="line">0126     
</div><div id="_line0127" class="line">0127 
</div><div id="_line0128" class="line">0128     <span class="comment">%% Last chance to check variables</span>
</div><div id="_line0129" class="line">0129     <span class="keyword">if</span>(p.trial<a href="../../Parameters/pldaps/pause/type.html" class="param" title="Only type 1 is currently tested.">.pldaps.pause.type</a>==1 &amp;&amp; p.trial<a href="../../Parameters/pldaps/pause/preExperiment.html" class="param" title="pause before experiment starts">.pldaps.pause.preExperiment</a>==true) <span class="comment">%0=don't,1 is debugger, 2=pause loop</span>
</div><div id="_line0130" class="line">0130         p  <span class="comment">%#ok&lt;NOPRT&gt;</span>
</div><div id="_line0131" class="line">0131         disp(<span class="string">'Ready to begin trials. Type return to start first trial...'</span>)
</div><div id="_line0132" class="line">0132         keyboard <span class="comment">%#ok&lt;MCKBD&gt;</span>
</div><div id="_line0133" class="line">0133     <span class="keyword">end</span>
</div><div id="_line0134" class="line">0134  
</div><div id="_line0135" class="line">0135     <span class="comment">%%%%start recording on all controlled components this in not currently done here</span>
</div><div id="_line0136" class="line">0136     <span class="comment">% save timing info from all controlled components (datapixx, eyelink, this pc)</span>
</div><div id="_line0137" class="line">0137     p = <a href="beginExperiment.html" class="code" title="function p = beginExperiment(p)">beginExperiment</a>(p);
</div><div id="_line0138" class="line">0138 
</div><div id="_line0139" class="line">0139     <span class="comment">% disable keyboard</span>
</div><div id="_line0140" class="line">0140     ListenChar(2)
</div><div id="_line0141" class="line">0141     HideCursor
</div><div id="_line0142" class="line">0142     
</div><div id="_line0143" class="line">0143     <span class="comment">%save defaultParameters as trial 0</span>
</div><div id="_line0144" class="line">0144     trialNr=0;
</div><div id="_line0145" class="line">0145     p.trial<a href="../../Parameters/pldaps/iTrial.html" class="param" title="trial number. cannot be changed by the user">.pldaps.iTrial</a>=0;
</div><div id="_line0146" class="line">0146     p.trial=mergeToSingleStruct(p.defaultParameters);
</div><div id="_line0147" class="line">0147     <span class="comment">%only use p.trial from here on!</span>
</div><div id="_line0148" class="line">0148     p.defaultParameters<a href="../../Parameters/pldaps/finish.html" class="param" title="Number of trials to run. can be changed dynamically">.pldaps.finish</a>=length(conditionTrials);
</div><div id="_line0149" class="line">0149     
</div><div id="_line0150" class="line">0150     <span class="comment">%% main trial loop %%</span>
</div><div id="_line0151" class="line">0151     <span class="keyword">while</span> p.trial<a href="../../Parameters/pldaps/iTrial.html" class="param" title="trial number. cannot be changed by the user">.pldaps.iTrial</a> &lt; p.trial<a href="../../Parameters/pldaps/finish.html" class="param" title="Number of trials to run. can be changed dynamically">.pldaps.finish</a> &amp;&amp; p.trial<a href="../../Parameters/pldaps/quit.html" class="param" title="control expeiment during a trial.">.pldaps.quit</a>~=2
</div><div id="_line0152" class="line">0152         
</div><div id="_line0153" class="line">0153         <span class="keyword">if</span> p.trial<a href="../../Parameters/pldaps/quit.html" class="param" title="control expeiment during a trial.">.pldaps.quit</a> == 0
</div><div id="_line0154" class="line">0154             <span class="comment">%load parameters for next trial and lock defaultsParameters</span>
</div><div id="_line0155" class="line">0155             trialNr=trialNr+1;      
</div><div id="_line0156" class="line">0156            
</div><div id="_line0157" class="line">0157             <span class="comment">%set previous values for that trial.</span>
</div><div id="_line0158" class="line">0158             functionLevels=[preLevels afterPauseLevels(trialNr&gt;afterPauseTrials) preOffset+find(conditionTrials==trialNr)];
</div><div id="_line0159" class="line">0159             p.defaultParameters<a href="../../Parameters/setLevels.html" class="param" title="">.setLevels</a>(functionLevels);
</div><div id="_line0160" class="line">0160             p.defaultParameters<a href="../../Parameters/pldaps/iTrial.html" class="param" title="trial number. cannot be changed by the user">.pldaps.iTrial</a>=trialNr;
</div><div id="_line0161" class="line">0161             p.trial=p.defaultParameters<a href="../../Parameters/mergeToSingleStruct.html" class="param" title="">.mergeToSingleStruct</a>();
</div><div id="_line0162" class="line">0162            
</div><div id="_line0163" class="line">0163             p.defaultParameters<a href="../../Parameters/setLock.html" class="param" title="">.setLock</a>(true);
</div><div id="_line0164" class="line">0164             
</div><div id="_line0165" class="line">0165             <span class="comment">% run trial</span>
</div><div id="_line0166" class="line">0166             p = feval(p.trial<a href="../../Parameters/pldaps/trialMasterFunction.html" class="param" title="function to be called to run a single Trial.">.pldaps.trialMasterFunction</a>,  p);
</div><div id="_line0167" class="line">0167             
</div><div id="_line0168" class="line">0168             <span class="comment">%unlock the defaultParameters</span>
</div><div id="_line0169" class="line">0169             p.defaultParameters<a href="../../Parameters/setLock.html" class="param" title="">.setLock</a>(false); 
</div><div id="_line0170" class="line">0170             
</div><div id="_line0171" class="line">0171             <span class="keyword">if</span> isfield(p.trial,<span class="string">'replay'</span>)
</div><div id="_line0172" class="line">0172                 p.data{trialNr}.replay=p.trial<a href="../../Parameters/replay/index.html" class="param" title="">.replay</a>;
</div><div id="_line0173" class="line">0173             <span class="keyword">end</span>
</div><div id="_line0174" class="line">0174            
</div><div id="_line0175" class="line">0175             <span class="keyword">if</span> all(all(p.trial<a href="../../Parameters/stimulus/dots/XYd.html" class="param" title="">.stimulus.dots.XYd</a>==PDS.data{trialNr}.stimulus.dots))
</div><div id="_line0176" class="line">0176                 display(sprintf(<span class="string">'trial %i replayed'</span>,trialNr));
</div><div id="_line0177" class="line">0177                 p.data{trialNr}.replay.success=true;
</div><div id="_line0178" class="line">0178             <span class="keyword">else</span>
</div><div id="_line0179" class="line">0179                 display(sprintf(<span class="string">'trial %i replayed, but there seems to be a reconstruction error'</span>,trialNr));
</div><div id="_line0180" class="line">0180                 p.data{trialNr}.replay.success=false;
</div><div id="_line0181" class="line">0181             <span class="keyword">end</span>
</div><div id="_line0182" class="line">0182 
</div><div id="_line0183" class="line">0183             
</div><div id="_line0184" class="line">0184         <span class="keyword">else</span> <span class="comment">%dbquit ==1 is meant to be pause. should we halt eyelink, datapixx, etc?</span>
</div><div id="_line0185" class="line">0185             <span class="comment">%create a new level to store all changes in,</span>
</div><div id="_line0186" class="line">0186             <span class="comment">%load only non trial paraeters</span>
</div><div id="_line0187" class="line">0187             pause=p.trial<a href="../../Parameters/pldaps/pause/type.html" class="param" title="Only type 1 is currently tested.">.pldaps.pause.type</a>;
</div><div id="_line0188" class="line">0188             p.trial=p.defaultParameters;
</div><div id="_line0189" class="line">0189             
</div><div id="_line0190" class="line">0190             p.defaultParameters<a href="../../Parameters/addLevels.html" class="param" title="">.addLevels</a>({struct}, {[<span class="string">'PauseAfterTrial'</span> num2str(trialNr) <span class="string">'Parameters'</span>]});
</div><div id="_line0191" class="line">0191             p.defaultParameters<a href="../../Parameters/setLevels.html" class="param" title="">.setLevels</a>([preLevels length(p.defaultParameters<a href="../../Parameters/getAllLevels.html" class="param" title="">.getAllLevels</a>())]);
</div><div id="_line0192" class="line">0192             
</div><div id="_line0193" class="line">0193             <span class="keyword">if</span> pause==1 <span class="comment">%0=don't,1 is debugger, 2=pause loop</span>
</div><div id="_line0194" class="line">0194                 ListenChar(0);
</div><div id="_line0195" class="line">0195                 ShowCursor;
</div><div id="_line0196" class="line">0196                 p.trial
</div><div id="_line0197" class="line">0197                 disp(<span class="string">'Ready to begin trials. Type return to start first trial...'</span>)
</div><div id="_line0198" class="line">0198                 keyboard <span class="comment">%#ok&lt;MCKBD&gt;</span>
</div><div id="_line0199" class="line">0199                 p.trial<a href="../../Parameters/pldaps/quit.html" class="param" title="control expeiment during a trial.">.pldaps.quit</a> = 0;
</div><div id="_line0200" class="line">0200                 ListenChar(2);
</div><div id="_line0201" class="line">0201                 HideCursor;
</div><div id="_line0202" class="line">0202             <span class="keyword">elseif</span> pause==2
</div><div id="_line0203" class="line">0203                 <a href="#_sub1" class="code" title="subpauseLoop">pauseLoop</a>(p);
</div><div id="_line0204" class="line">0204             <span class="keyword">end</span>             
</div><div id="_line0205" class="line">0205 
</div><div id="_line0206" class="line">0206             <span class="comment">%now I'm assuming that nobody created new levels,</span>
</div><div id="_line0207" class="line">0207             <span class="comment">%but I guess when you know how to do that</span>
</div><div id="_line0208" class="line">0208             <span class="comment">%you should also now how to not skrew things up</span>
</div><div id="_line0209" class="line">0209             allStructs=p.defaultParameters<a href="../../Parameters/getAllStructs.html" class="param" title="">.getAllStructs</a>();
</div><div id="_line0210" class="line">0210             <span class="keyword">if</span>(~isequal(struct,allStructs{end}))
</div><div id="_line0211" class="line">0211                 preLevels=[preLevels length(allStructs)]; <span class="comment">%#ok&lt;AGROW&gt;</span>
</div><div id="_line0212" class="line">0212             <span class="keyword">end</span>
</div><div id="_line0213" class="line">0213         <span class="keyword">end</span>
</div><div id="_line0214" class="line">0214         
</div><div id="_line0215" class="line">0215     <span class="keyword">end</span>
</div><div id="_line0216" class="line">0216     
</div><div id="_line0217" class="line">0217     <span class="comment">%make the session parameterStruct active</span>
</div><div id="_line0218" class="line">0218     p.defaultParameters<a href="../../Parameters/setLevels.html" class="param" title="">.setLevels</a>(preLevels);
</div><div id="_line0219" class="line">0219     p.trial = p.defaultParameters;
</div><div id="_line0220" class="line">0220     
</div><div id="_line0221" class="line">0221     <span class="comment">% return cursor and command-line control</span>
</div><div id="_line0222" class="line">0222     ShowCursor;
</div><div id="_line0223" class="line">0223     ListenChar(0);
</div><div id="_line0224" class="line">0224     Priority(0);
</div><div id="_line0225" class="line">0225     
</div><div id="_line0226" class="line">0226     p = <a href="../../PLDAPS/+pds/+eyelink/pds.eyelink.finish.html" class="code" title="function p = finish(p)">pds.eyelink.finish</a>(p);
</div><div id="_line0227" class="line">0227     p = <a href="../../PLDAPS/+pds/+plexon/+spikeserver/pds.plexon.spikeserver.disconnect.html" class="code" title="function p = disconnect(p)">pds.plexon.spikeserver.disconnect</a>(p);
</div><div id="_line0228" class="line">0228     <span class="keyword">if</span>(p.defaultParameters<a href="../../Parameters/datapixx/use.html" class="param" title="enable control of VPixx devices">.datapixx.use</a>)
</div><div id="_line0229" class="line">0229         <span class="comment">%stop adc data collection if requested</span>
</div><div id="_line0230" class="line">0230         <a href="../../PLDAPS/+pds/+datapixx/+adc/pds.datapixx.adc.stop.html" class="code" title="function p = stop(p)">pds.datapixx.adc.stop</a>(p);
</div><div id="_line0231" class="line">0231         
</div><div id="_line0232" class="line">0232         status = PsychDataPixx(<span class="string">'GetStatus'</span>);
</div><div id="_line0233" class="line">0233         <span class="keyword">if</span> status.timestampLogCount
</div><div id="_line0234" class="line">0234             p.defaultParameters<a href="../../Parameters/datapixx/timestamplog.html" class="param" title="">.datapixx.timestamplog</a> = PsychDataPixx(<span class="string">'GetTimestampLog'</span>, 1);
</div><div id="_line0235" class="line">0235         <span class="keyword">end</span>
</div><div id="_line0236" class="line">0236     <span class="keyword">end</span>
</div><div id="_line0237" class="line">0237         
</div><div id="_line0238" class="line">0238     <span class="keyword">if</span> p.trial<a href="../../Parameters/display/movie/create.html" class="param" title="toggle movie creation">.display.movie.create</a>
</div><div id="_line0239" class="line">0239         Screen(<span class="string">'FinalizeMovie'</span>, p.trial<a href="../../Parameters/display/movie/ptr.html" class="param" title="">.display.movie.ptr</a>);
</div><div id="_line0240" class="line">0240     <span class="keyword">end</span>
</div><div id="_line0241" class="line">0241     Screen(<span class="string">'CloseAll'</span>);
</div><div id="_line0242" class="line">0242 
</div><div id="_line0243" class="line">0243     sca;
</div><div id="_line0244" class="line">0244     
</div><div id="_line0245" class="line">0245 <span class="keyword">catch</span> me
</div><div id="_line0246" class="line">0246     sca
</div><div id="_line0247" class="line">0247     
</div><div id="_line0248" class="line">0248     <span class="comment">% return cursor and command-line control</span>
</div><div id="_line0249" class="line">0249     ShowCursor
</div><div id="_line0250" class="line">0250     ListenChar(0)
</div><div id="_line0251" class="line">0251     disp(me.message)
</div><div id="_line0252" class="line">0252     
</div><div id="_line0253" class="line">0253     nErr = size(me.stack); 
</div><div id="_line0254" class="line">0254     <span class="keyword">for</span> iErr = 1:nErr
</div><div id="_line0255" class="line">0255         fprintf(<span class="string">'errors in %s line %d\r'</span>, me.stack(iErr).name, me.stack(iErr).line)
</div><div id="_line0256" class="line">0256     <span class="keyword">end</span>
</div><div id="_line0257" class="line">0257     fprintf(<span class="string">'\r\r'</span>)
</div><div id="_line0258" class="line">0258     keyboard    
</div><div id="_line0259" class="line">0259 <span class="keyword">end</span>
</div><div id="_line0260" class="line">0260 
</div><div id="_line0261" class="line">0261 <span class="keyword">end</span>
</div><div id="_line0262" class="line">0262 <span class="comment">%we are pausing, will create a new defaultParaneters Level where changes</span>
</div><div id="_line0263" class="line">0263 <span class="comment">%would go.</span>
</div><div id="_line0264" class="line">0264 <a name="_sub1" href="#_subfunctions" class="code">function pauseLoop(dv)</a>
</div><div id="_line0265" class="line">0265         ShowCursor;
</div><div id="_line0266" class="line">0266         ListenChar(1);
</div><div id="_line0267" class="line">0267         <span class="keyword">while</span>(true)
</div><div id="_line0268" class="line">0268             <span class="comment">%the keyboard chechking we only capture ctrl+alt key presses.</span>
</div><div id="_line0269" class="line">0269             [p.trial<a href="../../Parameters/keyboard/pressedQ.html" class="param" title="">.keyboard.pressedQ</a>,  p.trial<a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ</a>]=KbQueueCheck(); <span class="comment">% fast</span>
</div><div id="_line0270" class="line">0270             <span class="keyword">if</span> p.trial<a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ</a>(p.trial<a href="../../Parameters/keyboard/codes/Lctrl.html" class="param" title="">.keyboard.codes.Lctrl</a>)&amp;&amp;p.trial<a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ</a>(p.trial<a href="../../Parameters/keyboard/codes/Lalt.html" class="param" title="">.keyboard.codes.Lalt</a>)
</div><div id="_line0271" class="line">0271                 <span class="comment">%D: Debugger</span>
</div><div id="_line0272" class="line">0272                 <span class="keyword">if</span>  p.trial<a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ</a>(p.trial<a href="../../Parameters/keyboard/codes/dKey.html" class="param" title="">.keyboard.codes.dKey</a>) 
</div><div id="_line0273" class="line">0273                     disp(<span class="string">'stepped into debugger. Type return to start first trial...'</span>)
</div><div id="_line0274" class="line">0274                     keyboard <span class="comment">%#ok&lt;MCKBD&gt;</span>
</div><div id="_line0275" class="line">0275 
</div><div id="_line0276" class="line">0276                 <span class="comment">%E: Eyetracker Setup</span>
</div><div id="_line0277" class="line">0277                 <span class="keyword">elseif</span>  p.trial<a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ</a>(p.trial<a href="../../Parameters/keyboard/codes/eKey.html" class="param" title="">.keyboard.codes.eKey</a>)
</div><div id="_line0278" class="line">0278                     <span class="keyword">try</span>
</div><div id="_line0279" class="line">0279                        <span class="keyword">if</span>(p.trial<a href="../../Parameters/eyelink/use.html" class="param" title="use the eyelink moduke">.eyelink.use</a>) 
</div><div id="_line0280" class="line">0280                            <a href="../../PLDAPS/+pds/+eyelink/pds.eyelink.calibrate.html" class="code" title="function p=calibrate(p)">pds.eyelink.calibrate</a>(dv);
</div><div id="_line0281" class="line">0281                        <span class="keyword">end</span>
</div><div id="_line0282" class="line">0282                     <span class="keyword">catch</span> ME
</div><div id="_line0283" class="line">0283                         display(ME);
</div><div id="_line0284" class="line">0284                     <span class="keyword">end</span>
</div><div id="_line0285" class="line">0285 
</div><div id="_line0286" class="line">0286                 <span class="comment">%M: Manual reward</span>
</div><div id="_line0287" class="line">0287                 <span class="keyword">elseif</span>  p.trial<a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ</a>(p.trial<a href="../../Parameters/keyboard/codes/mKey.html" class="param" title="">.keyboard.codes.mKey</a>)
</div><div id="_line0288" class="line">0288                     <span class="keyword">if</span> p.trial<a href="../../Parameters/datapixx/use.html" class="param" title="enable control of VPixx devices">.datapixx.use</a>
</div><div id="_line0289" class="line">0289                         <a href="../../PLDAPS/+pds/+datapixx/pds.datapixx.analogOut.html" class="code" title="function analogOut(open_time, chan, TTLamp)">pds.datapixx.analogOut</a>(p.trial<a href="../../Parameters/stimulus/rewardTime.html" class="param" title="">.stimulus.rewardTime</a>)
</div><div id="_line0290" class="line">0290                         <a href="../../PLDAPS/+pds/+datapixx/pds.datapixx.flipBit.html" class="code" title="function timings=flipBit(bit,trial)">pds.datapixx.flipBit</a>(p.trial<a href="../../Parameters/event/REWARD.html" class="param" title="">.event.REWARD</a>);
</div><div id="_line0291" class="line">0291                     <span class="keyword">end</span>
</div><div id="_line0292" class="line">0292                     p.trial<a href="../../Parameters/ttime.html" class="param" title="">.ttime</a> = GetSecs - p.trial<a href="../../Parameters/trstart.html" class="param" title="">.trstart</a>;
</div><div id="_line0293" class="line">0293                     p.trial<a href="../../Parameters/stimulus/timeReward.html" class="param" title="">.stimulus.timeReward</a>(:,p.trial<a href="../../Parameters/iReward.html" class="param" title="">.iReward</a>) = [p.trial<a href="../../Parameters/ttime.html" class="param" title="">.ttime</a> p.trial<a href="../../Parameters/stimulus/rewardTime.html" class="param" title="">.stimulus.rewardTime</a>];
</div><div id="_line0294" class="line">0294                     p.trial<a href="../../Parameters/stimulus/iReward.html" class="param" title="">.stimulus.iReward</a> = p.trial<a href="../../Parameters/iReward.html" class="param" title="">.iReward</a> + 1;
</div><div id="_line0295" class="line">0295                     PsychPortAudio(<span class="string">'Start'</span>, p.trial<a href="../../Parameters/sound/reward.html" class="param" title="">.sound.reward</a>);
</div><div id="_line0296" class="line">0296 
</div><div id="_line0297" class="line">0297                 <span class="comment">%P: PAUSE (end the pause)</span>
</div><div id="_line0298" class="line">0298                 <span class="keyword">elseif</span>  p.trial<a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ</a>(p.trial<a href="../../Parameters/keyboard/codes/pKey.html" class="param" title="">.keyboard.codes.pKey</a>)
</div><div id="_line0299" class="line">0299                     p.trial<a href="../../Parameters/pldaps/quit.html" class="param" title="control expeiment during a trial.">.pldaps.quit</a> = 0;
</div><div id="_line0300" class="line">0300                     ListenChar(2);
</div><div id="_line0301" class="line">0301                     HideCursor;
</div><div id="_line0302" class="line">0302                     <span class="keyword">break</span>;
</div><div id="_line0303" class="line">0303 
</div><div id="_line0304" class="line">0304                 <span class="comment">%Q: QUIT</span>
</div><div id="_line0305" class="line">0305                 <span class="keyword">elseif</span>  p.trial<a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ</a>(p.trial<a href="../../Parameters/keyboard/codes/qKey.html" class="param" title="">.keyboard.codes.qKey</a>)
</div><div id="_line0306" class="line">0306                     p.trial<a href="../../Parameters/pldaps/quit.html" class="param" title="control expeiment during a trial.">.pldaps.quit</a> = 2;
</div><div id="_line0307" class="line">0307                     <span class="keyword">break</span>;
</div><div id="_line0308" class="line">0308                 
</div><div id="_line0309" class="line">0309                 <span class="comment">%X: Execute text selected in Matlab editor</span>
</div><div id="_line0310" class="line">0310                 <span class="keyword">elseif</span>  p.trial<a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ</a>(p.trial<a href="../../Parameters/keyboard/codes/xKey.html" class="param" title="">.keyboard.codes.xKey</a>)
</div><div id="_line0311" class="line">0311                     activeEditor=matlab.desktop.editor.getActive; 
</div><div id="_line0312" class="line">0312                     <span class="keyword">if</span> isempty(activeEditor)
</div><div id="_line0313" class="line">0313                         display(<span class="string">'No Matlab editor open -&gt; Nothing to execute'</span>);
</div><div id="_line0314" class="line">0314                     <span class="keyword">else</span>
</div><div id="_line0315" class="line">0315                         <span class="keyword">if</span> isempty(activeEditor.SelectedText)
</div><div id="_line0316" class="line">0316                             display(<span class="string">'Nothing selected in the active editor Widnow -&gt; Nothing to execute'</span>);
</div><div id="_line0317" class="line">0317                         <span class="keyword">else</span>
</div><div id="_line0318" class="line">0318                             <span class="keyword">try</span>
</div><div id="_line0319" class="line">0319                                 eval(activeEditor.SelectedText)
</div><div id="_line0320" class="line">0320                             <span class="keyword">catch</span> ME
</div><div id="_line0321" class="line">0321                                 display(ME);
</div><div id="_line0322" class="line">0322                             <span class="keyword">end</span>
</div><div id="_line0323" class="line">0323                         <span class="keyword">end</span>
</div><div id="_line0324" class="line">0324                     <span class="keyword">end</span>
</div><div id="_line0325" class="line">0325                     
</div><div id="_line0326" class="line">0326                     
</div><div id="_line0327" class="line">0327                 <span class="keyword">end</span> <span class="comment">%IF CTRL+ALT PRESSED</span>
</div><div id="_line0328" class="line">0328             <span class="keyword">end</span>
</div><div id="_line0329" class="line">0329             pause(0.1);
</div><div id="_line0330" class="line">0330         <span class="keyword">end</span>
</div><div id="_line0331" class="line">0331 
</div><div id="_line0332" class="line">0332 <span class="keyword">end</span>
</div></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005
<br>
check <strong><a href="../../index.html">here</a></strong> date of last update.
<br></address>
</body>
</html>