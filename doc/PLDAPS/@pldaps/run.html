<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of run</title>
  <meta name="keywords" content="run">
  <meta name="description" content="run    run a new experiment for a previuously created pldaps class">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">PLDAPS</a> &gt; <a href="index.html">@pldaps</a> &gt; run.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for PLDAPS/@pldaps&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>@pldaps/run
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>run    run a new experiment for a previuously created pldaps class</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function p = run(p) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="description">run    run a new experiment for a previuously created pldaps class
 p = run(p)
 PLDAPS (Plexon Datapixx PsychToolbox) version 4.1
       run is a wrapper for calling PLDAPS package files
           It opens the PsychImaging pipeline and initializes datapixx for
           dual color lookup tables. 
 10/2011 jly wrote it (modified from letsgorun.m)
 12/2013 jly reboot. updated to version 3 format.
 04/2014 jk  moved into a pldaps class; adapated to new class structure</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../PLDAPS/+pds/+audio/clearBuffer.html" class="code" title="function clearBuffer(p)">pds.audio.clearBuffer</a>	pds.audio.clearBuffer(p)    stops audio output of files setup with pds.audio.setup(p)</li><li><a href="../../PLDAPS/+pds/+audio/setup.html" class="code" title="function p = setup(p)">pds.audio.setup</a>	pds.audio.setup(p)    loads audiofiles at the beginning of an experiment</li><li><a href="../../PLDAPS/+pds/+behavior/+reward/give.html" class="code" title="function p = give(p, amount)">pds.behavior.reward.give</a>	pds.behavior.reward.give(p, amount)    give a certaim amount of reward</li><li><a href="../../PLDAPS/+pds/+behavior/+reward/setup.html" class="code" title="function p = setup(p)">pds.behavior.reward.setup</a>	pds.behavior.reward.setup(p)    setup reward systems before the experiment</li><li><a href="../../PLDAPS/+pds/+datapixx/+adc/stop.html" class="code" title="function p = stop(p)">pds.datapixx.adc.stop</a>	stops datapixx data aquisition</li><li><a href="../../PLDAPS/+pds/+datapixx/init.html" class="code" title="function p =  init(p)">pds.datapixx.init</a>	pds.datapixx.init    initialize Datapixx at the beginning of an experiment.</li><li><a href="../../PLDAPS/+pds/+eyelink/calibrate.html" class="code" title="function p=calibrate(p)">pds.eyelink.calibrate</a>	pds.eyelink.calibrate    start eyelink calibration routines</li><li><a href="../../PLDAPS/+pds/+eyelink/finish.html" class="code" title="function p = finish(p)">pds.eyelink.finish</a>	pds.eyelink.finish    stop recording on eyelink</li><li><a href="../../PLDAPS/+pds/+eyelink/setup.html" class="code" title="function p = setup(p)">pds.eyelink.setup</a>	pds.eyelink.setup    setup eyelink at the beginning of an experiment</li><li><a href="../../PLDAPS/+pds/+git/setup.html" class="code" title="function p = setup(p)">pds.git.setup</a>	pds.git.setup   retrieves and stores git info about relevant directories</li><li><a href="../../PLDAPS/+pds/+keyboard/setup.html" class="code" title="function p = setup(p,scan)">pds.keyboard.setup</a>	pds.git.setup   setup the keyboard queue</li><li><a href="../../PLDAPS/+pds/+plexon/+spikeserver/connect.html" class="code" title="function p = connect(p)">pds.plexon.spikeserver.connect</a>	pds.plexon.spikeserver.connect   connect to a remote plexon spikeserver</li><li><a href="../../PLDAPS/+pds/+plexon/finish.html" class="code" title="function p = finish(p)">pds.plexon.finish</a>	pds.plexon.finish   finish up plexon after the expeiment</li><li><a href="beginExperiment.html" class="code" title="function p = beginExperiment(p)">@pldaps/beginExperiment</a>	beginExperiment    initialize an Exeriment</li><li><a href="getModules.html" class="code" title="function [modules,moduleFunctionHandles,moduleRequestedStates,moduleLocationInputs] = getModules(p)">@pldaps/getModules</a>	add a requested Order: from -Inf allways first to 0 Default to after</li><li><a href="openScreen.html" class="code" title="function p = openScreen(p)">@pldaps/openScreen</a>	openScreen    opens PsychImaging Window with preferences set for special</li><li><a href="runStateforModules.html" class="code" title="function runStateforModules(p,state,modules,moduleFunctionHandles,moduleRequestedStates,moduleLocationInputs)">@pldaps/runStateforModules</a>	using cellfun might be slower than a for loop and does not guaranty</li><li><a href="saveTempFile.html" class="code" title="function result = saveTempFile(p)">@pldaps/saveTempFile</a>	saveTempFile    save the data from a single Trial to a file in a TEMP</li><li><a href="../../PLDAPS/SupportFunctions/Utils/initTicks.html" class="code" title="function p = initTicks(p)">initTicks</a>	p = initTicks(p)</li><li><a href="../../PLDAPS/SupportFunctions/Utils/makePhotodiodeRect.html" class="code" title="function dv = makePhotodiodeRect(dv)">makePhotodiodeRect</a>	rect = makePhotodiodeRect(dv, location)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<!-- parameterreference -->
<h2><a name="_cross"></a>PARAMETER USAGE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function uses these parameters:
<ul >
<li><a href="../../Parameters/addLevels.html" class="param" title="">.addLevels:</a>	
        <a href="#_line0178" class="code"}">178 </a>    <a href="#_line0238" class="code"}">238 </a>    <a href="#_line0274" class="code"}">274 </a></li><li><a href="../../Parameters/datapixx/use.html" class="param" title="enable control of VPixx devices">.datapixx.use:</a>	
        <a href="#_line0245" class="code"}">245 </a>    <a href="#_line0313" class="code"}">313 </a>    <a href="#_line0362" class="code"}">362 </a>enable control of VPixx devices</li><li><a href="../../Parameters/display/frate.html" class="param" title="">.display.frate:</a>	
        <a href="#_line0076" class="code"}">76 </a></li><li><a href="../../Parameters/display/movie/create.html" class="param" title="toggle movie creation">.display.movie.create:</a>	
        <a href="#_line0358" class="code"}">358 </a>toggle movie creation</li><li><a href="../../Parameters/display/movie/ptr.html" class="param" title="">.display.movie.ptr:</a>	
        <a href="#_line0359" class="code"}">359 </a></li><li><a href="../../Parameters/display/useOverlay.html" class="param" title="create an overlay pointer.">.display.useOverlay:</a>	
        <a href="#_line0245" class="code"}">245 </a>    <a href="#_line0362" class="code"}">362 </a>create an overlay pointer.</li><li><a href="../../Parameters/eyelink/use.html" class="param" title="use the eyelink moduke">.eyelink.use:</a>	
        <a href="#_line0403" class="code"}">403 </a>use the eyelink moduke</li><li><a href="../../Parameters/getAllLevels.html" class="param" title="">.getAllLevels:</a>	
        <a href="#_line0159" class="code"}">159 </a>    <a href="#_line0239" class="code"}">239 </a>    <a href="#_line0275" class="code"}">275 </a></li><li><a href="../../Parameters/getAllStructs.html" class="param" title="">.getAllStructs:</a>	
        <a href="#_line0294" class="code"}">294 </a>    <a href="#_line0335" class="code"}">335 </a></li><li><a href="../../Parameters/keyboard/codes/Lalt.html" class="param" title="">.keyboard.codes.Lalt:</a>	
        <a href="#_line0394" class="code"}">394 </a></li><li><a href="../../Parameters/keyboard/codes/Lctrl.html" class="param" title="">.keyboard.codes.Lctrl:</a>	
        <a href="#_line0394" class="code"}">394 </a></li><li><a href="../../Parameters/keyboard/codes/dKey.html" class="param" title="">.keyboard.codes.dKey:</a>	
        <a href="#_line0396" class="code"}">396 </a></li><li><a href="../../Parameters/keyboard/codes/eKey.html" class="param" title="">.keyboard.codes.eKey:</a>	
        <a href="#_line0401" class="code"}">401 </a></li><li><a href="../../Parameters/keyboard/codes/mKey.html" class="param" title="">.keyboard.codes.mKey:</a>	
        <a href="#_line0411" class="code"}">411 </a></li><li><a href="../../Parameters/keyboard/codes/pKey.html" class="param" title="">.keyboard.codes.pKey:</a>	
        <a href="#_line0423" class="code"}">423 </a></li><li><a href="../../Parameters/keyboard/codes/qKey.html" class="param" title="">.keyboard.codes.qKey:</a>	
        <a href="#_line0430" class="code"}">430 </a></li><li><a href="../../Parameters/keyboard/codes/xKey.html" class="param" title="">.keyboard.codes.xKey:</a>	
        <a href="#_line0435" class="code"}">435 </a></li><li><a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ:</a>	
        <a href="#_line0394" class="code"}">394 </a>    <a href="#_line0394" class="code"}">394 </a>    <a href="#_line0396" class="code"}">396 </a>    <a href="#_line0401" class="code"}">401 </a>    <a href="#_line0411" class="code"}">411 </a>    <a href="#_line0423" class="code"}">423 </a>    <a href="#_line0430" class="code"}">430 </a>    <a href="#_line0435" class="code"}">435 </a></li><li><a href="../../Parameters/pldaps/dirs/data.html" class="param" title="data directory.">.pldaps.dirs.data:</a>	
        <a href="#_line0043" class="code"}">43 </a>    <a href="#_line0193" class="code"}">193 </a>    <a href="#_line0195" class="code"}">195 </a>data directory.</li><li><a href="../../Parameters/pldaps/draw/grid/use.html" class="param" title="enable drawing of the grid">.pldaps.draw.grid.use:</a>	
        <a href="#_line0088" class="code"}">88 </a>enable drawing of the grid</li><li><a href="../../Parameters/pldaps/draw/photodiode/use.html" class="param" title="enable drawing the photodione square">.pldaps.draw.photodiode.use:</a>	
        <a href="#_line0082" class="code"}">82 </a>enable drawing the photodione square</li><li><a href="../../Parameters/pldaps/finish.html" class="param" title="Number of trials to run. can be changed dynamically">.pldaps.finish:</a>	
        <a href="#_line0171" class="code"}">171 </a>Number of trials to run. can be changed dynamically</li><li><a href="../../Parameters/pldaps/iTrial.html" class="param" title="trial number. cannot be changed by the user">.pldaps.iTrial:</a>	
        <a href="#_line0171" class="code"}">171 </a>trial number. cannot be changed by the user</li><li><a href="../../Parameters/pldaps/maxTrialLength.html" class="param" title="Maximum duration of a trial in seconds. Used to allocate memory.">.pldaps.maxTrialLength:</a>	
        <a href="#_line0076" class="code"}">76 </a>Maximum duration of a trial in seconds. Used to allocate memory.</li><li><a href="../../Parameters/pldaps/nosave.html" class="param" title="disables saving of data when true. see .pldaps.save for more control">.pldaps.nosave:</a>	
        <a href="#_line0042" class="code"}">42 </a>    <a href="#_line0334" class="code"}">334 </a>disables saving of data when true. see .pldaps.save for more control</li><li><a href="../../Parameters/pldaps/pause/preExperiment.html" class="param" title="pause before experiment starts">.pldaps.pause.preExperiment:</a>	
        <a href="#_line0125" class="code"}">125 </a>pause before experiment starts</li><li><a href="../../Parameters/pldaps/pause/type.html" class="param" title="Only type 1 is currently tested.">.pldaps.pause.type:</a>	
        <a href="#_line0125" class="code"}">125 </a>    <a href="#_line0271" class="code"}">271 </a>Only type 1 is currently tested.</li><li><a href="../../Parameters/pldaps/quit.html" class="param" title="control expeiment during a trial.">.pldaps.quit:</a>	
        <a href="#_line0171" class="code"}">171 </a>    <a href="#_line0173" class="code"}">173 </a>control expeiment during a trial.</li><li><a href="../../Parameters/pldaps/save/initialParametersMerged.html" class="param" title="save merged initial parameters">.pldaps.save.initialParametersMerged:</a>	
        <a href="#_line0340" class="code"}">340 </a>save merged initial parameters</li><li><a href="../../Parameters/pldaps/save/mergedData.html" class="param" title="Save merged data">.pldaps.save.mergedData:</a>	
        <a href="#_line0215" class="code"}">215 </a>Save merged data</li><li><a href="../../Parameters/pldaps/save/v73.html" class="param" title="save as matlab version v73?">.pldaps.save.v73:</a>	
        <a href="#_line0350" class="code"}">350 </a>save as matlab version v73?</li><li><a href="../../Parameters/pldaps/trialMasterFunction.html" class="param" title="function to be called to run a single Trial.">.pldaps.trialMasterFunction:</a>	
        <a href="#_line0204" class="code"}">204 </a>function to be called to run a single Trial.</li><li><a href="../../Parameters/pldaps/useFileGUI.html" class="param" title="use a GUI to specify the output file.">.pldaps.useFileGUI:</a>	
        <a href="#_line0047" class="code"}">47 </a>use a GUI to specify the output file.</li><li><a href="../../Parameters/pldaps/useModularStateFunctions.html" class="param" title="use modular state functions, see pldaps.runModularTrial, pldaps.getModules, pldaps.runStateforModules">.pldaps.useModularStateFunctions:</a>	
        <a href="#_line0065" class="code"}">65 </a>    <a href="#_line0119" class="code"}">119 </a>    <a href="#_line0225" class="code"}">225 </a>    <a href="#_line0329" class="code"}">329 </a>use modular state functions, see pldaps.runModularTrial, pldaps.getModules, pldaps.runStateforModules</li><li><a href="../../Parameters/session/dir.html" class="param" title="">.session.dir:</a>	
        <a href="#_line0048" class="code"}">48 </a>    <a href="#_line0056" class="code"}">56 </a>    <a href="#_line0057" class="code"}">57 </a>    <a href="#_line0062" class="code"}">62 </a>    <a href="#_line0351" class="code"}">351 </a>    <a href="#_line0353" class="code"}">353 </a></li><li><a href="../../Parameters/session/experimentSetupFile.html" class="param" title="">.session.experimentSetupFile:</a>	
        <a href="#_line0032" class="code"}">32 </a>    <a href="#_line0044" class="code"}">44 </a>    <a href="#_line0077" class="code"}">77 </a></li><li><a href="../../Parameters/session/file.html" class="param" title="">.session.file:</a>	
        <a href="#_line0048" class="code"}">48 </a>    <a href="#_line0061" class="code"}">61 </a>    <a href="#_line0351" class="code"}">351 </a>    <a href="#_line0353" class="code"}">353 </a></li><li><a href="../../Parameters/session/initTime.html" class="param" title="">.session.initTime:</a>	
        <a href="#_line0044" class="code"}">44 </a>    <a href="#_line0044" class="code"}">44 </a></li><li><a href="../../Parameters/session/subject.html" class="param" title="">.session.subject:</a>	
        <a href="#_line0044" class="code"}">44 </a></li><li><a href="../../Parameters/setLevels.html" class="param" title="">.setLevels:</a>	
        <a href="#_line0179" class="code"}">179 </a>    <a href="#_line0181" class="code"}">181 </a>    <a href="#_line0228" class="code"}">228 </a>    <a href="#_line0275" class="code"}">275 </a>    <a href="#_line0303" class="code"}">303 </a></li><li><a href="../../Parameters/setLock.html" class="param" title="">.setLock:</a>	
        <a href="#_line0201" class="code"}">201 </a>    <a href="#_line0207" class="code"}">207 </a>    <a href="#_line0231" class="code"}">231 </a>    <a href="#_line0235" class="code"}">235 </a></li><li><a href="../../Parameters/sound/master.html" class="param" title="">.sound.master:</a>	
        <a href="#_line0326" class="code"}">326 </a></li><li><a href="../../Parameters/sound/use.html" class="param" title="toogle use of sound">.sound.use:</a>	
        <a href="#_line0323" class="code"}">323 </a>toogle use of sound</li></ul>
This function assigns these parameters:
<ul>
<li><a href="../../Parameters/datapixx/timestamplog.html" class="param" title="">.datapixx.timestamplog:</a>
        <a href="#_line0319" class="code"}">319 </a></li><li><a href="../../Parameters/flagNextTrial.html" class="param" title="">.flagNextTrial:</a>
        <a href="#_line0139" class="code"}">139 </a></li><li><a href="../../Parameters/iFrame.html" class="param" title="">.iFrame:</a>
        <a href="#_line0140" class="code"}">140 </a></li><li><a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ:</a>
        <a href="#_line0393" class="code"}">393 </a></li><li><a href="../../Parameters/keyboard/pressedQ.html" class="param" title="">.keyboard.pressedQ:</a>
        <a href="#_line0393" class="code"}">393 </a></li><li><a href="../../Parameters/pldaps/iTrial.html" class="param" title="trial number. cannot be changed by the user">.pldaps.iTrial:</a>
        <a href="#_line0144" class="code"}">144 </a>    <a href="#_line0183" class="code"}">183 </a>    <a href="#_line0229" class="code"}">229 </a>trial number. cannot be changed by the user</li><li><a href="../../Parameters/pldaps/maxFrames.html" class="param" title="">.pldaps.maxFrames:</a>
        <a href="#_line0076" class="code"}">76 </a></li><li><a href="../../Parameters/pldaps/quit.html" class="param" title="control expeiment during a trial.">.pldaps.quit:</a>
        <a href="#_line0283" class="code"}">283 </a>    <a href="#_line0424" class="code"}">424 </a>    <a href="#_line0431" class="code"}">431 </a>control expeiment during a trial.</li><li><a href="../../Parameters/session/dir.html" class="param" title="">.session.dir:</a>
        <a href="#_line0043" class="code"}">43 </a>    <a href="#_line0052" class="code"}">52 </a></li><li><a href="../../Parameters/session/experimentSetupFile.html" class="param" title="">.session.experimentSetupFile:</a>
        <a href="#_line0039" class="code"}">39 </a></li><li><a href="../../Parameters/session/file.html" class="param" title="">.session.file:</a>
        <a href="#_line0044" class="code"}">44 </a>    <a href="#_line0053" class="code"}">53 </a></li><li><a href="../../Parameters/session/initTime.html" class="param" title="">.session.initTime:</a>
        <a href="#_line0027" class="code"}">27 </a></li></ul>
<!-- parameterreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">pauseLoop</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre><div id="_line0001" class="line">0001 <a name="_sub0" href="#_subfunctions" class="code">function p = run(p)</a>
</div><div id="_line0002" class="line">0002 <span class="comment">%run    run a new experiment for a previuously created pldaps class</span>
</div><div id="_line0003" class="line">0003 <span class="comment">% p = run(p)</span>
</div><div id="_line0004" class="line">0004 <span class="comment">% PLDAPS (Plexon Datapixx PsychToolbox) version 4.1</span>
</div><div id="_line0005" class="line">0005 <span class="comment">%       run is a wrapper for calling PLDAPS package files</span>
</div><div id="_line0006" class="line">0006 <span class="comment">%           It opens the PsychImaging pipeline and initializes datapixx for</span>
</div><div id="_line0007" class="line">0007 <span class="comment">%           dual color lookup tables.</span>
</div><div id="_line0008" class="line">0008 <span class="comment">% 10/2011 jly wrote it (modified from letsgorun.m)</span>
</div><div id="_line0009" class="line">0009 <span class="comment">% 12/2013 jly reboot. updated to version 3 format.</span>
</div><div id="_line0010" class="line">0010 <span class="comment">% 04/2014 jk  moved into a pldaps class; adapated to new class structure</span>
</div><div id="_line0011" class="line">0011 
</div><div id="_line0012" class="line">0012 <span class="comment">%TODO:</span>
</div><div id="_line0013" class="line">0013 <span class="comment">% one unified system for modules, e.g. moduleSetup, moduleUpdate, moduleClose</span>
</div><div id="_line0014" class="line">0014 <span class="comment">% make HideCursor optional</span>
</div><div id="_line0015" class="line">0015 <span class="comment">% TODO:reset class at end of experiment or mark as recorded, so I don't</span>
</div><div id="_line0016" class="line">0016 <span class="comment">% run the same again by mistake</span>
</div><div id="_line0017" class="line">0017 
</div><div id="_line0018" class="line">0018 <span class="keyword">try</span>
</div><div id="_line0019" class="line">0019     <span class="comment">%% Setup and File management</span>
</div><div id="_line0020" class="line">0020     <span class="comment">% Enure we have an experimentSetupFile set and verify output file</span>
</div><div id="_line0021" class="line">0021     
</div><div id="_line0022" class="line">0022     <span class="comment">%make sure we are not running an experiment twice</span>
</div><div id="_line0023" class="line">0023     <span class="keyword">if</span> isField(p.defaultParameters, <span class="string">'session.initTime'</span>)
</div><div id="_line0024" class="line">0024         warning(<span class="string">'pldaps:run'</span>, <span class="string">'pldaps objects appears to have been run before. A new pldaps object is needed for each run'</span>);
</div><div id="_line0025" class="line">0025         <span class="keyword">return</span>
</div><div id="_line0026" class="line">0026     <span class="keyword">else</span>
</div><div id="_line0027" class="line">0027         p.defaultParameters<a href="../../Parameters/session/initTime.html" class="param" title="">.session.initTime</a>=now;
</div><div id="_line0028" class="line">0028     <span class="keyword">end</span>
</div><div id="_line0029" class="line">0029     
</div><div id="_line0030" class="line">0030     <span class="comment">% pick YOUR experiment's main CONDITION file-- this is where all</span>
</div><div id="_line0031" class="line">0031     <span class="comment">% expt-specific stuff emerges from</span>
</div><div id="_line0032" class="line">0032     <span class="keyword">if</span> isempty(p.defaultParameters<a href="../../Parameters/session/experimentSetupFile.html" class="param" title="">.session.experimentSetupFile</a>)
</div><div id="_line0033" class="line">0033         [cfile, cpath] = uigetfile(<span class="string">'*.m'</span>, <span class="string">'choose condition file'</span>, [base <span class="string">'/CONDITION/debugcondition.m'</span>]); <span class="comment">%#ok&lt;NASGU&gt;</span>
</div><div id="_line0034" class="line">0034         
</div><div id="_line0035" class="line">0035         dotm = strfind(cfile, <span class="string">'.m'</span>);
</div><div id="_line0036" class="line">0036         <span class="keyword">if</span> ~isempty(dotm)
</div><div id="_line0037" class="line">0037             cfile(dotm:end) = [];
</div><div id="_line0038" class="line">0038         <span class="keyword">end</span>
</div><div id="_line0039" class="line">0039         p.defaultParameters<a href="../../Parameters/session/experimentSetupFile.html" class="param" title="">.session.experimentSetupFile</a> = cfile;
</div><div id="_line0040" class="line">0040     <span class="keyword">end</span>
</div><div id="_line0041" class="line">0041         
</div><div id="_line0042" class="line">0042     <span class="keyword">if</span> ~p.defaultParameters<a href="../../Parameters/pldaps/nosave.html" class="param" title="disables saving of data when true. see .pldaps.save for more control">.pldaps.nosave</a>
</div><div id="_line0043" class="line">0043         p.defaultParameters<a href="../../Parameters/session/dir.html" class="param" title="">.session.dir</a> = p.defaultParameters<a href="../../Parameters/pldaps/dirs/data.html" class="param" title="data directory.">.pldaps.dirs.data</a>;
</div><div id="_line0044" class="line">0044         p.defaultParameters<a href="../../Parameters/session/file.html" class="param" title="">.session.file</a> = [p.defaultParameters<a href="../../Parameters/session/subject.html" class="param" title="">.session.subject</a> datestr(p.defaultParameters<a href="../../Parameters/session/initTime.html" class="param" title="">.session.initTime</a>, <span class="string">'yyyymmdd'</span>) p.defaultParameters<a href="../../Parameters/session/experimentSetupFile.html" class="param" title="">.session.experimentSetupFile</a> datestr(p.defaultParameters<a href="../../Parameters/session/initTime.html" class="param" title="">.session.initTime</a>, <span class="string">'HHMM'</span>) <span class="string">'.PDS'</span>];
</div><div id="_line0045" class="line">0045 <span class="comment">%         p.defaultParameters.session.file = fullfile(p.defaultParameters.pldaps.dirs.data, [p.defaultParameters.session.subject datestr(p.defaultParameters.session.initTime, 'yyyymmdd') p.defaultParameters.session.experimentSetupFile datestr(p.defaultParameters.session.initTime, 'HHMM') '.PDS']);</span>
</div><div id="_line0046" class="line">0046         
</div><div id="_line0047" class="line">0047         <span class="keyword">if</span> p.defaultParameters<a href="../../Parameters/pldaps/useFileGUI.html" class="param" title="use a GUI to specify the output file.">.pldaps.useFileGUI</a>
</div><div id="_line0048" class="line">0048             [cfile, cdir] = uiputfile(<span class="string">'.PDS'</span>, <span class="string">'specify data storage file'</span>, fullfile( p.defaultParameters<a href="../../Parameters/session/dir.html" class="param" title="">.session.dir</a>,  p.defaultParameters<a href="../../Parameters/session/file.html" class="param" title="">.session.file</a>));
</div><div id="_line0049" class="line">0049             <span class="keyword">if</span>(isnumeric(cfile)) <span class="comment">%got canceled</span>
</div><div id="_line0050" class="line">0050                 error(<span class="string">'pldaps:run'</span>,<span class="string">'file selection canceled. Not sure what the correct default bevaior would be, so stopping the experiment.'</span>)
</div><div id="_line0051" class="line">0051             <span class="keyword">end</span>
</div><div id="_line0052" class="line">0052             p.defaultParameters<a href="../../Parameters/session/dir.html" class="param" title="">.session.dir</a> = cdir;
</div><div id="_line0053" class="line">0053             p.defaultParameters<a href="../../Parameters/session/file.html" class="param" title="">.session.file</a> = cfile;
</div><div id="_line0054" class="line">0054         <span class="keyword">end</span>
</div><div id="_line0055" class="line">0055 
</div><div id="_line0056" class="line">0056          <span class="keyword">if</span> ~exist(p.trial<a href="../../Parameters/session/dir.html" class="param" title="">.session.dir</a>, <span class="string">'dir'</span>)
</div><div id="_line0057" class="line">0057             warning(<span class="string">'pldaps:run'</span>,<span class="string">'Data directory specified in .pldaps.dirs.data does not exist. Quitting PLDAPS. p.trial.pldaps.dirs.data=%s\nPlease create the directory along with a subdirectory called TEMP'</span>,p.trial<a href="../../Parameters/session/dir.html" class="param" title="">.session.dir</a>);
</div><div id="_line0058" class="line">0058             <span class="keyword">return</span>;
</div><div id="_line0059" class="line">0059          <span class="keyword">end</span>
</div><div id="_line0060" class="line">0060     <span class="keyword">else</span>
</div><div id="_line0061" class="line">0061         p.defaultParameters<a href="../../Parameters/session/file.html" class="param" title="">.session.file</a>=<span class="string">''</span>;
</div><div id="_line0062" class="line">0062         p.defaultParameters<a href="../../Parameters/session/dir.html" class="param" title="">.session.dir</a>=<span class="string">''</span>;
</div><div id="_line0063" class="line">0063     <span class="keyword">end</span>
</div><div id="_line0064" class="line">0064 
</div><div id="_line0065" class="line">0065     <span class="keyword">if</span> p.trial<a href="../../Parameters/pldaps/useModularStateFunctions.html" class="param" title="use modular state functions, see pldaps.runModularTrial, pldaps.getModules, pldaps.runStateforModules">.pldaps.useModularStateFunctions</a>
</div><div id="_line0066" class="line">0066         <span class="comment">%experimentSetup before openScreen to allow modifyiers</span>
</div><div id="_line0067" class="line">0067         [modulesNames,moduleFunctionHandles,moduleRequestedStates,moduleLocationInputs] = <a href="getModules.html" class="code" title="function [modules,moduleFunctionHandles,moduleRequestedStates,moduleLocationInputs] = getModules(p)">getModules</a>(p);
</div><div id="_line0068" class="line">0068         <a href="runStateforModules.html" class="code" title="function runStateforModules(p,state,modules,moduleFunctionHandles,moduleRequestedStates,moduleLocationInputs)">runStateforModules</a>(p,<span class="string">'experimentPreOpenScreen'</span>,modulesNames,moduleFunctionHandles,moduleRequestedStates,moduleLocationInputs);
</div><div id="_line0069" class="line">0069     <span class="keyword">end</span>
</div><div id="_line0070" class="line">0070     
</div><div id="_line0071" class="line">0071     <span class="comment">%% Open PLDAPS windows</span>
</div><div id="_line0072" class="line">0072     <span class="comment">% Open PsychToolbox Screen</span>
</div><div id="_line0073" class="line">0073     p = <a href="openScreen.html" class="code" title="function p = openScreen(p)">openScreen</a>(p);
</div><div id="_line0074" class="line">0074     
</div><div id="_line0075" class="line">0075     <span class="comment">% Setup PLDAPS experiment condition</span>
</div><div id="_line0076" class="line">0076     p.defaultParameters<a href="../../Parameters/pldaps/maxFrames.html" class="param" title="">.pldaps.maxFrames</a>=p.defaultParameters<a href="../../Parameters/pldaps/maxTrialLength.html" class="param" title="Maximum duration of a trial in seconds. Used to allocate memory.">.pldaps.maxTrialLength</a>*p.defaultParameters<a href="../../Parameters/display/frate.html" class="param" title="">.display.frate</a>;
</div><div id="_line0077" class="line">0077     feval(p.defaultParameters<a href="../../Parameters/session/experimentSetupFile.html" class="param" title="">.session.experimentSetupFile</a>, p);
</div><div id="_line0078" class="line">0078     
</div><div id="_line0079" class="line">0079             <span class="comment">%</span>
</div><div id="_line0080" class="line">0080             <span class="comment">% Setup Photodiode stimuli</span>
</div><div id="_line0081" class="line">0081             <span class="comment">%-------------------------------------------------------------------------%</span>
</div><div id="_line0082" class="line">0082             <span class="keyword">if</span>(p.trial<a href="../../Parameters/pldaps/draw/photodiode/use.html" class="param" title="enable drawing the photodione square">.pldaps.draw.photodiode.use</a>)
</div><div id="_line0083" class="line">0083                 <a href="../../PLDAPS/SupportFunctions/Utils/makePhotodiodeRect.html" class="code" title="function dv = makePhotodiodeRect(dv)">makePhotodiodeRect</a>(p);
</div><div id="_line0084" class="line">0084             <span class="keyword">end</span>
</div><div id="_line0085" class="line">0085     
</div><div id="_line0086" class="line">0086             <span class="comment">% Tick Marks</span>
</div><div id="_line0087" class="line">0087             <span class="comment">%-------------------------------------------------------------------------%</span>
</div><div id="_line0088" class="line">0088             <span class="keyword">if</span>(p.trial<a href="../../Parameters/pldaps/draw/grid/use.html" class="param" title="enable drawing of the grid">.pldaps.draw.grid.use</a>)
</div><div id="_line0089" class="line">0089                 p = <a href="../../PLDAPS/SupportFunctions/Utils/initTicks.html" class="code" title="function p = initTicks(p)">initTicks</a>(p);
</div><div id="_line0090" class="line">0090             <span class="keyword">end</span>
</div><div id="_line0091" class="line">0091 
</div><div id="_line0092" class="line">0092 
</div><div id="_line0093" class="line">0093             <span class="comment">%get and store changes of current code to the git repository</span>
</div><div id="_line0094" class="line">0094             p = <a href="../../PLDAPS/+pds/+git/pds.git.setup.html" class="code" title="function p = setup(p)">pds.git.setup</a>(p);
</div><div id="_line0095" class="line">0095             
</div><div id="_line0096" class="line">0096             <span class="comment">%things that were in the conditionFile</span>
</div><div id="_line0097" class="line">0097             p = <a href="../../PLDAPS/+pds/+eyelink/pds.eyelink.setup.html" class="code" title="function p = setup(p)">pds.eyelink.setup</a>(p);
</div><div id="_line0098" class="line">0098     
</div><div id="_line0099" class="line">0099             <span class="comment">%things that where in the default Trial Structure</span>
</div><div id="_line0100" class="line">0100             
</div><div id="_line0101" class="line">0101             <span class="comment">% Audio</span>
</div><div id="_line0102" class="line">0102             <span class="comment">%-------------------------------------------------------------------------%</span>
</div><div id="_line0103" class="line">0103             p = <a href="../../PLDAPS/+pds/+audio/pds.audio.setup.html" class="code" title="function p = setup(p)">pds.audio.setup</a>(p);
</div><div id="_line0104" class="line">0104             
</div><div id="_line0105" class="line">0105             <span class="comment">% PLEXON</span>
</div><div id="_line0106" class="line">0106             <span class="comment">%-------------------------------------------------------------------------%</span>
</div><div id="_line0107" class="line">0107             p = <a href="../../PLDAPS/+pds/+plexon/+spikeserver/pds.plexon.spikeserver.connect.html" class="code" title="function p = connect(p)">pds.plexon.spikeserver.connect</a>(p);
</div><div id="_line0108" class="line">0108             
</div><div id="_line0109" class="line">0109             <span class="comment">% REWARD</span>
</div><div id="_line0110" class="line">0110             <span class="comment">%-------------------------------------------------------------------------%</span>
</div><div id="_line0111" class="line">0111             p = <a href="../../PLDAPS/+pds/+behavior/+reward/pds.behavior.reward.setup.html" class="code" title="function p = setup(p)">pds.behavior.reward.setup</a>(p);
</div><div id="_line0112" class="line">0112                      
</div><div id="_line0113" class="line">0113             <span class="comment">% Initialize Datapixx including dual CLUTS and timestamp</span>
</div><div id="_line0114" class="line">0114             <span class="comment">% logging</span>
</div><div id="_line0115" class="line">0115             p = <a href="../../PLDAPS/+pds/+datapixx/pds.datapixx.init.html" class="code" title="function p =  init(p)">pds.datapixx.init</a>(p);
</div><div id="_line0116" class="line">0116             
</div><div id="_line0117" class="line">0117             <a href="../../PLDAPS/+pds/+keyboard/pds.keyboard.setup.html" class="code" title="function p = setup(p,scan)">pds.keyboard.setup</a>(p);
</div><div id="_line0118" class="line">0118     
</div><div id="_line0119" class="line">0119             <span class="keyword">if</span> p.trial<a href="../../Parameters/pldaps/useModularStateFunctions.html" class="param" title="use modular state functions, see pldaps.runModularTrial, pldaps.getModules, pldaps.runStateforModules">.pldaps.useModularStateFunctions</a>
</div><div id="_line0120" class="line">0120                 [modulesNames,moduleFunctionHandles,moduleRequestedStates,moduleLocationInputs] = <a href="getModules.html" class="code" title="function [modules,moduleFunctionHandles,moduleRequestedStates,moduleLocationInputs] = getModules(p)">getModules</a>(p);
</div><div id="_line0121" class="line">0121                 <a href="runStateforModules.html" class="code" title="function runStateforModules(p,state,modules,moduleFunctionHandles,moduleRequestedStates,moduleLocationInputs)">runStateforModules</a>(p,<span class="string">'experimentPostOpenScreen'</span>,modulesNames,moduleFunctionHandles,moduleRequestedStates,moduleLocationInputs);
</div><div id="_line0122" class="line">0122             <span class="keyword">end</span>
</div><div id="_line0123" class="line">0123 
</div><div id="_line0124" class="line">0124     <span class="comment">%% Last chance to check variables</span>
</div><div id="_line0125" class="line">0125     <span class="keyword">if</span>(p.trial<a href="../../Parameters/pldaps/pause/type.html" class="param" title="Only type 1 is currently tested.">.pldaps.pause.type</a>==1 &amp;&amp; p.trial<a href="../../Parameters/pldaps/pause/preExperiment.html" class="param" title="pause before experiment starts">.pldaps.pause.preExperiment</a>==true) <span class="comment">%0=don't,1 is debugger, 2=pause loop</span>
</div><div id="_line0126" class="line">0126         p  <span class="comment">%#ok&lt;NOPRT&gt;</span>
</div><div id="_line0127" class="line">0127         disp(<span class="string">'Ready to begin trials. Type return to start first trial...'</span>)
</div><div id="_line0128" class="line">0128         keyboard <span class="comment">%#ok&lt;MCKBD&gt;</span>
</div><div id="_line0129" class="line">0129     <span class="keyword">end</span>
</div><div id="_line0130" class="line">0130  
</div><div id="_line0131" class="line">0131     <span class="comment">%%%%start recoding on all controlled components this in not currently done here</span>
</div><div id="_line0132" class="line">0132     <span class="comment">% save timing info from all controlled components (datapixx, eyelink, this pc)</span>
</div><div id="_line0133" class="line">0133     p = <a href="beginExperiment.html" class="code" title="function p = beginExperiment(p)">beginExperiment</a>(p);
</div><div id="_line0134" class="line">0134 
</div><div id="_line0135" class="line">0135     <span class="comment">% disable keyboard</span>
</div><div id="_line0136" class="line">0136     ListenChar(2)
</div><div id="_line0137" class="line">0137     HideCursor
</div><div id="_line0138" class="line">0138     
</div><div id="_line0139" class="line">0139     p.trial<a href="../../Parameters/flagNextTrial.html" class="param" title="">.flagNextTrial</a>  = 0; <span class="comment">% flag for ending the trial</span>
</div><div id="_line0140" class="line">0140     p.trial<a href="../../Parameters/iFrame.html" class="param" title="">.iFrame</a>     = 1;  <span class="comment">% frame index</span>
</div><div id="_line0141" class="line">0141     
</div><div id="_line0142" class="line">0142     <span class="comment">%save defaultParameters as trial 0</span>
</div><div id="_line0143" class="line">0143     trialNr=0;
</div><div id="_line0144" class="line">0144     p.trial<a href="../../Parameters/pldaps/iTrial.html" class="param" title="trial number. cannot be changed by the user">.pldaps.iTrial</a>=0;
</div><div id="_line0145" class="line">0145     p.trial=mergeToSingleStruct(p.defaultParameters);
</div><div id="_line0146" class="line">0146     result = <a href="saveTempFile.html" class="code" title="function result = saveTempFile(p)">saveTempFile</a>(p); 
</div><div id="_line0147" class="line">0147     <span class="keyword">if</span> ~isempty(result)
</div><div id="_line0148" class="line">0148         disp(result.message)
</div><div id="_line0149" class="line">0149     <span class="keyword">end</span>
</div><div id="_line0150" class="line">0150         
</div><div id="_line0151" class="line">0151     
</div><div id="_line0152" class="line">0152     
</div><div id="_line0153" class="line">0153     <span class="comment">%now setup everything for the first trial</span>
</div><div id="_line0154" class="line">0154    
</div><div id="_line0155" class="line">0155 <span class="comment">%     dv.defaultParameters.pldaps.iTrial=trialNr;</span>
</div><div id="_line0156" class="line">0156     
</div><div id="_line0157" class="line">0157     <span class="comment">%we'll have a trialNr counter that the trial function can tamper with?</span>
</div><div id="_line0158" class="line">0158     <span class="comment">%do we need to lock the defaultParameters to prevent tampering there?</span>
</div><div id="_line0159" class="line">0159     levelsPreTrials=p.defaultParameters<a href="../../Parameters/getAllLevels.html" class="param" title="">.getAllLevels</a>();
</div><div id="_line0160" class="line">0160 <span class="comment">%     dv.defaultParameters.addLevels(dv.conditions(trialNr), {['Trial' num2str(trialNr) 'Parameters']});</span>
</div><div id="_line0161" class="line">0161     
</div><div id="_line0162" class="line">0162     <span class="comment">%for now all structs will be in the parameters class, first</span>
</div><div id="_line0163" class="line">0163     <span class="comment">%levelsPreTrials, then we'll add the condition struct before each trial.</span>
</div><div id="_line0164" class="line">0164 <span class="comment">%     dv.defaultParameters.setLevels([levelsPreTrials length(levelsPreTrials)+trialNr])</span>
</div><div id="_line0165" class="line">0165 <span class="comment">%     dv.defaultParameters.pldaps.iTrial=trialNr;</span>
</div><div id="_line0166" class="line">0166 <span class="comment">%     dv.trial=mergeToSingleStruct(dv.defaultParameters);</span>
</div><div id="_line0167" class="line">0167     
</div><div id="_line0168" class="line">0168     <span class="comment">%only use dv.trial from here on!</span>
</div><div id="_line0169" class="line">0169     
</div><div id="_line0170" class="line">0170     <span class="comment">%% main trial loop %%</span>
</div><div id="_line0171" class="line">0171     <span class="keyword">while</span> p.trial<a href="../../Parameters/pldaps/iTrial.html" class="param" title="trial number. cannot be changed by the user">.pldaps.iTrial</a> &lt; p.trial<a href="../../Parameters/pldaps/finish.html" class="param" title="Number of trials to run. can be changed dynamically">.pldaps.finish</a> &amp;&amp; p.trial<a href="../../Parameters/pldaps/quit.html" class="param" title="control expeiment during a trial.">.pldaps.quit</a>~=2
</div><div id="_line0172" class="line">0172         
</div><div id="_line0173" class="line">0173         <span class="keyword">if</span> p.trial<a href="../../Parameters/pldaps/quit.html" class="param" title="control expeiment during a trial.">.pldaps.quit</a> == 0
</div><div id="_line0174" class="line">0174             
</div><div id="_line0175" class="line">0175            <span class="comment">%load parameters for next trial and lock defaultsParameters</span>
</div><div id="_line0176" class="line">0176            trialNr=trialNr+1;
</div><div id="_line0177" class="line">0177            <span class="keyword">if</span> ~isempty(p.conditions)
</div><div id="_line0178" class="line">0178             p.defaultParameters<a href="../../Parameters/addLevels.html" class="param" title="">.addLevels</a>(p.conditions(trialNr), {[<span class="string">'Trial'</span> num2str(trialNr) <span class="string">'Parameters'</span>]});
</div><div id="_line0179" class="line">0179             p.defaultParameters<a href="../../Parameters/setLevels.html" class="param" title="">.setLevels</a>([levelsPreTrials length(levelsPreTrials)+trialNr]);
</div><div id="_line0180" class="line">0180            <span class="keyword">else</span>
</div><div id="_line0181" class="line">0181             p.defaultParameters<a href="../../Parameters/setLevels.html" class="param" title="">.setLevels</a>([levelsPreTrials]);
</div><div id="_line0182" class="line">0182            <span class="keyword">end</span>
</div><div id="_line0183" class="line">0183            p.defaultParameters<a href="../../Parameters/pldaps/iTrial.html" class="param" title="trial number. cannot be changed by the user">.pldaps.iTrial</a>=trialNr;
</div><div id="_line0184" class="line">0184            
</div><div id="_line0185" class="line">0185 
</div><div id="_line0186" class="line">0186            <span class="comment">%it looks like the trial struct gets really partitioned in</span>
</div><div id="_line0187" class="line">0187            <span class="comment">%memory and this appears to make some get (!) calls slow.</span>
</div><div id="_line0188" class="line">0188            <span class="comment">%We thus need a deep copy. The superclass matlab.mixin.Copyable</span>
</div><div id="_line0189" class="line">0189            <span class="comment">%is supposed to do that, but that is ver very slow, so we create</span>
</div><div id="_line0190" class="line">0190            <span class="comment">%a manual deep copy by saving the struct to a file and loading it</span>
</div><div id="_line0191" class="line">0191            <span class="comment">%back in.</span>
</div><div id="_line0192" class="line">0192            tmpts=mergeToSingleStruct(p.defaultParameters);
</div><div id="_line0193" class="line">0193            save([p.trial<a href="../../Parameters/pldaps/dirs/data.html" class="param" title="data directory.">.pldaps.dirs.data</a> filesep <span class="string">'TEMP'</span> filesep <span class="string">'deepTrialStruct'</span>], <span class="string">'tmpts'</span>);
</div><div id="_line0194" class="line">0194            clear tmpts
</div><div id="_line0195" class="line">0195            load([p.trial<a href="../../Parameters/pldaps/dirs/data.html" class="param" title="data directory.">.pldaps.dirs.data</a> filesep <span class="string">'TEMP'</span> filesep <span class="string">'deepTrialStruct'</span>]);
</div><div id="_line0196" class="line">0196            p.trial=tmpts;
</div><div id="_line0197" class="line">0197            clear tmpts;
</div><div id="_line0198" class="line">0198 <span class="comment">%             p.trial=mergeToSingleStruct(p.defaultParameters);</span>
</div><div id="_line0199" class="line">0199             
</div><div id="_line0200" class="line">0200 
</div><div id="_line0201" class="line">0201            p.defaultParameters<a href="../../Parameters/setLock.html" class="param" title="">.setLock</a>(true);
</div><div id="_line0202" class="line">0202             
</div><div id="_line0203" class="line">0203            <span class="comment">% run trial</span>
</div><div id="_line0204" class="line">0204            p = feval(p.trial<a href="../../Parameters/pldaps/trialMasterFunction.html" class="param" title="function to be called to run a single Trial.">.pldaps.trialMasterFunction</a>,  p);
</div><div id="_line0205" class="line">0205             
</div><div id="_line0206" class="line">0206            <span class="comment">%unlock the defaultParameters</span>
</div><div id="_line0207" class="line">0207            p.defaultParameters<a href="../../Parameters/setLock.html" class="param" title="">.setLock</a>(false); 
</div><div id="_line0208" class="line">0208             
</div><div id="_line0209" class="line">0209            <span class="comment">%save tmp data</span>
</div><div id="_line0210" class="line">0210            result = <a href="saveTempFile.html" class="code" title="function result = saveTempFile(p)">saveTempFile</a>(p); 
</div><div id="_line0211" class="line">0211            <span class="keyword">if</span> ~isempty(result)
</div><div id="_line0212" class="line">0212                disp(result.message)
</div><div id="_line0213" class="line">0213            <span class="keyword">end</span>
</div><div id="_line0214" class="line">0214                       
</div><div id="_line0215" class="line">0215            <span class="keyword">if</span> p.defaultParameters<a href="../../Parameters/pldaps/save/mergedData.html" class="param" title="Save merged data">.pldaps.save.mergedData</a>
</div><div id="_line0216" class="line">0216                <span class="comment">%store the complete trial struct to .data</span>
</div><div id="_line0217" class="line">0217                dTrialStruct = p.trial;
</div><div id="_line0218" class="line">0218            <span class="keyword">else</span>
</div><div id="_line0219" class="line">0219                <span class="comment">%store the difference of the trial struct to .data</span>
</div><div id="_line0220" class="line">0220                dTrialStruct=getDifferenceFromStruct(p.defaultParameters,p.trial);
</div><div id="_line0221" class="line">0221            <span class="keyword">end</span>
</div><div id="_line0222" class="line">0222            p.data{trialNr}=dTrialStruct;
</div><div id="_line0223" class="line">0223            
</div><div id="_line0224" class="line">0224            
</div><div id="_line0225" class="line">0225            <span class="keyword">if</span> p.trial<a href="../../Parameters/pldaps/useModularStateFunctions.html" class="param" title="use modular state functions, see pldaps.runModularTrial, pldaps.getModules, pldaps.runStateforModules">.pldaps.useModularStateFunctions</a>
</div><div id="_line0226" class="line">0226                oldptrial=p.trial;
</div><div id="_line0227" class="line">0227                [modulesNames,moduleFunctionHandles,moduleRequestedStates,moduleLocationInputs] = <a href="getModules.html" class="code" title="function [modules,moduleFunctionHandles,moduleRequestedStates,moduleLocationInputs] = getModules(p)">getModules</a>(p);
</div><div id="_line0228" class="line">0228                p.defaultParameters<a href="../../Parameters/setLevels.html" class="param" title="">.setLevels</a>(levelsPreTrials);
</div><div id="_line0229" class="line">0229                p.defaultParameters<a href="../../Parameters/pldaps/iTrial.html" class="param" title="trial number. cannot be changed by the user">.pldaps.iTrial</a>=trialNr;
</div><div id="_line0230" class="line">0230                p.trial=mergeToSingleStruct(p.defaultParameters);
</div><div id="_line0231" class="line">0231                p.defaultParameters<a href="../../Parameters/setLock.html" class="param" title="">.setLock</a>(true); 
</div><div id="_line0232" class="line">0232 
</div><div id="_line0233" class="line">0233                <a href="runStateforModules.html" class="code" title="function runStateforModules(p,state,modules,moduleFunctionHandles,moduleRequestedStates,moduleLocationInputs)">runStateforModules</a>(p,<span class="string">'experimentAfterTrials'</span>,modulesNames,moduleFunctionHandles,moduleRequestedStates,moduleLocationInputs);
</div><div id="_line0234" class="line">0234 
</div><div id="_line0235" class="line">0235                p.defaultParameters<a href="../../Parameters/setLock.html" class="param" title="">.setLock</a>(false); 
</div><div id="_line0236" class="line">0236                betweenTrialsStruct=getDifferenceFromStruct(p.defaultParameters,p.trial);
</div><div id="_line0237" class="line">0237                <span class="keyword">if</span>(~isequal(struct,betweenTrialsStruct))
</div><div id="_line0238" class="line">0238                     p.defaultParameters<a href="../../Parameters/addLevels.html" class="param" title="">.addLevels</a>({betweenTrialsStruct}, {[<span class="string">'experimentAfterTrials'</span> num2str(trialNr) <span class="string">'Parameters'</span>]});
</div><div id="_line0239" class="line">0239                     levelsPreTrials=[levelsPreTrials length(p.defaultParameters<a href="../../Parameters/getAllLevels.html" class="param" title="">.getAllLevels</a>())]; <span class="comment">%#ok&lt;AGROW&gt;</span>
</div><div id="_line0240" class="line">0240                <span class="keyword">end</span>
</div><div id="_line0241" class="line">0241 
</div><div id="_line0242" class="line">0242                p.trial=oldptrial;
</div><div id="_line0243" class="line">0243            <span class="keyword">end</span>
</div><div id="_line0244" class="line">0244            
</div><div id="_line0245" class="line">0245            <span class="keyword">if</span> ~p.defaultParameters<a href="../../Parameters/datapixx/use.html" class="param" title="enable control of VPixx devices">.datapixx.use</a> &amp;&amp; p.defaultParameters<a href="../../Parameters/display/useOverlay.html" class="param" title="create an overlay pointer.">.display.useOverlay</a>
</div><div id="_line0246" class="line">0246                 glDeleteTextures(2,glGenTextures(1));
</div><div id="_line0247" class="line">0247            <span class="keyword">end</span>
</div><div id="_line0248" class="line">0248 
</div><div id="_line0249" class="line">0249            <span class="comment">%advance to next trial</span>
</div><div id="_line0250" class="line">0250 <span class="comment">%            if(dv.trial.pldaps.iTrial ~= dv.trial.pldaps.finish)</span>
</div><div id="_line0251" class="line">0251 <span class="comment">%                 %now we add this and the next Trials condition parameters</span>
</div><div id="_line0252" class="line">0252 <span class="comment">%                 dv.defaultParameters.addLevels(dv.conditions(trialNr), {['Trial' num2str(trialNr) 'Parameters']},[levelsPreTrials length(levelsPreTrials)+trialNr]);</span>
</div><div id="_line0253" class="line">0253 <span class="comment">%                 dv.defaultParameters.pldaps.iTrial=trialNr;</span>
</div><div id="_line0254" class="line">0254 <span class="comment">%                 dv.trial=mergeToSingleStruct(dv.defaultParameters);</span>
</div><div id="_line0255" class="line">0255 <span class="comment">%            else</span>
</div><div id="_line0256" class="line">0256 <span class="comment">%                 dv.trial.pldaps.iTrial=trialNr;</span>
</div><div id="_line0257" class="line">0257 <span class="comment">%            end</span>
</div><div id="_line0258" class="line">0258 <span class="comment">%</span>
</div><div id="_line0259" class="line">0259 <span class="comment">%            if isfield(dTrialStruct,'pldaps')</span>
</div><div id="_line0260" class="line">0260 <span class="comment">%                if isfield(dTrialStruct.pldaps,'finish')</span>
</div><div id="_line0261" class="line">0261 <span class="comment">%                     dv.trial.pldaps.finish=dTrialStruct.pldaps.finish;</span>
</div><div id="_line0262" class="line">0262 <span class="comment">%                end</span>
</div><div id="_line0263" class="line">0263 <span class="comment">%                if isfield(dTrialStruct.pldaps,'quit')</span>
</div><div id="_line0264" class="line">0264 <span class="comment">%                     dv.trial.pldaps.quit=dTrialStruct.pldaps.quit;</span>
</div><div id="_line0265" class="line">0265 <span class="comment">%                end</span>
</div><div id="_line0266" class="line">0266 <span class="comment">%            end</span>
</div><div id="_line0267" class="line">0267             
</div><div id="_line0268" class="line">0268         <span class="keyword">else</span> <span class="comment">%dbquit ==1 is meant to be pause. should we halt eyelink, datapixx, etc?</span>
</div><div id="_line0269" class="line">0269             <span class="comment">%create a new level to store all changes in,</span>
</div><div id="_line0270" class="line">0270             <span class="comment">%load only non trial paraeters</span>
</div><div id="_line0271" class="line">0271             pause=p.trial<a href="../../Parameters/pldaps/pause/type.html" class="param" title="Only type 1 is currently tested.">.pldaps.pause.type</a>;
</div><div id="_line0272" class="line">0272             p.trial=p.defaultParameters;
</div><div id="_line0273" class="line">0273             
</div><div id="_line0274" class="line">0274             p.defaultParameters<a href="../../Parameters/addLevels.html" class="param" title="">.addLevels</a>({struct}, {[<span class="string">'PauseAfterTrial'</span> num2str(trialNr) <span class="string">'Parameters'</span>]});
</div><div id="_line0275" class="line">0275             p.defaultParameters<a href="../../Parameters/setLevels.html" class="param" title="">.setLevels</a>([levelsPreTrials length(p.defaultParameters<a href="../../Parameters/getAllLevels.html" class="param" title="">.getAllLevels</a>())]);
</div><div id="_line0276" class="line">0276             
</div><div id="_line0277" class="line">0277             <span class="keyword">if</span> pause==1 <span class="comment">%0=don't,1 is debugger, 2=pause loop</span>
</div><div id="_line0278" class="line">0278                 ListenChar(0);
</div><div id="_line0279" class="line">0279                 ShowCursor;
</div><div id="_line0280" class="line">0280                 p.trial
</div><div id="_line0281" class="line">0281                 disp(<span class="string">'Ready to begin trials. Type return to start first trial...'</span>)
</div><div id="_line0282" class="line">0282                 keyboard <span class="comment">%#ok&lt;MCKBD&gt;</span>
</div><div id="_line0283" class="line">0283                 p.trial<a href="../../Parameters/pldaps/quit.html" class="param" title="control expeiment during a trial.">.pldaps.quit</a> = 0;
</div><div id="_line0284" class="line">0284                 ListenChar(2);
</div><div id="_line0285" class="line">0285                 HideCursor;
</div><div id="_line0286" class="line">0286             <span class="keyword">elseif</span> pause==2
</div><div id="_line0287" class="line">0287                 <a href="#_sub1" class="code" title="subpauseLoop">pauseLoop</a>(p);
</div><div id="_line0288" class="line">0288             <span class="keyword">end</span>           
</div><div id="_line0289" class="line">0289 <span class="comment">%             pds.datapixx.refresh(dv);</span>
</div><div id="_line0290" class="line">0290 
</div><div id="_line0291" class="line">0291             <span class="comment">%now I'm assuming that nobody created new levels,</span>
</div><div id="_line0292" class="line">0292             <span class="comment">%but I guess when you know how to do that</span>
</div><div id="_line0293" class="line">0293             <span class="comment">%you should also now how to not skrew things up</span>
</div><div id="_line0294" class="line">0294             allStructs=p.defaultParameters<a href="../../Parameters/getAllStructs.html" class="param" title="">.getAllStructs</a>();
</div><div id="_line0295" class="line">0295             <span class="keyword">if</span>(~isequal(struct,allStructs{end}))
</div><div id="_line0296" class="line">0296                 levelsPreTrials=[levelsPreTrials length(allStructs)]; <span class="comment">%#ok&lt;AGROW&gt;</span>
</div><div id="_line0297" class="line">0297             <span class="keyword">end</span>
</div><div id="_line0298" class="line">0298         <span class="keyword">end</span>
</div><div id="_line0299" class="line">0299         
</div><div id="_line0300" class="line">0300     <span class="keyword">end</span>
</div><div id="_line0301" class="line">0301     
</div><div id="_line0302" class="line">0302     <span class="comment">%make the session parameterStruct active</span>
</div><div id="_line0303" class="line">0303     p.defaultParameters<a href="../../Parameters/setLevels.html" class="param" title="">.setLevels</a>(levelsPreTrials);
</div><div id="_line0304" class="line">0304     p.trial = p.defaultParameters;
</div><div id="_line0305" class="line">0305     
</div><div id="_line0306" class="line">0306     <span class="comment">% return cursor and command-line control</span>
</div><div id="_line0307" class="line">0307     ShowCursor;
</div><div id="_line0308" class="line">0308     ListenChar(0);
</div><div id="_line0309" class="line">0309     Priority(0);
</div><div id="_line0310" class="line">0310     
</div><div id="_line0311" class="line">0311     p = <a href="../../PLDAPS/+pds/+eyelink/pds.eyelink.finish.html" class="code" title="function p = finish(p)">pds.eyelink.finish</a>(p);
</div><div id="_line0312" class="line">0312     p = <a href="../../PLDAPS/+pds/+plexon/pds.plexon.finish.html" class="code" title="function p = finish(p)">pds.plexon.finish</a>(p);
</div><div id="_line0313" class="line">0313     <span class="keyword">if</span>(p.defaultParameters<a href="../../Parameters/datapixx/use.html" class="param" title="enable control of VPixx devices">.datapixx.use</a>)
</div><div id="_line0314" class="line">0314         <span class="comment">%start adc data collection if requested</span>
</div><div id="_line0315" class="line">0315         <a href="../../PLDAPS/+pds/+datapixx/+adc/pds.datapixx.adc.stop.html" class="code" title="function p = stop(p)">pds.datapixx.adc.stop</a>(p);
</div><div id="_line0316" class="line">0316         
</div><div id="_line0317" class="line">0317         status = PsychDataPixx(<span class="string">'GetStatus'</span>);
</div><div id="_line0318" class="line">0318         <span class="keyword">if</span> status.timestampLogCount
</div><div id="_line0319" class="line">0319             p.defaultParameters<a href="../../Parameters/datapixx/timestamplog.html" class="param" title="">.datapixx.timestamplog</a> = PsychDataPixx(<span class="string">'GetTimestampLog'</span>, 1);
</div><div id="_line0320" class="line">0320         <span class="keyword">end</span>
</div><div id="_line0321" class="line">0321     <span class="keyword">end</span>
</div><div id="_line0322" class="line">0322     
</div><div id="_line0323" class="line">0323     <span class="keyword">if</span> p.defaultParameters<a href="../../Parameters/sound/use.html" class="param" title="toogle use of sound">.sound.use</a>
</div><div id="_line0324" class="line">0324         <a href="../../PLDAPS/+pds/+audio/pds.audio.clearBuffer.html" class="code" title="function clearBuffer(p)">pds.audio.clearBuffer</a>(p);
</div><div id="_line0325" class="line">0325         <span class="comment">% Close the audio device:</span>
</div><div id="_line0326" class="line">0326         PsychPortAudio(<span class="string">'Close'</span>, p.defaultParameters<a href="../../Parameters/sound/master.html" class="param" title="">.sound.master</a>); 
</div><div id="_line0327" class="line">0327     <span class="keyword">end</span>
</div><div id="_line0328" class="line">0328     
</div><div id="_line0329" class="line">0329     <span class="keyword">if</span> p.trial<a href="../../Parameters/pldaps/useModularStateFunctions.html" class="param" title="use modular state functions, see pldaps.runModularTrial, pldaps.getModules, pldaps.runStateforModules">.pldaps.useModularStateFunctions</a>
</div><div id="_line0330" class="line">0330         [modulesNames,moduleFunctionHandles,moduleRequestedStates,moduleLocationInputs] = <a href="getModules.html" class="code" title="function [modules,moduleFunctionHandles,moduleRequestedStates,moduleLocationInputs] = getModules(p)">getModules</a>(p);
</div><div id="_line0331" class="line">0331         <a href="runStateforModules.html" class="code" title="function runStateforModules(p,state,modules,moduleFunctionHandles,moduleRequestedStates,moduleLocationInputs)">runStateforModules</a>(p,<span class="string">'experimentCleanUp'</span>,modulesNames,moduleFunctionHandles,moduleRequestedStates,moduleLocationInputs);
</div><div id="_line0332" class="line">0332     <span class="keyword">end</span>
</div><div id="_line0333" class="line">0333     
</div><div id="_line0334" class="line">0334     <span class="keyword">if</span> ~p.defaultParameters<a href="../../Parameters/pldaps/nosave.html" class="param" title="disables saving of data when true. see .pldaps.save for more control">.pldaps.nosave</a>
</div><div id="_line0335" class="line">0335         [structs,structNames] = p.defaultParameters<a href="../../Parameters/getAllStructs.html" class="param" title="">.getAllStructs</a>();
</div><div id="_line0336" class="line">0336         
</div><div id="_line0337" class="line">0337         PDS=struct;
</div><div id="_line0338" class="line">0338         PDS.initialParameters=structs(levelsPreTrials);
</div><div id="_line0339" class="line">0339         PDS.initialParameterNames=structNames(levelsPreTrials);
</div><div id="_line0340" class="line">0340         <span class="keyword">if</span> p.defaultParameters<a href="../../Parameters/pldaps/save/initialParametersMerged.html" class="param" title="save merged initial parameters">.pldaps.save.initialParametersMerged</a>
</div><div id="_line0341" class="line">0341             PDS.initialParametersMerged=mergeToSingleStruct(p.defaultParameters); <span class="comment">%too redundant?</span>
</div><div id="_line0342" class="line">0342         <span class="keyword">end</span>
</div><div id="_line0343" class="line">0343         
</div><div id="_line0344" class="line">0344         levelsCondition=1:length(structs);
</div><div id="_line0345" class="line">0345         levelsCondition(ismember(levelsCondition,levelsPreTrials))=[];
</div><div id="_line0346" class="line">0346         PDS.conditions=structs(levelsCondition);
</div><div id="_line0347" class="line">0347         PDS.conditionNames=structNames(levelsCondition);
</div><div id="_line0348" class="line">0348         PDS.data=p.data; 
</div><div id="_line0349" class="line">0349         PDS.functionHandles=p.functionHandles;
</div><div id="_line0350" class="line">0350         <span class="keyword">if</span> p.defaultParameters<a href="../../Parameters/pldaps/save/v73.html" class="param" title="save as matlab version v73?">.pldaps.save.v73</a>
</div><div id="_line0351" class="line">0351             save(fullfile(p.defaultParameters<a href="../../Parameters/session/dir.html" class="param" title="">.session.dir</a>, p.defaultParameters<a href="../../Parameters/session/file.html" class="param" title="">.session.file</a>),<span class="string">'PDS'</span>,<span class="string">'-mat'</span>,<span class="string">'-v7.3'</span>)
</div><div id="_line0352" class="line">0352         <span class="keyword">else</span>
</div><div id="_line0353" class="line">0353             save(fullfile(p.defaultParameters<a href="../../Parameters/session/dir.html" class="param" title="">.session.dir</a>, p.defaultParameters<a href="../../Parameters/session/file.html" class="param" title="">.session.file</a>),<span class="string">'PDS'</span>,<span class="string">'-mat'</span>)
</div><div id="_line0354" class="line">0354         <span class="keyword">end</span>
</div><div id="_line0355" class="line">0355     <span class="keyword">end</span>
</div><div id="_line0356" class="line">0356     
</div><div id="_line0357" class="line">0357 
</div><div id="_line0358" class="line">0358     <span class="keyword">if</span> p.trial<a href="../../Parameters/display/movie/create.html" class="param" title="toggle movie creation">.display.movie.create</a>
</div><div id="_line0359" class="line">0359         Screen(<span class="string">'FinalizeMovie'</span>, p.trial<a href="../../Parameters/display/movie/ptr.html" class="param" title="">.display.movie.ptr</a>);
</div><div id="_line0360" class="line">0360     <span class="keyword">end</span>
</div><div id="_line0361" class="line">0361     
</div><div id="_line0362" class="line">0362     <span class="keyword">if</span> ~p.defaultParameters<a href="../../Parameters/datapixx/use.html" class="param" title="enable control of VPixx devices">.datapixx.use</a> &amp;&amp; p.defaultParameters<a href="../../Parameters/display/useOverlay.html" class="param" title="create an overlay pointer.">.display.useOverlay</a>
</div><div id="_line0363" class="line">0363         glDeleteTextures(2,glGenTextures(1));
</div><div id="_line0364" class="line">0364     <span class="keyword">end</span>
</div><div id="_line0365" class="line">0365     Screen(<span class="string">'CloseAll'</span>);
</div><div id="_line0366" class="line">0366 
</div><div id="_line0367" class="line">0367     sca;
</div><div id="_line0368" class="line">0368     
</div><div id="_line0369" class="line">0369 <span class="keyword">catch</span> me
</div><div id="_line0370" class="line">0370     sca
</div><div id="_line0371" class="line">0371     
</div><div id="_line0372" class="line">0372     <span class="comment">% return cursor and command-line control</span>
</div><div id="_line0373" class="line">0373     ShowCursor
</div><div id="_line0374" class="line">0374     ListenChar(0)
</div><div id="_line0375" class="line">0375     disp(me.message)
</div><div id="_line0376" class="line">0376     
</div><div id="_line0377" class="line">0377     nErr = size(me.stack); 
</div><div id="_line0378" class="line">0378     <span class="keyword">for</span> iErr = 1:nErr
</div><div id="_line0379" class="line">0379         fprintf(<span class="string">'errors in %s line %d\r'</span>, me.stack(iErr).name, me.stack(iErr).line)
</div><div id="_line0380" class="line">0380     <span class="keyword">end</span>
</div><div id="_line0381" class="line">0381     fprintf(<span class="string">'\r\r'</span>)
</div><div id="_line0382" class="line">0382     keyboard    
</div><div id="_line0383" class="line">0383 <span class="keyword">end</span>
</div><div id="_line0384" class="line">0384 
</div><div id="_line0385" class="line">0385 <span class="keyword">end</span>
</div><div id="_line0386" class="line">0386 <span class="comment">%we are pausing, will create a new defaultParaneters Level where changes</span>
</div><div id="_line0387" class="line">0387 <span class="comment">%would go.</span>
</div><div id="_line0388" class="line">0388 <a name="_sub1" href="#_subfunctions" class="code">function pauseLoop(dv)</a>
</div><div id="_line0389" class="line">0389         ShowCursor;
</div><div id="_line0390" class="line">0390         ListenChar(1);
</div><div id="_line0391" class="line">0391         <span class="keyword">while</span>(true)
</div><div id="_line0392" class="line">0392             <span class="comment">%the keyboard chechking we only capture ctrl+alt key presses.</span>
</div><div id="_line0393" class="line">0393             [dv.trial<a href="../../Parameters/keyboard/pressedQ.html" class="param" title="">.keyboard.pressedQ</a>,  dv.trial<a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ</a>]=KbQueueCheck(); <span class="comment">% fast</span>
</div><div id="_line0394" class="line">0394             <span class="keyword">if</span> dv.trial<a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ</a>(dv.trial<a href="../../Parameters/keyboard/codes/Lctrl.html" class="param" title="">.keyboard.codes.Lctrl</a>)&amp;&amp;dv.trial<a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ</a>(dv.trial<a href="../../Parameters/keyboard/codes/Lalt.html" class="param" title="">.keyboard.codes.Lalt</a>)
</div><div id="_line0395" class="line">0395                 <span class="comment">%D: Debugger</span>
</div><div id="_line0396" class="line">0396                 <span class="keyword">if</span>  dv.trial<a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ</a>(dv.trial<a href="../../Parameters/keyboard/codes/dKey.html" class="param" title="">.keyboard.codes.dKey</a>) 
</div><div id="_line0397" class="line">0397                     disp(<span class="string">'stepped into debugger. Type return to start first trial...'</span>)
</div><div id="_line0398" class="line">0398                     keyboard <span class="comment">%#ok&lt;MCKBD&gt;</span>
</div><div id="_line0399" class="line">0399 
</div><div id="_line0400" class="line">0400                 <span class="comment">%E: Eyetracker Setup</span>
</div><div id="_line0401" class="line">0401                 <span class="keyword">elseif</span>  dv.trial<a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ</a>(dv.trial<a href="../../Parameters/keyboard/codes/eKey.html" class="param" title="">.keyboard.codes.eKey</a>)
</div><div id="_line0402" class="line">0402                     <span class="keyword">try</span>
</div><div id="_line0403" class="line">0403                        <span class="keyword">if</span>(dv.trial<a href="../../Parameters/eyelink/use.html" class="param" title="use the eyelink moduke">.eyelink.use</a>) 
</div><div id="_line0404" class="line">0404                            <a href="../../PLDAPS/+pds/+eyelink/pds.eyelink.calibrate.html" class="code" title="function p=calibrate(p)">pds.eyelink.calibrate</a>(dv);
</div><div id="_line0405" class="line">0405                        <span class="keyword">end</span>
</div><div id="_line0406" class="line">0406                     <span class="keyword">catch</span> ME
</div><div id="_line0407" class="line">0407                         display(ME);
</div><div id="_line0408" class="line">0408                     <span class="keyword">end</span>
</div><div id="_line0409" class="line">0409 
</div><div id="_line0410" class="line">0410                 <span class="comment">%M: Manual reward</span>
</div><div id="_line0411" class="line">0411                 <span class="keyword">elseif</span>  dv.trial<a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ</a>(dv.trial<a href="../../Parameters/keyboard/codes/mKey.html" class="param" title="">.keyboard.codes.mKey</a>)
</div><div id="_line0412" class="line">0412                     <a href="../../PLDAPS/+pds/+behavior/+reward/pds.behavior.reward.give.html" class="code" title="function p = give(p, amount)">pds.behavior.reward.give</a>(p);
</div><div id="_line0413" class="line">0413 <span class="comment">%                     if dv.trial.datapixx.use</span>
</div><div id="_line0414" class="line">0414 <span class="comment">%                         pds.datapixx.analogOut(dv.trial.stimulus.rewardTime)</span>
</div><div id="_line0415" class="line">0415 <span class="comment">%                         pds.datapixx.flipBit(dv.trial.event.REWARD);</span>
</div><div id="_line0416" class="line">0416 <span class="comment">%                     end</span>
</div><div id="_line0417" class="line">0417 <span class="comment">%                     dv.trial.ttime = GetSecs - dv.trial.trstart;</span>
</div><div id="_line0418" class="line">0418 <span class="comment">%                     dv.trial.stimulus.timeReward(:,dv.trial.iReward) = [dv.trial.ttime dv.trial.stimulus.rewardTime];</span>
</div><div id="_line0419" class="line">0419 <span class="comment">%                     dv.trial.stimulus.iReward = dv.trial.iReward + 1;</span>
</div><div id="_line0420" class="line">0420 <span class="comment">%                     PsychPortAudio('Start', dv.trial.sound.reward);</span>
</div><div id="_line0421" class="line">0421 
</div><div id="_line0422" class="line">0422                 <span class="comment">%P: PAUSE (end the pause)</span>
</div><div id="_line0423" class="line">0423                 <span class="keyword">elseif</span>  dv.trial<a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ</a>(dv.trial<a href="../../Parameters/keyboard/codes/pKey.html" class="param" title="">.keyboard.codes.pKey</a>)
</div><div id="_line0424" class="line">0424                     dv.trial<a href="../../Parameters/pldaps/quit.html" class="param" title="control expeiment during a trial.">.pldaps.quit</a> = 0;
</div><div id="_line0425" class="line">0425                     ListenChar(2);
</div><div id="_line0426" class="line">0426                     HideCursor;
</div><div id="_line0427" class="line">0427                     <span class="keyword">break</span>;
</div><div id="_line0428" class="line">0428 
</div><div id="_line0429" class="line">0429                 <span class="comment">%Q: QUIT</span>
</div><div id="_line0430" class="line">0430                 <span class="keyword">elseif</span>  dv.trial<a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ</a>(dv.trial<a href="../../Parameters/keyboard/codes/qKey.html" class="param" title="">.keyboard.codes.qKey</a>)
</div><div id="_line0431" class="line">0431                     dv.trial<a href="../../Parameters/pldaps/quit.html" class="param" title="control expeiment during a trial.">.pldaps.quit</a> = 2;
</div><div id="_line0432" class="line">0432                     <span class="keyword">break</span>;
</div><div id="_line0433" class="line">0433                 
</div><div id="_line0434" class="line">0434                 <span class="comment">%X: Execute text selected in Matlab editor</span>
</div><div id="_line0435" class="line">0435                 <span class="keyword">elseif</span>  dv.trial<a href="../../Parameters/keyboard/firstPressQ.html" class="param" title="">.keyboard.firstPressQ</a>(dv.trial<a href="../../Parameters/keyboard/codes/xKey.html" class="param" title="">.keyboard.codes.xKey</a>)
</div><div id="_line0436" class="line">0436                     activeEditor=matlab.desktop.editor.getActive; 
</div><div id="_line0437" class="line">0437                     <span class="keyword">if</span> isempty(activeEditor)
</div><div id="_line0438" class="line">0438                         display(<span class="string">'No Matlab editor open -&gt; Nothing to execute'</span>);
</div><div id="_line0439" class="line">0439                     <span class="keyword">else</span>
</div><div id="_line0440" class="line">0440                         <span class="keyword">if</span> isempty(activeEditor.SelectedText)
</div><div id="_line0441" class="line">0441                             display(<span class="string">'Nothing selected in the active editor Widnow -&gt; Nothing to execute'</span>);
</div><div id="_line0442" class="line">0442                         <span class="keyword">else</span>
</div><div id="_line0443" class="line">0443                             <span class="keyword">try</span>
</div><div id="_line0444" class="line">0444                                 eval(activeEditor.SelectedText)
</div><div id="_line0445" class="line">0445                             <span class="keyword">catch</span> ME
</div><div id="_line0446" class="line">0446                                 display(ME);
</div><div id="_line0447" class="line">0447                             <span class="keyword">end</span>
</div><div id="_line0448" class="line">0448                         <span class="keyword">end</span>
</div><div id="_line0449" class="line">0449                     <span class="keyword">end</span>
</div><div id="_line0450" class="line">0450                     
</div><div id="_line0451" class="line">0451                     
</div><div id="_line0452" class="line">0452                 <span class="keyword">end</span> <span class="comment">%IF CTRL+ALT PRESSED</span>
</div><div id="_line0453" class="line">0453             <span class="keyword">end</span>
</div><div id="_line0454" class="line">0454             pause(0.1);
</div><div id="_line0455" class="line">0455         <span class="keyword">end</span>
</div><div id="_line0456" class="line">0456 
</div><div id="_line0457" class="line">0457 <span class="keyword">end</span>
</div></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005
<br>
check <strong><a href="../../index.html">here</a></strong> date of last update.
<br></address>
</body>
</html>